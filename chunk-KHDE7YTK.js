import{a as ue,b as ge}from"./chunk-Y7I5B6DV.js";import{a as fe}from"./chunk-25JSQPYM.js";import{a as me,b as ce,c as de,d as pe}from"./chunk-P7GMHTU3.js";import{a as ne,b as ae,c as oe,d as re}from"./chunk-DYEZBW6N.js";import"./chunk-F5X5MWHG.js";import{a as le,b as se}from"./chunk-OZY4EI32.js";import{a as te}from"./chunk-2SPCR7JC.js";import{c as j}from"./chunk-EEDQUWWO.js";import{a as Z,b as ee}from"./chunk-FNX66O3M.js";import"./chunk-GNF7NEE4.js";import"./chunk-JXSMCY7E.js";import"./chunk-3RK6DDJD.js";import{a as Y,e as q,h as K,i as G,m as W,n as X}from"./chunk-AK7HCWPM.js";import{b as ie}from"./chunk-XLI345ZL.js";import"./chunk-ZN66PTI3.js";import"./chunk-SCUZIYM3.js";import"./chunk-HRQB4EEZ.js";import"./chunk-GED64AQA.js";import"./chunk-Z4D3JJEG.js";import{a as H,b as J}from"./chunk-ENKIQ3XX.js";import{A as $,b as R,f as V,j as S,n as z}from"./chunk-K2DA6FBL.js";import{T as B,Y as L,Z as Q}from"./chunk-LVPX6TEL.js";import"./chunk-P6PSD35X.js";import{$a as b,Ab as x,Cb as d,Eb as p,Fc as F,Gc as D,La as l,Ob as N,Oc as C,Qb as T,Rc as U,Sb as o,Tb as _,Ub as O,Wa as k,a as v,ac as E,b as y,bc as P,dc as A,ea as h,fc as I,ja as f,ka as u,kc as M,qb as c,rb as n,sb as a,ta as g,tb as w}from"./chunk-WZIMFKHB.js";var he=()=>[8,12,16];function xe(m,t){if(m&1){let e=x();n(0,"button",33),d("click",function(){f(e);let r=p().$implicit,s=p();return u(s.markRead(r))}),n(1,"mat-icon"),o(2,"mark_email_read"),a()()}}function Me(m,t){if(m&1){let e=x();n(0,"button",34),d("click",function(){f(e);let r=p().$implicit,s=p();return u(s.markUnread(r))}),n(1,"mat-icon"),o(2,"mark_email_unread"),a()()}}function Ce(m,t){if(m&1){let e=x();n(0,"div",17)(1,"div",18)(2,"div",19)(3,"mat-icon",20),o(4),a()()(),n(5,"div",21)(6,"div",22)(7,"div",23),o(8),a(),n(9,"mat-chip",24),o(10),a()(),n(11,"div",25),o(12),a(),n(13,"div",26)(14,"mat-icon"),o(15,"event"),a(),n(16,"span"),o(17),A(18,"date"),a()()(),n(19,"div",27),b(20,xe,3,0,"button",28)(21,Me,3,0,"button",29),n(22,"button",30),d("click",function(){let r=f(e).$implicit,s=p();return u(s.delete(r))}),n(23,"mat-icon"),o(24,"delete"),a()(),n(25,"button",31)(26,"mat-icon"),o(27,"more_vert"),a()(),n(28,"mat-menu",null,0)(30,"button",32),d("click",function(){let r=f(e).$implicit,s=p();return u(s.markRead(r))}),n(31,"mat-icon"),o(32,"done"),a(),n(33,"span"),o(34,"Mark read"),a()(),n(35,"button",32),d("click",function(){let r=f(e).$implicit,s=p();return u(s.markUnread(r))}),n(36,"mat-icon"),o(37,"undo"),a(),n(38,"span"),o(39,"Mark unread"),a()(),n(40,"button",32),d("click",function(){let r=f(e).$implicit,s=p();return u(s.delete(r))}),n(41,"mat-icon"),o(42,"delete"),a(),n(43,"span"),o(44,"Delete"),a()()()()()}if(m&2){let e=t.$implicit,i=N(29);l(2),T("unread",!e.read),l(2),O(" ",e.type==="SYSTEM"?"settings":e.type==="REQUESTS"?"tune":e.type==="PAYMENTS"?"payment":"group"," "),l(4),_(e.title),l(),c("color",e.type==="REQUESTS"?"accent":e.type==="PAYMENTS"?"primary":"warn"),l(),_(e.type),l(2),_(e.message),l(5),_(I(18,11,e.createdAt,"MMM d, y \u2022 h:mm a")),l(3),c("ngIf",!e.read),l(),c("ngIf",e.read),l(4),c("matMenuTriggerFor",i)}}function be(m,t){m&1&&(n(0,"div",35)(1,"mat-icon"),o(2,"notifications_off"),a(),n(3,"span"),o(4,"No notifications"),a()())}var _e=class m{snack=h(Z);adminService=h(fe);adminSocket=h(te);rows=g([]);search=new S("",{nonNullable:!0});filterCtrl=new S("All",{nonNullable:!0});filter=g("All");pageIndex=g(0);pageSize=g(8);searchTerm=g("");filtered=M(()=>{let t=this.searchTerm(),e=this.filter();return this.rows().filter(i=>{let r=(i.title+" "+i.message+" "+i.type).toLowerCase().includes(t),s=e==="All"?!0:e==="Unread"?!i.read:e==="Read"?i.read:!0;return r&&s})});sorted=M(()=>[...this.filtered()].sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()));page=M(()=>{let t=this.pageIndex()*this.pageSize();return this.sorted().slice(t,t+this.pageSize())});ngOnInit(){let t=this.adminSocket.getSocket();t&&t.on("admin:notification:new",e=>{e.type=e.type?.toUpperCase()||"REQUESTS",this.snack.open(`New notification: ${e.title}`,"Close",{duration:3e3}),this.rows.set([e,...this.rows()])}),this.loadNotifications(),this.filterCtrl.valueChanges.subscribe(e=>{this.setFilter(e)}),this.search.valueChanges.subscribe(e=>{this.searchTerm.set(e.trim().toLowerCase()),this.pageIndex.set(0)})}setFilter(t){this.filter.set(t),this.filterCtrl.value!==t&&this.filterCtrl.setValue(t,{emitEvent:!1}),this.pageIndex.set(0)}loadNotifications(){this.adminService.getNotifications().subscribe({next:t=>{let e=t.map(i=>({id:i.id,title:i.title,message:i.message,read:i.read??!i.unread,type:i.type?i.type.toUpperCase():"REQUESTS",createdAt:i.createdAt??i.date,updatedAt:i.updatedAt}));this.rows.set(e)},error:t=>{let e=typeof t=="string"?t:t?.message||"Failed to load notifications";this.snack.open(e,"Close",{duration:2500})}})}markRead(t){t.read||(t.read=!0,this.rows.set([...this.rows()]),this.adminService.markNotificationRead(t.id).subscribe({next:()=>{this.adminService.decrementUnreadCount()},error:()=>{t.read=!1,this.rows.set([...this.rows()])}}))}markUnread(t){t.read&&(t.read=!1,this.rows.set([...this.rows()]),this.adminService.markNotificationUnRead(t.id).subscribe({next:()=>{this.adminService.incrementUnreadCount()},error:()=>{t.read=!1,this.rows.set([...this.rows()])}}))}delete(t){this.rows.set(this.rows().filter(i=>i.id!==t.id));let e=!1;t.read||(e=!0),this.adminService.deleteNotification(t.id).subscribe({next:()=>{e&&this.adminService.decrementUnreadCount()},error:()=>{t.read=!1,this.rows.set([...this.rows()])}})}markAllRead(){this.rows().filter(e=>!e.read).length&&(this.adminService.markallNotificationRead().subscribe({next:()=>{this.adminService.updateUnreadCount(0),this.rows.set(this.rows().map(e=>y(v({},e),{read:!0})))},error:()=>{this.snack.open("Failed to mark all notifications as read","Close",{duration:2500})}}),this.snack.open("All notifications marked as read","OK",{duration:1800}))}clearAll(){let t=this.rows().map(e=>e.id);t.length&&(this.rows.set([]),t.forEach(e=>{this.adminService.deleteNotification(e).subscribe({next:()=>{},error:i=>{this.snack.open(`Failed to delete notification id ${e}`,"Close",{duration:2500})}})}),this.snack.open("All notifications cleared","OK",{duration:1500}))}pageChange(t){this.pageIndex.set(t.pageIndex),this.pageSize.set(t.pageSize)}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=k({type:m,selectors:[["admin-notifications"]],features:[E([C])],decls:29,vars:10,consts:[["menu","matMenu"],[1,"title"],[1,"toolbar"],[1,"filters",3,"multiple","formControl"],["value","All"],["value","Unread"],["value","Read"],["appearance","outline",1,"search"],["matInput","","placeholder","Title, message, type",3,"formControl"],["matSuffix",""],[1,"actions"],["mat-stroked-button","","matTooltip","Mark all as read",3,"click"],["mat-stroked-button","","color","warn","matTooltip","Clear all notifications",3,"click"],[1,"list","glass"],["class","item",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"pager",3,"page","length","pageIndex","pageSize","pageSizeOptions"],[1,"item"],[1,"left"],[1,"icon-wrap"],[1,"type-icon"],[1,"mid"],[1,"row1"],[1,"title-text"],[1,"type-chip",3,"color"],[1,"message"],[1,"meta"],[1,"right"],["mat-icon-button","","matTooltip","Mark as read",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Mark as unread",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-icon-button","","matTooltip","More",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-icon-button","","matTooltip","Mark as read",3,"click"],["mat-icon-button","","matTooltip","Mark as unread",3,"click"],[1,"empty"]],template:function(e,i){e&1&&(n(0,"h2",1),o(1,"Notificationss"),a(),n(2,"div",2)(3,"mat-chip-listbox",3)(4,"mat-chip-option",4),o(5,"All"),a(),n(6,"mat-chip-option",5),o(7,"Unread"),a(),n(8,"mat-chip-option",6),o(9,"Read"),a()(),n(10,"mat-form-field",7)(11,"mat-label"),o(12,"Search notifications"),a(),w(13,"input",8),n(14,"mat-icon",9),o(15,"search"),a()(),n(16,"div",10)(17,"button",11),d("click",function(){return i.markAllRead()}),n(18,"mat-icon"),o(19,"done_all"),a(),o(20," Mark all read "),a(),n(21,"button",12),d("click",function(){return i.clearAll()}),n(22,"mat-icon"),o(23,"delete_sweep"),a(),o(24," Clear all "),a()()(),n(25,"div",13),b(26,Ce,45,14,"div",14)(27,be,5,0,"div",15),a(),n(28,"mat-paginator",16),d("page",function(s){return i.pageChange(s)}),a()),e&2&&(l(3),c("multiple",!1)("formControl",i.filterCtrl),l(10),c("formControl",i.search),l(13),c("ngForOf",i.page()),l(),c("ngIf",!i.sorted().length),l(),c("length",i.sorted().length)("pageIndex",i.pageIndex())("pageSize",i.pageSize())("pageSizeOptions",P(9,he)))},dependencies:[U,F,D,$,R,V,z,j,re,ne,oe,ae,J,H,Q,L,B,G,K,Y,q,X,W,ge,ue,se,le,ee,ie,pe,ce,me,de,C],styles:['.title[_ngcontent-%COMP%]{margin:0 0 .8rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.8rem;flex-wrap:wrap}.chips[_ngcontent-%COMP%]{display:flex;align-items:center}.search[_ngcontent-%COMP%]{flex:1 1 360px;min-width:260px}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list.glass[_ngcontent-%COMP%]{border-radius:18px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,#ffffff08,#ffffff05),#1018288c;-webkit-backdrop-filter:blur(12px) saturate(120%);backdrop-filter:blur(12px) saturate(120%);padding:.4rem}.item[_ngcontent-%COMP%]{display:grid;grid-template-columns:52px 1fr auto;gap:.6rem;align-items:center;padding:.6rem .5rem;border-radius:12px}.item[_ngcontent-%COMP%] + .item[_ngcontent-%COMP%]{border-top:1px solid rgba(255,255,255,.08)}.left[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.icon-wrap[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;background:#ffffff0f;border:1px solid rgba(255,255,255,.12);position:relative}.icon-wrap.unread[_ngcontent-%COMP%]:after{content:"";position:absolute;top:-3px;right:-3px;width:10px;height:10px;border-radius:50%;background:#ff7a7a;border:2px solid rgba(16,24,40,.85)}.type-icon[_ngcontent-%COMP%]{opacity:.95}.type-icon.system[_ngcontent-%COMP%]{color:#ffb74d}.type-icon.requests[_ngcontent-%COMP%]{color:#64b5f6}.type-icon.payments[_ngcontent-%COMP%]{color:#81c784}.type-icon.users[_ngcontent-%COMP%]{color:#e57373}.mid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.row1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.title-text[_ngcontent-%COMP%]{font-weight:800;letter-spacing:.2px}.type-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 26px;--mdc-chip-label-text-size: .8rem}.message[_ngcontent-%COMP%]{opacity:.9}.meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.35rem;opacity:.85}.meta[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;opacity:.85}.right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.empty[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.45rem;padding:.8rem;opacity:.9;justify-content:center}.empty[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.pager[_ngcontent-%COMP%]{margin-top:.8rem}@media (max-width: 720px){.item[_ngcontent-%COMP%]{grid-template-columns:40px 1fr auto}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:unset}}.filters[_ngcontent-%COMP%]{display:inline-flex;gap:.25rem;margin-right:.5rem}[_nghost-%COMP%]     .filters .mat-mdc-chip{--mdc-chip-container-height: 28px;--mdc-chip-label-text-size: .85rem}']})};export{_e as AdminNotificationsComponent};
