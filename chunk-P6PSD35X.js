import{$ as h,Da as d,E as r,Sc as u,Xc as a,Y as i,Yc as c,ea as n,q as l,t as g}from"./chunk-WZIMFKHB.js";var p={production:!1,apiBaseUrl:"http://localhost:4000/api",socketUrl:"http://localhost:4000"};var m=class o{http=n(c);platformId=n(d);isBrowser=u(this.platformId);baseUrl=p.apiBaseUrl;tokenKey="medtik_token";isProd=p.production;registerPatient(t){return this.http.post(`${this.baseUrl}/auth/register-patient`,t,this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}verifyOtp(t){return this.http.post(`${this.baseUrl}/auth/verify-otp`,t,this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}login(t){return this.http.post(`${this.baseUrl}/auth/login`,t,this.getHttpOptions()).pipe(i(e=>{!this.isProd&&e?.token&&this.setToken(e.token)}),g(e=>({message:e.message,role:e.role??e.user?.role??null,doctorStatus:e.doctorStatus??null,token:e.token??null,id:e.id??null})),r(e=>this.handleError(e)))}resendOtp(t){return this.http.post(`${this.baseUrl}/auth/resend-otp`,{email:t},this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}changePassword(t){let e=this.isProd?void 0:new a({"Content-Type":"application/json",Authorization:`Bearer ${this.getToken()??""}`});return this.http.post(`${this.baseUrl}/auth/change-password`,t,this.isProd?{withCredentials:!0}:{headers:e}).pipe(r(s=>this.handleError(s)))}logout(){return this.http.post(`${this.baseUrl}/auth/logout`,{},this.getHttpOptions()).pipe(r(t=>this.handleError(t)))}getToken(){return this.isBrowser?localStorage.getItem(this.tokenKey):null}clearToken(){this.isBrowser&&localStorage.removeItem(this.tokenKey)}setToken(t){this.isBrowser&&localStorage.setItem(this.tokenKey,t)}getCurrentRole(){if(!this.isBrowser)return null;let t=this.getToken();return t?this.extractRoleFromToken(t):null}extractRoleFromToken(t){try{let e=t.split(".")[1];if(!e)return null;let s=e.replace(/-/g,"+").replace(/_/g,"/"),f=atob(s);return JSON.parse(f)?.role??null}catch(e){return console.warn("Failed to decode JWT role",e),null}}getHttpOptions(){return this.isProd?{withCredentials:!0}:{headers:new a({"Content-Type":"application/json",Authorization:`Bearer ${this.getToken()??""}`})}}handleError(t){let e="Something went wrong. Please try again.";return t.error?typeof t.error=="string"?e=t.error:typeof t.error=="object"&&(e=t.error.error??t.error.message??e):t.message&&(e=t.message),l(()=>e)}forgotPassword(t){return this.http.post(`${this.baseUrl}/auth/request-password-reset`,t,this.getHttpOptions()).pipe(i(e=>console.log("Password reset response:",e)),r(e=>this.handleError(e)))}resetPassword(t,e){return this.http.post(`${this.baseUrl}/auth/reset-password?token=${t}`,{newPassword:e},this.getHttpOptions()).pipe(r(s=>this.handleError(s)))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};export{p as a,m as b};
