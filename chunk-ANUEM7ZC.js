import{a as V,b as N,h as D,i as R,m as $,n as L}from"./chunk-LCR2LKFI.js";import{A as k,b as C,d as h,f as O,g as M,l as I,o as S,r as w,x as P,y as E}from"./chunk-YN6JIHUF.js";import{b as q}from"./chunk-CUGN3AIA.js";import{Y as T,Z as F}from"./chunk-YSTQL2PO.js";import{d as b,e as x}from"./chunk-XNDURAWP.js";import{$ as m,Bc as y,Ga as r,Mc as _,Nb as s,Ob as c,Pb as g,Ra as v,Wa as d,lb as l,mb as o,nb as a,ob as f,xb as u,zb as p}from"./chunk-HKUWCROW.js";import"./chunk-JKOY2XUY.js";function A(n,t){if(n&1&&(o(0,"p",16),s(1,"We sent a code to "),o(2,"strong"),s(3),a()()),n&2){let i=p();r(3),c(i.displayPhone)}}function G(n,t){n&1&&(o(0,"mat-error"),s(1," Code is required "),a())}function z(n,t){n&1&&(o(0,"mat-error"),s(1," Enter 6 digits "),a())}function U(n,t){if(n&1&&(o(0,"p",17),s(1),a()),n&2){let i=p();r(),c(i.apiError)}}function H(n,t){if(n&1&&(o(0,"p",18),s(1),a()),n&2){let i=p();r(),c(i.infoMessage)}}function W(n){let t=n.match(/^(\+\d{1,4})(\d+)(\d{2,3})$/);if(!t)return n;let i="*".repeat(Math.max(3,t[2].length));return`${t[1]} ${i}${t[3]}`}var B=class n{fb=m(E);router=m(b);auth=m(q);cooldownSeconds=300;intervalId=null;getFromSession(t){return typeof window<"u"?sessionStorage.getItem(t):null}phone=history.state?.phone??this.getFromSession("medtik_pending_phone")??"";email=history.state?.email??this.getFromSession("medtik_pending_email")??"";displayPhone=this.phone?W(this.phone):"";form=this.fb.group({code:["",[h.required,h.pattern(/^\d{6}$/)]]});seconds=this.cooldownSeconds;loading=!1;apiError=null;infoMessage=null;get formattedTime(){let t=Math.floor(this.seconds/60).toString().padStart(2,"0"),i=(this.seconds%60).toString().padStart(2,"0");return`${t}:${i}`}constructor(){if(!this.email){this.router.navigate(["/auth/signup"]);return}}ngOnDestroy(){this.clearInterval(),localStorage.removeItem("otpEmail")}ngOnInit(){this.startCooldown(),this.resendOtp()}resendOtp(){this.seconds>0||(this.infoMessage="If your previous OTP expired we will send a new one automatically when you try again.",this.email=this.email||localStorage.getItem("otpEmail")||"",console.log("Starting OTP cooldown and sending OTP to",this.email),this.auth.resendOtp(this.email).subscribe({next:()=>{console.log("OTP resent successfully")},error:t=>{console.log("OTP not verified yet",t)}}))}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}let t=this.form.value.code??"";this.email=this.email||localStorage.getItem("otpEmail")||"";let i={email:this.email,otp:t};this.loading=!0,this.apiError=null,this.infoMessage=null,console.log("Verifying OTP for",i),this.auth.verifyOtp(i).subscribe({next:()=>{this.loading=!1,this.clearPendingContact(),this.router.navigateByUrl("/auth/login",{state:{verified:!0,email:this.email}})},error:e=>{this.loading=!1,this.apiError=e,typeof e=="string"&&e.toLowerCase().includes("expired")&&this.restartCooldown()}})}restartCooldown(){this.clearInterval(),this.seconds=this.cooldownSeconds,this.startCooldown()}startCooldown(){this.clearInterval(),this.intervalId=setInterval(()=>{this.seconds=Math.max(0,this.seconds-1),this.seconds===0&&this.clearInterval()},1e3)}clearInterval(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}clearPendingContact(){typeof window<"u"&&(sessionStorage.removeItem("medtik_pending_email"),sessionStorage.removeItem("medtik_pending_phone"))}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=v({type:n,selectors:[["app-otp"]],decls:27,vars:10,consts:[[1,"auth-shell"],[1,"auth-frame"],[1,"form-pane","only-form"],[1,"brand"],["src","https://ik.imagekit.io/a2wpi1kd9/imgToUrl/image-to-url_HEow9eLbR","alt","Medtik",1,"brand-mark"],["class","sub",4,"ngIf"],[3,"ngSubmit","formGroup"],["appearance","outline"],["matInput","","maxlength","6","formControlName","code","placeholder","******"],[4,"ngIf"],["class","api-error","role","alert",4,"ngIf"],["class","info",4,"ngIf"],["mat-flat-button","","color","primary","type","submit",1,"submit",3,"disabled"],[1,"aux"],["type","button","mat-button","",3,"click","disabled"],["routerLink","/auth/sign-up"],[1,"sub"],["role","alert",1,"api-error"],[1,"info"]],template:function(i,e){i&1&&(o(0,"div",0)(1,"div",1)(2,"main",2)(3,"div",3),f(4,"img",4),o(5,"h1"),s(6,"Verify"),a()(),o(7,"h2"),s(8,"Enter the 6-digit code"),a(),d(9,A,4,1,"p",5),o(10,"form",6),u("ngSubmit",function(){return e.submit()}),o(11,"mat-form-field",7)(12,"mat-label"),s(13,"OTP code"),a(),f(14,"input",8),d(15,G,2,0,"mat-error",9)(16,z,2,0,"mat-error",9),a(),d(17,U,2,1,"p",10)(18,H,2,1,"p",11),o(19,"button",12),s(20),a(),o(21,"div",13)(22,"button",14),u("click",function(){return e.resendOtp()}),s(23),a()(),o(24,"div",13)(25,"a",15),s(26,"Back to sign up"),a()()()()()()),i&2&&(r(9),l("ngIf",e.displayPhone),r(),l("formGroup",e.form),r(5),l("ngIf",e.form.controls.code.touched&&(e.form.controls.code.errors==null?null:e.form.controls.code.errors.required)),r(),l("ngIf",e.form.controls.code.touched&&(e.form.controls.code.errors==null?null:e.form.controls.code.errors.pattern)),r(),l("ngIf",e.apiError),r(),l("ngIf",e.infoMessage),r(),l("disabled",e.loading),r(),g(" ",e.loading?"Verifying...":"Verify"," "),r(2),l("disabled",e.seconds>0),r(),g(" Resend ",e.seconds>0?"("+e.formattedTime+")":""," "))},dependencies:[_,y,k,I,C,O,M,P,S,w,R,D,V,N,L,$,F,T,x],styles:[".auth-shell[_ngcontent-%COMP%]{min-height:100svh;display:flex;align-items:center;justify-content:center;padding:clamp(16px,4vmin,32px);overflow:auto}.auth-frame[_ngcontent-%COMP%]{width:min(520px,94vw);display:grid;grid-template-columns:1fr;border-radius:24px;background:linear-gradient(180deg,#ffffff08,#ffffff05),#101828b8;-webkit-backdrop-filter:blur(10px) saturate(120%);backdrop-filter:blur(10px) saturate(120%);border:1px solid rgba(255,255,255,.08);box-shadow:0 24px 70px #00000080}.form-pane[_ngcontent-%COMP%]{padding:28px 20px;display:grid;align-content:start}.brand[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.35rem;margin-bottom:.75rem;text-align:center}.brand-mark[_ngcontent-%COMP%]{width:96px;height:96px;object-fit:contain;filter:drop-shadow(0 10px 24px rgba(42,118,183,.6))}h2[_ngcontent-%COMP%]{margin:.25rem 0 .5rem;font-weight:800;color:#e6eef6;font-size:clamp(1.2rem,2vw,1.5rem)}.sub[_ngcontent-%COMP%]{margin:.1rem 0 1rem;color:#a7b4c5}form[_ngcontent-%COMP%]{display:grid;gap:.8rem}.submit[_ngcontent-%COMP%]{width:100%;border-radius:12px;margin-top:.25rem}.aux[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:.1rem}.aux[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#a7b4c5;text-decoration:none}.aux[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#e6eaf2}.api-error[_ngcontent-%COMP%]{color:#f44336;font-size:.85rem;margin:-.25rem 0 .5rem}.info[_ngcontent-%COMP%]{color:#a7b4c5;font-size:.85rem;margin:-.25rem 0 .5rem}"]})};export{B as OtpComponent};
