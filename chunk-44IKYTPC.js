import{a as ft,b as gt}from"./chunk-UKL3BBPM.js";import{a as ut}from"./chunk-KAG44AFS.js";import{a as mt,b as ct,c as dt,d as pt}from"./chunk-B453S2AB.js";import{a as et}from"./chunk-6O75L666.js";import"./chunk-LVHP3QQG.js";import{b as it}from"./chunk-OQ674PF3.js";import{c as j}from"./chunk-M4CUV4U7.js";import{a as nt,b as ot,c as at,d as rt}from"./chunk-LXWUKR3B.js";import"./chunk-F5X5MWHG.js";import{a as st,b as lt}from"./chunk-XGLVXY7I.js";import{a as Z,b as tt}from"./chunk-Y5ANY4EP.js";import"./chunk-ZCFZR4S3.js";import"./chunk-4K5T2QBN.js";import{a as Y,e as q,h as K,i as G,m as W,n as X}from"./chunk-LCR2LKFI.js";import"./chunk-BR5LHSVS.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import{A as $,b as V,f as z,j as S,n as U}from"./chunk-YN6JIHUF.js";import"./chunk-JQ5JD7Q3.js";import{a as H,b as J}from"./chunk-W6QHVSTW.js";import{T as B,Y as L,Z as Q}from"./chunk-YSTQL2PO.js";import{$ as h,Ac as F,Bc as D,Ga as s,Jb as N,Jc as C,Lb as T,Mc as R,Nb as a,Ob as _,Pb as E,Ra as k,Wa as b,Xb as O,Yb as P,_b as A,ac as I,ea as f,fa as g,fc as M,lb as c,mb as i,nb as o,oa as u,ob as w,vb as x,xb as d,zb as p}from"./chunk-HKUWCROW.js";import{a as v,b as y}from"./chunk-JKOY2XUY.js";var ht=()=>[8,12,16];function xt(m,e){if(m&1){let t=x();i(0,"button",33),d("click",function(){f(t);let r=p().$implicit,l=p();return g(l.markRead(r))}),i(1,"mat-icon"),a(2,"mark_email_read"),o()()}}function Mt(m,e){if(m&1){let t=x();i(0,"button",34),d("click",function(){f(t);let r=p().$implicit,l=p();return g(l.markUnread(r))}),i(1,"mat-icon"),a(2,"mark_email_unread"),o()()}}function Ct(m,e){if(m&1){let t=x();i(0,"div",17)(1,"div",18)(2,"div",19)(3,"mat-icon",20),a(4),o()()(),i(5,"div",21)(6,"div",22)(7,"div",23),a(8),o(),i(9,"mat-chip",24),a(10),o()(),i(11,"div",25),a(12),o(),i(13,"div",26)(14,"mat-icon"),a(15,"event"),o(),i(16,"span"),a(17),A(18,"date"),o()()(),i(19,"div",27),b(20,xt,3,0,"button",28)(21,Mt,3,0,"button",29),i(22,"button",30),d("click",function(){let r=f(t).$implicit,l=p();return g(l.delete(r))}),i(23,"mat-icon"),a(24,"delete"),o()(),i(25,"button",31)(26,"mat-icon"),a(27,"more_vert"),o()(),i(28,"mat-menu",null,0)(30,"button",32),d("click",function(){let r=f(t).$implicit,l=p();return g(l.markRead(r))}),i(31,"mat-icon"),a(32,"done"),o(),i(33,"span"),a(34,"Mark read"),o()(),i(35,"button",32),d("click",function(){let r=f(t).$implicit,l=p();return g(l.markUnread(r))}),i(36,"mat-icon"),a(37,"undo"),o(),i(38,"span"),a(39,"Mark unread"),o()(),i(40,"button",32),d("click",function(){let r=f(t).$implicit,l=p();return g(l.delete(r))}),i(41,"mat-icon"),a(42,"delete"),o(),i(43,"span"),a(44,"Delete"),o()()()()()}if(m&2){let t=e.$implicit,n=N(29);s(2),T("unread",!t.read),s(2),E(" ",t.type==="SYSTEM"?"settings":t.type==="REQUESTS"?"tune":t.type==="PAYMENTS"?"payment":"group"," "),s(4),_(t.title),s(),c("color",t.type==="REQUESTS"?"accent":t.type==="PAYMENTS"?"primary":"warn"),s(),_(t.type),s(2),_(t.message),s(5),_(I(18,11,t.createdAt,"MMM d, y \u2022 h:mm a")),s(3),c("ngIf",!t.read),s(),c("ngIf",t.read),s(4),c("matMenuTriggerFor",n)}}function bt(m,e){m&1&&(i(0,"div",35)(1,"mat-icon"),a(2,"notifications_off"),o(),i(3,"span"),a(4,"No notifications"),o()())}var _t=class m{snack=h(Z);adminService=h(ut);adminSocket=h(et);rows=u([]);search=new S("",{nonNullable:!0});filterCtrl=new S("All",{nonNullable:!0});filter=u("All");pageIndex=u(0);pageSize=u(8);searchTerm=u("");filtered=M(()=>{let e=this.searchTerm(),t=this.filter();return this.rows().filter(n=>{let r=(n.title+" "+n.message+" "+n.type).toLowerCase().includes(e),l=t==="All"?!0:t==="Unread"?!n.read:t==="Read"?n.read:!0;return r&&l})});sorted=M(()=>[...this.filtered()].sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()));page=M(()=>{let e=this.pageIndex()*this.pageSize();return this.sorted().slice(e,e+this.pageSize())});ngOnInit(){let e=this.adminSocket.getSocket();e&&e.on("admin:notification:new",t=>{t.type=t.type?.toUpperCase()||"REQUESTS",this.snack.open(`New notification: ${t.title}`,"Close",{duration:3e3}),this.rows.set([t,...this.rows()])}),this.loadNotifications(),this.filterCtrl.valueChanges.subscribe(t=>{this.setFilter(t)}),this.search.valueChanges.subscribe(t=>{this.searchTerm.set(t.trim().toLowerCase()),this.pageIndex.set(0)})}setFilter(e){this.filter.set(e),this.filterCtrl.value!==e&&this.filterCtrl.setValue(e,{emitEvent:!1}),this.pageIndex.set(0)}loadNotifications(){this.adminService.getNotifications().subscribe({next:e=>{let t=e.map(n=>({id:n.id,title:n.title,message:n.message,read:n.read??!n.unread,type:n.type?n.type.toUpperCase():"REQUESTS",createdAt:n.createdAt??n.date,updatedAt:n.updatedAt}));this.rows.set(t)},error:e=>{let t=typeof e=="string"?e:e?.message||"Failed to load notifications";this.snack.open(t,"Close",{duration:2500})}})}markRead(e){e.read||(e.read=!0,this.rows.set([...this.rows()]),this.adminService.markNotificationRead(e.id).subscribe({next:()=>{},error:()=>{e.read=!1,this.rows.set([...this.rows()])}}))}markUnread(e){e.read&&(e.read=!1,this.rows.set([...this.rows()]),this.adminService.markNotificationUnRead(e.id).subscribe({next:()=>{},error:()=>{e.read=!1,this.rows.set([...this.rows()])}}))}delete(e){this.rows.set(this.rows().filter(t=>t.id!==e.id)),this.adminService.deleteNotification(e.id).subscribe({next:()=>{},error:()=>{e.read=!1,this.rows.set([...this.rows()])}})}markAllRead(){let e=this.rows().filter(t=>!t.read);e.length&&(this.rows.set(this.rows().map(t=>y(v({},t),{read:!0}))),e.forEach(t=>{this.adminService.markNotificationRead(t.id).subscribe({next:()=>{},error:()=>{t.read=!1,this.rows.set([...this.rows()]),this.snack.open(`Failed to mark notification "${t.title}" as read`,"Close",{duration:2500})}})}),this.snack.open("All notifications marked as read","OK",{duration:1800}))}clearAll(){let e=this.rows().map(t=>t.id);e.length&&(this.rows.set([]),e.forEach(t=>{this.adminService.deleteNotification(t).subscribe({next:()=>{},error:n=>{this.snack.open(`Failed to delete notification id ${t}`,"Close",{duration:2500})}})}),this.snack.open("All notifications cleared","OK",{duration:1500}))}pageChange(e){this.pageIndex.set(e.pageIndex),this.pageSize.set(e.pageSize)}static \u0275fac=function(t){return new(t||m)};static \u0275cmp=k({type:m,selectors:[["admin-notifications"]],features:[O([C])],decls:29,vars:10,consts:[["menu","matMenu"],[1,"title"],[1,"toolbar"],[1,"filters",3,"multiple","formControl"],["value","All"],["value","Unread"],["value","Read"],["appearance","outline",1,"search"],["matInput","","placeholder","Title, message, type",3,"formControl"],["matSuffix",""],[1,"actions"],["mat-stroked-button","","matTooltip","Mark all as read",3,"click"],["mat-stroked-button","","color","warn","matTooltip","Clear all notifications",3,"click"],[1,"list","glass"],["class","item",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"pager",3,"page","length","pageIndex","pageSize","pageSizeOptions"],[1,"item"],[1,"left"],[1,"icon-wrap"],[1,"type-icon"],[1,"mid"],[1,"row1"],[1,"title-text"],[1,"type-chip",3,"color"],[1,"message"],[1,"meta"],[1,"right"],["mat-icon-button","","matTooltip","Mark as read",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Mark as unread",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-icon-button","","matTooltip","More",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-icon-button","","matTooltip","Mark as read",3,"click"],["mat-icon-button","","matTooltip","Mark as unread",3,"click"],[1,"empty"]],template:function(t,n){t&1&&(i(0,"h2",1),a(1,"Notificationss"),o(),i(2,"div",2)(3,"mat-chip-listbox",3)(4,"mat-chip-option",4),a(5,"All"),o(),i(6,"mat-chip-option",5),a(7,"Unread"),o(),i(8,"mat-chip-option",6),a(9,"Read"),o()(),i(10,"mat-form-field",7)(11,"mat-label"),a(12,"Search notifications"),o(),w(13,"input",8),i(14,"mat-icon",9),a(15,"search"),o()(),i(16,"div",10)(17,"button",11),d("click",function(){return n.markAllRead()}),i(18,"mat-icon"),a(19,"done_all"),o(),a(20," Mark all read "),o(),i(21,"button",12),d("click",function(){return n.clearAll()}),i(22,"mat-icon"),a(23,"delete_sweep"),o(),a(24," Clear all "),o()()(),i(25,"div",13),b(26,Ct,45,14,"div",14)(27,bt,5,0,"div",15),o(),i(28,"mat-paginator",16),d("page",function(l){return n.pageChange(l)}),o()),t&2&&(s(3),c("multiple",!1)("formControl",n.filterCtrl),s(10),c("formControl",n.search),s(13),c("ngForOf",n.page()),s(),c("ngIf",!n.sorted().length),s(),c("length",n.sorted().length)("pageIndex",n.pageIndex())("pageSize",n.pageSize())("pageSizeOptions",P(9,ht)))},dependencies:[R,F,D,$,V,z,U,j,rt,nt,at,ot,J,H,Q,L,B,G,K,Y,q,X,W,gt,ft,lt,st,tt,it,pt,ct,mt,dt,C],styles:['.title[_ngcontent-%COMP%]{margin:0 0 .8rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.8rem;flex-wrap:wrap}.chips[_ngcontent-%COMP%]{display:flex;align-items:center}.search[_ngcontent-%COMP%]{flex:1 1 360px;min-width:260px}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list.glass[_ngcontent-%COMP%]{border-radius:18px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,#ffffff08,#ffffff05),#1018288c;-webkit-backdrop-filter:blur(12px) saturate(120%);backdrop-filter:blur(12px) saturate(120%);padding:.4rem}.item[_ngcontent-%COMP%]{display:grid;grid-template-columns:52px 1fr auto;gap:.6rem;align-items:center;padding:.6rem .5rem;border-radius:12px}.item[_ngcontent-%COMP%] + .item[_ngcontent-%COMP%]{border-top:1px solid rgba(255,255,255,.08)}.left[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.icon-wrap[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;background:#ffffff0f;border:1px solid rgba(255,255,255,.12);position:relative}.icon-wrap.unread[_ngcontent-%COMP%]:after{content:"";position:absolute;top:-3px;right:-3px;width:10px;height:10px;border-radius:50%;background:#ff7a7a;border:2px solid rgba(16,24,40,.85)}.type-icon[_ngcontent-%COMP%]{opacity:.95}.type-icon.system[_ngcontent-%COMP%]{color:#ffb74d}.type-icon.requests[_ngcontent-%COMP%]{color:#64b5f6}.type-icon.payments[_ngcontent-%COMP%]{color:#81c784}.type-icon.users[_ngcontent-%COMP%]{color:#e57373}.mid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.row1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.title-text[_ngcontent-%COMP%]{font-weight:800;letter-spacing:.2px}.type-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 26px;--mdc-chip-label-text-size: .8rem}.message[_ngcontent-%COMP%]{opacity:.9}.meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.35rem;opacity:.85}.meta[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;opacity:.85}.right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.empty[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.45rem;padding:.8rem;opacity:.9;justify-content:center}.empty[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.pager[_ngcontent-%COMP%]{margin-top:.8rem}@media (max-width: 720px){.item[_ngcontent-%COMP%]{grid-template-columns:40px 1fr auto}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:unset}}.filters[_ngcontent-%COMP%]{display:inline-flex;gap:.25rem;margin-right:.5rem}[_nghost-%COMP%]     .filters .mat-mdc-chip{--mdc-chip-container-height: 28px;--mdc-chip-label-text-size: .85rem}']})};export{_t as AdminNotificationsComponent};
