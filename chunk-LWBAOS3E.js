import{a as h,b as _t,c as Ct}from"./chunk-E2JTTORF.js";import{a as nt,b as at,c as rt,d as ot,e as lt,f as mt,g as st,h as dt,i as ct,j as pt,k as ft,l as ut}from"./chunk-EU2GGAHC.js";import{a as C,b as gt}from"./chunk-UKL3BBPM.js";import{a as it}from"./chunk-GZN3XNYO.js";import{a as tt,b as et}from"./chunk-VCQXB3R3.js";import{a as W,d as X}from"./chunk-LXWUKR3B.js";import"./chunk-F5X5MWHG.js";import{a as Y,b as Z}from"./chunk-XGLVXY7I.js";import{a as G}from"./chunk-Y5ANY4EP.js";import"./chunk-ZCFZR4S3.js";import"./chunk-4K5T2QBN.js";import{a as $,e as j,h as F,i as H,m as K,n as J}from"./chunk-LCR2LKFI.js";import"./chunk-BR5LHSVS.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import{A as B,b as O,f as N,j as R,n as V}from"./chunk-YN6JIHUF.js";import{a as Q,b as q}from"./chunk-W6QHVSTW.js";import"./chunk-W6FI7VKQ.js";import{Y as L,Z as z}from"./chunk-YSTQL2PO.js";import{Bc as D,Db as M,Eb as v,Fb as x,Ga as r,Jc as T,Ka as b,Mc as U,Nb as o,Ob as d,Pb as _,Ra as y,Wa as s,_b as E,ac as k,ea as w,fa as S,fc as I,lb as m,mb as n,nb as a,ob as c,sb as p,tb as f,vb as A,xb as P,zb as g}from"./chunk-HKUWCROW.js";import"./chunk-JKOY2XUY.js";function Mt(i,t){i&1&&(n(0,"div",8),c(1,"mat-spinner",9),n(2,"p"),o(3,"Loading users..."),a()())}function vt(i,t){if(i&1&&(n(0,"div",10)(1,"mat-icon",11),o(2,"error_outline"),a(),n(3,"span"),o(4),a()()),i&2){let e=g();r(4),d(e.error)}}function xt(i,t){i&1&&(n(0,"th",29),o(1,"Name"),a())}function wt(i,t){if(i&1&&(n(0,"td",30)(1,"div",31)(2,"span",32),o(3),a(),n(4,"span",33),o(5),a()()()),i&2){let e=t.$implicit;r(3),d(e.name),r(2),d(e.email)}}function St(i,t){i&1&&(n(0,"th",29),o(1,"Email"),a())}function yt(i,t){if(i&1&&(n(0,"td",30),o(1),a()),i&2){let e=t.$implicit;r(),d(e.email)}}function At(i,t){i&1&&(n(0,"th",34),o(1,"Phone"),a())}function Pt(i,t){if(i&1&&(n(0,"td",30),o(1),a()),i&2){let e=t.$implicit;r(),d(e.phoneNumber)}}function Et(i,t){i&1&&(n(0,"th",29),o(1,"Joined"),a())}function kt(i,t){if(i&1&&(n(0,"td",30),o(1),E(2,"date"),a()),i&2){let e=t.$implicit;r(),d(k(2,1,e.joined,"mediumDate"))}}function It(i,t){i&1&&(n(0,"th",29),o(1,"Status"),a())}function Dt(i,t){if(i&1&&(n(0,"td",30)(1,"mat-chip",35),o(2),a()()),i&2){let e=t.$implicit;r(),m("color",e.status==="active"?"primary":"warn"),r(),_(" ",e.status," ")}}function Tt(i,t){i&1&&c(0,"th",34)}function Ut(i,t){if(i&1){let e=A();n(0,"td",36)(1,"button",37),P("click",function(){let u=w(e).$implicit,bt=g(2);return S(bt.toggleBanUser(u))}),n(2,"mat-icon"),o(3),a(),o(4),a()()}if(i&2){let e=t.$implicit;r(),m("color",e.status==="ACTIVE"?"warn":"primary")("matTooltip",e.status==="ACTIVE"?"Ban user":"Unban user"),r(2),_(" ",e.status==="ACTIVE"?"block":"lock_open"," "),r(),_(" ",e.status==="ACTIVE"?"Ban":"Unban"," ")}}function Ot(i,t){i&1&&c(0,"tr",38)}function Nt(i,t){i&1&&c(0,"tr",39)}function Rt(i,t){if(i&1&&(n(0,"div",12)(1,"table",13),p(2,14),s(3,xt,2,0,"th",15)(4,wt,6,2,"td",16),f(),p(5,17),s(6,St,2,0,"th",15)(7,yt,2,1,"td",16),f(),p(8,18),s(9,At,2,0,"th",19)(10,Pt,2,1,"td",16),f(),p(11,20),s(12,Et,2,0,"th",15)(13,kt,3,4,"td",16),f(),p(14,21),s(15,It,2,0,"th",15)(16,Dt,3,2,"td",16),f(),p(17,22),s(18,Tt,1,0,"th",19)(19,Ut,5,4,"td",23),f(),s(20,Ot,1,0,"tr",24)(21,Nt,1,0,"tr",25),a(),n(22,"div",26)(23,"div",27),o(24),a(),c(25,"mat-paginator",28),a()()),i&2){let e=g();r(),m("dataSource",e.data),r(19),m("matHeaderRowDef",e.cols),r(),m("matRowDefColumns",e.cols),r(3),d(e.rangeLabel()),r(),m("length",e.data.filteredData.length)("pageSize",e.pageSize)("hidePageSize",!0)}}var ht=class i{constructor(t,e){this.adminService=t;this.snack=e}cols=["name","email","phone","joined","status","actions"];pageSize=10;filterCtrl=new R("",{nonNullable:!0});data=new ut([]);loading=!0;error=null;paginator;sort;ngAfterViewInit(){this.fetchUsers(),this.data.paginator=this.paginator,this.data.sort=this.sort,this.data.sortingDataAccessor=(t,e)=>{switch(e){case"name":return t.name.toLowerCase();case"joined":return new Date(t.joined).getTime();default:return t[e]}},this.data.filterPredicate=(t,e)=>{let l=e.trim().toLowerCase();return t.name.toLowerCase().includes(l)||t.email.toLowerCase().includes(l)||(t.phoneNumber?.toLowerCase().includes(l)??!1)||t.status.toLowerCase().includes(l)},this.filterCtrl.valueChanges.subscribe(t=>{this.data.filter=(t??"").trim().toLowerCase(),this.data.paginator&&this.data.paginator.firstPage()})}fetchUsers(){this.loading=!0,this.error=null,this.adminService.getAllUsers().subscribe({next:t=>{this.data.data=t,this.loading=!1},error:()=>{this.error="Failed to load users",this.loading=!1}})}toggleBanUser(t){let e=t.status==="ACTIVE"?`Are you sure you want to ban ${t.name}?`:`Are you sure you want to unban ${t.name}?`;confirm(e)&&this.adminService.toggleBan(t.email).subscribe({next:l=>{t.status=t.status==="ACTIVE"?"BANNED":"ACTIVE",this.refresh(),this.snack.open("User status updated","OK",{duration:1200})},error:l=>{console.error(l),this.snack.open(l?.message||"Failed to toggle ban status","OK",{duration:1200})}})}refresh(){this.data.data=[...this.data.data]}rangeLabel=I(()=>{if(!this.paginator)return"";let t=this.data.filteredData.length,e=this.paginator.pageIndex*this.paginator.pageSize,l=Math.min(e+this.paginator.pageSize,t);return t?`Showing ${e+1}\u2013${l} of ${t}`:"No results"});static \u0275fac=function(e){return new(e||i)(b(it),b(G))};static \u0275cmp=y({type:i,selectors:[["admin-users"]],viewQuery:function(e,l){if(e&1&&(M(C,5),M(h,5)),e&2){let u;v(u=x())&&(l.paginator=u.first),v(u=x())&&(l.sort=u.first)}},decls:12,vars:4,consts:[[1,"title"],[1,"toolbar"],["appearance","outline",1,"search"],["matInput","","placeholder","Name, email, phone or status",3,"formControl"],["matSuffix",""],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],["class","table-wrap mat-elevation-z2",4,"ngIf"],[1,"loading"],["diameter","40"],[1,"error"],["color","warn"],[1,"table-wrap","mat-elevation-z2"],["mat-table","","matSort","",1,"glass-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","phone"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","joined"],["matColumnDef","status"],["matColumnDef","actions"],["mat-cell","","class","actions",4,"matCellDef"],["mat-header-row","","class","sticky",4,"matHeaderRowDef"],["mat-row","","class","row",4,"matRowDef","matRowDefColumns"],[1,"table-footer"],[1,"range"],["showFirstLastButtons","",3,"length","pageSize","hidePageSize"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"stack"],[1,"strong"],[1,"muted","email-under-name"],["mat-header-cell",""],[3,"color"],["mat-cell","",1,"actions"],["mat-stroked-button","",3,"click","color","matTooltip"],["mat-header-row","",1,"sticky"],["mat-row","",1,"row"]],template:function(e,l){e&1&&(n(0,"h2",0),o(1,"Users"),a(),n(2,"div",1)(3,"mat-form-field",2)(4,"mat-label"),o(5,"Search users"),a(),c(6,"input",3),n(7,"mat-icon",4),o(8,"searchh"),a()()(),s(9,Mt,4,0,"div",5)(10,vt,5,1,"div",6)(11,Rt,26,7,"div",7)),e&2&&(r(6),m("formControl",l.filterCtrl),r(3),m("ngIf",l.loading),r(),m("ngIf",l.error),r(),m("ngIf",!l.loading&&!l.error))},dependencies:[U,D,B,O,N,V,ft,nt,rt,st,ot,at,dt,lt,mt,ct,pt,gt,C,Ct,h,_t,H,F,$,j,J,K,z,L,q,Q,X,W,Z,Y,et,tt,T],styles:[".title[_ngcontent-%COMP%]{margin:0 0 .8rem}.toolbar[_ngcontent-%COMP%]{display:flex;gap:.6rem;align-items:center;margin-bottom:.8rem}.search[_ngcontent-%COMP%]{width:min(520px,100%)}.table-wrap[_ngcontent-%COMP%]{border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,#ffffff08,#ffffff05),#1018288c;-webkit-backdrop-filter:blur(12px) saturate(120%);backdrop-filter:blur(12px) saturate(120%)}[_nghost-%COMP%]     .mat-mdc-table, [_nghost-%COMP%]     .mat-mdc-paginator{background:transparent!important}table.glass-table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.85rem 1rem}th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:2;background:#ffffff0f;color:var(--text);font-weight:700;-webkit-backdrop-filter:blur(6px) saturate(120%);backdrop-filter:blur(6px) saturate(120%);border-bottom:1px solid rgba(255,255,255,.08)}tr.row[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:#ffffff08}tr.row[_ngcontent-%COMP%]:nth-child(2n)   td[_ngcontent-%COMP%]{background:#ffffff04}.stack[_ngcontent-%COMP%]{display:flex;flex-direction:column}.strong[_ngcontent-%COMP%]{font-weight:700}.muted[_ngcontent-%COMP%]{opacity:.8}.email-under-name[_ngcontent-%COMP%]{display:none}.actions[_ngcontent-%COMP%]{text-align:right;white-space:nowrap}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.55rem .75rem;border-top:1px solid rgba(255,255,255,.08);background:#0000001f;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.range[_ngcontent-%COMP%]{opacity:.85;font-size:.92rem}@media (max-width: 900px){th[mat-header-cell][_ngcontent-%COMP%]:nth-child(2), td[mat-cell][_ngcontent-%COMP%]:nth-child(2){display:none}.email-under-name[_ngcontent-%COMP%]{display:block}}.table-wrap[_ngcontent-%COMP%]{background:#ffffff14;border-radius:16px;overflow:hidden;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;margin-top:2rem}.error[_ngcontent-%COMP%]{color:#f44336;display:flex;align-items:center;justify-content:center;gap:8px}.table-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem}"]})};export{ht as AdminUsersComponent};
