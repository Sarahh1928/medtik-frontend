import{a as ae}from"./chunk-TQOOYVQA.js";import"./chunk-CBB6Q34Z.js";import"./chunk-3RK6DDJD.js";import{a as Y,b as Z,h as ee,i as te,m as oe,n as re}from"./chunk-FXUZVO2G.js";import{a as ce}from"./chunk-KADNFXRE.js";import"./chunk-XDTU2MFJ.js";import{a as ne,b as ie}from"./chunk-CQ63BDYT.js";import{A as J,b as B,f as W,k as $,m as z,v as U,w as G,x as H}from"./chunk-NZBL2PSU.js";import{T as K,Y as Q,Z as X}from"./chunk-YNMGB45N.js";import"./chunk-F426BNRH.js";import{h as j}from"./chunk-RXNQWMFM.js";import{Bb as P,Db as u,E,Fb as l,Gc as F,Hc as L,Ia as S,Ma as a,Pb as k,Qb as T,Rb as O,Rc as q,Sc as A,Tb as c,Ub as f,Vb as b,Wb as V,Xa as I,Yb as w,Zb as h,_b as y,ab as g,ea as v,ec as D,gc as N,ja as p,ka as _,lc as C,p as R,rb as s,sb as n,ta as M,tb as i,ub as x}from"./chunk-BE7DJT6W.js";function le(r,t){if(r&1&&(n(0,"mat-icon"),c(1,"star"),i()),r&2){let e=t.$implicit,o=l(2);O("active",e<=o.roundedAvg())}}function me(r,t){if(r&1&&(n(0,"div",17)(1,"span",18),c(2),i(),n(3,"div",19),x(4,"span"),i(),n(5,"span",20),c(6),i()()),r&2){let e=t.$implicit,o=l(2);a(2),b("",e,"\u2605"),a(2),T("width",o.distPercent(e),"%"),a(2),b("",o.distPercent(e),"%")}}function se(r,t){if(r&1&&(n(0,"section",9)(1,"div",10)(2,"div",11),c(3),D(4,"number"),i(),n(5,"div",12),g(6,le,2,2,"mat-icon",13),i(),n(7,"div",14),c(8),i()(),n(9,"div",15),g(10,me,7,4,"div",16),i()()),r&2){let e=t.ngIf,o=l();a(3),f(N(4,5,o.avg(),"1.1-1")),a(3),s("ngForOf",o.stars),a(2),V("",e," review",e>1?"s":""),a(2),s("ngForOf",o.stars.slice().reverse())}}function ge(r,t){r&1&&(n(0,"div",21)(1,"mat-icon"),c(2,"inbox"),i(),n(3,"div"),c(4,"No reviews found"),i()())}function pe(r,t){if(r&1&&(n(0,"mat-icon"),c(1,"star"),i()),r&2){let e=t.$implicit,o=l().$implicit;O("active",e<=o.rating)}}function _e(r,t){if(r&1&&(n(0,"div",3),c(1),i()),r&2){let e=l().$implicit;a(),f(e.title)}}function ue(r,t){r&1&&(n(0,"mat-error"),c(1," Rating is required "),i())}function fe(r,t){r&1&&(n(0,"mat-error"),c(1," Rating must be between 1 and 5 "),i())}function Ce(r,t){if(r&1){let e=P();n(0,"div",40)(1,"mat-form-field",41)(2,"mat-label"),c(3,"Rating (1\u20135)"),i(),n(4,"input",42,0),y("ngModelChange",function(d){p(e);let m=l(3);return h(m.editRating,d)||(m.editRating=d),_(d)}),u("ngModelChange",function(d){p(e);let m=l(3);return _(m.clampRating(d))}),i(),g(6,ue,2,0,"mat-error",43)(7,fe,2,0,"mat-error",43),i(),n(8,"mat-form-field",41)(9,"mat-label"),c(10,"Comment"),i(),n(11,"textarea",44),y("ngModelChange",function(d){p(e);let m=l(3);return h(m.editComment,d)||(m.editComment=d),_(d)}),i()(),n(12,"div",45)(13,"button",46),u("click",function(){p(e);let d=l(3);return _(d.cancelEdit())}),c(14,"Cancel"),i(),n(15,"button",47),u("click",function(){p(e);let d=l().$implicit,m=l(2);return _(m.saveEdit(d.id))}),c(16,"Save"),i()()()}if(r&2){let e=k(5),o=l(3);a(4),w("ngModel",o.editRating),a(2),s("ngIf",e.errors==null?null:e.errors.required),a(),s("ngIf",(e.errors==null?null:e.errors.min)||(e.errors==null?null:e.errors.max)),a(4),w("ngModel",o.editComment)}}function Me(r,t){if(r&1){let e=P();n(0,"article",24)(1,"div",25)(2,"div",26),x(3,"img",27),n(4,"div",28)(5,"div",29),c(6),i(),n(7,"div",30)(8,"span",12),g(9,pe,2,2,"mat-icon",13),i(),n(10,"span",31),c(11,"\u2022"),i(),n(12,"span",32),c(13),i()()()(),n(14,"div",33)(15,"button",34),u("click",function(){let d=p(e).$implicit,m=l(2);return _(m.startEdit(d))}),n(16,"mat-icon"),c(17,"edit"),i()(),n(18,"button",35),u("click",function(){let d=p(e).$implicit,m=l(2);return _(m.deleteReview(d.id))}),n(19,"mat-icon"),c(20,"delete"),i()()()(),n(21,"div",36),g(22,_e,2,1,"div",37),n(23,"p",38),c(24),i()(),g(25,Ce,17,4,"div",39),i()}if(r&2){let e=t.$implicit,o=l(2);a(3),s("src",e.avatarUrl,S),a(3),f(e.revieweeName),a(3),s("ngForOf",o.stars),a(4),f(o.dateLabel(e.createdAt)),a(9),s("ngIf",e.title),a(2),f(e.comment),a(),s("ngIf",o.editingId===e.id)}}function ve(r,t){if(r&1&&(n(0,"div",22),g(1,Me,26,7,"article",23),i()),r&2){let e=l();a(),s("ngForOf",e.filtered())}}var de=class r{service=v(ce);snackbar=v(ae);editingId=null;editRating=null;editComment="";all=M([]);loading=M(!0);error=M(null);query=M("");stars=[1,2,3,4,5];filtered=C(()=>{let t=this.query().trim().toLowerCase();return this.all().filter(e=>!t||e.revieweeName.toLowerCase().includes(t)||e.comment.toLowerCase().includes(t)||e.title?.toLowerCase().includes(t)).sort((e,o)=>new Date(o.createdAt).getTime()-new Date(e.createdAt).getTime())});count=C(()=>this.all().length);avg=C(()=>{let t=this.count();if(!t)return 0;let e=this.all().reduce((o,d)=>o+d.rating,0);return Math.round(e/t*10)/10});roundedAvg=C(()=>Math.round(this.avg()));dist=C(()=>{let t={1:0,2:0,3:0,4:0,5:0};for(let e of this.all())t[e.rating]++;return t});distPercent(t){let e=this.count();return e?Math.round((this.dist()[t]||0)/e*100):0}dateLabel(t){return new Date(t).toLocaleString(void 0,{year:"numeric",month:"short",day:"2-digit"})}ngOnInit(){this.loadReviews()}loadReviews(){this.loading.set(!0),this.error.set(null),this.service.getMyReviews().pipe(E(t=>(this.error.set("Failed to load reviews"),console.error(t),R([])))).subscribe(t=>{console.log("Loaded reviews:",t),this.all.set(t),this.loading.set(!1)})}startEdit(t){this.editingId=t.id,this.editRating=t.rating,this.editComment=t.comment}cancelEdit(){this.editingId=null,this.editRating=null,this.editComment=""}saveEdit(t){!this.editRating||this.editRating<1||this.editRating>5||this.service.submitUpdatedReview(t,this.editRating,this.editComment).subscribe({next:()=>{this.cancelEdit(),this.loadReviews()},error:e=>{console.error("Update failed:",e)}})}deleteReview(t){confirm("Are you sure you want to delete this review?")&&this.service.deleteReview(t).subscribe({next:()=>{this.loadReviews()},error:e=>{console.error("Delete failed:",e)}})}clampRating(t){t<1?this.editRating=1:t>5?this.editRating=5:this.editRating=t,this.snackbar.open("Rating must be between 1 and 5","Close",{duration:2e3})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-reviews"]],decls:14,vars:4,consts:[["ratingModel","ngModel"],[1,"reviews-wrap"],[1,"toolbar"],[1,"title"],["appearance","outline",1,"search"],["matInput","","placeholder","Doctor name, comment\u2026",3,"input","value"],["class","card summary",4,"ngIf"],["class","empty",4,"ngIf"],["class","list",4,"ngIf"],[1,"card","summary"],[1,"left"],[1,"avg"],[1,"stars"],[3,"active",4,"ngFor","ngForOf"],[1,"muted"],[1,"dist"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"label"],[1,"bar"],[1,"pct"],[1,"empty"],[1,"list"],["class","card item",4,"ngFor","ngForOf"],[1,"card","item"],[1,"head"],[1,"doc"],["alt","Doctor avatar",1,"avatar",3,"src"],[1,"who"],[1,"name"],[1,"meta"],[1,"dot"],[1,"date"],[1,"actions"],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],[1,"body"],["class","title",4,"ngIf"],[1,"comment"],["class","edit-form",4,"ngIf"],[1,"edit-form"],["appearance","outline",1,"full"],["matInput","","type","number","name","rating","required","","min","1","max","5",3,"ngModelChange","ngModel"],[4,"ngIf"],["matInput","","rows","3",3,"ngModelChange","ngModel"],[1,"edit-actions"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,o){e&1&&(n(0,"div",1)(1,"div",2)(2,"div",3)(3,"mat-icon"),c(4,"reviews"),i(),n(5,"h2"),c(6,"My Reviews"),i()(),n(7,"mat-form-field",4)(8,"mat-label"),c(9,"Search reviews"),i(),n(10,"input",5),u("input",function(m){return o.query.set(m.target.value)}),i()()(),g(11,se,11,8,"section",6)(12,ge,5,0,"div",7)(13,ve,2,1,"div",8),i()),e&2&&(a(10),s("value",o.query()),a(),s("ngIf",o.count()),a(),s("ngIf",!o.filtered().length),a(),s("ngIf",o.filtered().length))},dependencies:[A,F,L,j,ie,ne,X,Q,K,te,ee,Y,Z,re,oe,J,B,z,W,H,G,U,$,q],styles:[".rev-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .doctor[_ngcontent-%COMP%], .toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{min-width:220px}.toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{border-radius:999px;overflow:hidden}.summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:220px 1fr;gap:1rem;background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 25px #00000040}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.25rem;padding:.75rem}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .avg[_ngcontent-%COMP%]{font-size:42px;line-height:1;font-weight:800;letter-spacing:.2px}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]{display:flex;gap:.1rem}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{opacity:.35}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon.active[_ngcontent-%COMP%]{opacity:1}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]{display:grid;gap:.45rem;padding:.8rem .8rem .9rem}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;grid-template-columns:44px 1fr 44px;align-items:center;gap:.6rem}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{opacity:.8}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:10px;border-radius:999px;background:#ffffff0f;overflow:hidden}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;height:100%;background:linear-gradient(90deg,#2a76b7,#1db7a0)}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .pct[_ngcontent-%COMP%]{text-align:right;opacity:.9}.pending[_ngcontent-%COMP%]{margin-top:1rem}.pending[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .6rem}.pending[_ngcontent-%COMP%]   .strip[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-auto-columns:minmax(260px,1fr);gap:.75rem;overflow-x:auto;padding-bottom:.25rem}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]{display:grid;align-content:start;gap:.75rem;background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:.85rem;box-shadow:0 10px 25px #00000040}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.65rem}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;object-fit:cover}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:.9rem}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{justify-self:flex-start}.list[_ngcontent-%COMP%]{display:grid;gap:.9rem;margin-top:1rem}.item[_ngcontent-%COMP%]{background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:.9rem;box-shadow:0 10px 25px #00000040}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:.9rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]{display:flex;gap:.1rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{opacity:.35}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon.active[_ngcontent-%COMP%]{opacity:1}.item[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{margin-top:.5rem}.item[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:.2rem}.item[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{opacity:.95}.item[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-top:.6rem;display:flex;align-items:center;justify-content:space-between;gap:.75rem}.item[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.4rem}.empty[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.4rem;padding:1.5rem;border:1px dashed rgba(255,255,255,.1);border-radius:16px;opacity:.8}.mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important;line-height:1!important}.mat-mdc-form-field[_ngcontent-%COMP%]{--mat-form-field-container-vertical-padding: 15px}.actions[_ngcontent-%COMP%]{display:flex;gap:.4rem}.edit-form[_ngcontent-%COMP%]{margin-top:.8rem;background:#ffffff08;border-radius:12px;padding:.8rem;display:grid;gap:.6rem}.edit-form[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}"]})};export{de as ReviewsComponent};
