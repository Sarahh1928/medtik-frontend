import{$ as n,Nc as m,Sc as i,T as d,Tc as f,W as c,l as g,o as h,ya as u,z as r}from"./chunk-HKUWCROW.js";import{a as p,b as l}from"./chunk-JKOY2XUY.js";var a={production:!0,apiBaseUrl:"https://medtik-backend.onrender.com/api",socketUrl:"https://medtik-backend.onrender.com"};var R=class o{http=n(f);platformId=n(u);isBrowser=m(this.platformId);baseUrl=a.apiBaseUrl;tokenKey="medtik_token";isProd=a.production;registerPatient(t){return this.http.post(`${this.baseUrl}/auth/register-patient`,t,this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}verifyOtp(t){return this.http.post(`${this.baseUrl}/auth/verify-otp`,t,this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}login(t){return this.http.post(`${this.baseUrl}/auth/login`,t,this.getHttpOptions()).pipe(d(e=>{console.log("\u{1F7E9} Raw response from backend:",e),!this.isProd&&e?.token&&this.setToken(e.token)}),h(e=>{let s=l(p({},e),{role:e?.token?this.extractRoleFromToken(e.token):null,doctorStatus:e?.doctorStatus??null});return console.log("\u{1F7E6} Transformed response after map:",s),s}),r(e=>this.handleError(e)))}resendOtp(t){return this.http.post(`${this.baseUrl}/auth/resend-otp`,{email:t},this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}changePassword(t){let e=this.isProd?void 0:new i({"Content-Type":"application/json",Authorization:`Bearer ${this.getToken()??""}`});return this.http.post(`${this.baseUrl}/auth/change-password`,t,this.isProd?{withCredentials:!0}:{headers:e}).pipe(r(s=>this.handleError(s)))}logout(){return this.http.post(`${this.baseUrl}/auth/logout`,{},this.getHttpOptions()).pipe(r(t=>this.handleError(t)))}getToken(){return this.isBrowser?localStorage.getItem(this.tokenKey):null}clearToken(){this.isBrowser&&localStorage.removeItem(this.tokenKey)}setToken(t){this.isBrowser&&localStorage.setItem(this.tokenKey,t)}getCurrentRole(){if(!this.isBrowser)return null;let t=this.getToken();return t?this.extractRoleFromToken(t):null}extractRoleFromToken(t){try{let e=t.split(".")[1];if(!e)return null;let s=e.replace(/-/g,"+").replace(/_/g,"/"),y=atob(s);return JSON.parse(y)?.role??null}catch(e){return console.warn("Failed to decode JWT role",e),null}}getHttpOptions(){return this.isProd?{withCredentials:!0}:{headers:new i({"Content-Type":"application/json",Authorization:`Bearer ${this.getToken()??""}`})}}handleError(t){let e="Something went wrong. Please try again.";return t.error?typeof t.error=="string"?e=t.error:typeof t.error=="object"&&(e=t.error.error??t.error.message??e):t.message&&(e=t.message),g(()=>e)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{a,R as b};
