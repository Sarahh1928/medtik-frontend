import{a as ae}from"./chunk-GWAIMEWH.js";import{a as ie}from"./chunk-QSXO73WB.js";import{c as G}from"./chunk-22LPJILQ.js";import{a as ee}from"./chunk-HFQD2M5G.js";import"./chunk-3GWAQ66N.js";import"./chunk-3RK6DDJD.js";import{a as Y,b as W,e as H,h as J,i as K,m as Z,n as $}from"./chunk-WLFKFW6S.js";import"./chunk-GGQ7LRWG.js";import{a as oe}from"./chunk-3O7N6AIM.js";import"./chunk-6ZCLRSJ3.js";import{c as v,d as y,f as c,g as C,h as re,i as ne}from"./chunk-NQP6NLRO.js";import"./chunk-A7RO7YMV.js";import{a as Q,b as X}from"./chunk-4P6M4J7Y.js";import{d as I,e as T,h as L}from"./chunk-LC7HZC43.js";import"./chunk-YXOZBBHG.js";import{A as U,b as N,d as p,f as B,g as D,l as R,o as F,r as A,y as q}from"./chunk-CCREW7CN.js";import{b as te}from"./chunk-X74WTQLY.js";import{T as z,Y as j,Z as V}from"./chunk-WXJKX6WL.js";import{$b as x,Nb as l,Ob as i,Pb as t,Qb as u,Xb as k,Zb as h,_a as a,db as b,fa as s,gd as O,kb as P,la as M,ma as S,nc as r,oc as _,pb as g,pc as E,rd as w}from"./chunk-PCHMKQLW.js";function le(o,m){o&1&&(i(0,"mat-error"),r(1,"Email is required"),t())}function se(o,m){o&1&&(i(0,"mat-error"),r(1,"Enter a valid email"),t())}function pe(o,m){o&1&&(i(0,"mat-error"),r(1,"Password is required"),t())}function ce(o,m){o&1&&(i(0,"mat-error"),r(1,"Min 6 characters"),t())}function de(o,m){if(o&1&&(i(0,"p",22),r(1),t()),o&2){let e=x();a(),_(e.apiError)}}function fe(o,m){if(o&1){let e=k();i(0,"button",23),h("click",function(){M(e);let d=x();return S(d.goToOtp())}),r(1," Verify with OTP "),t()}}var me=class o{constructor(m,e){this.socketService=m;this.adminSocketService=e}fb=s(q);router=s(I);auth=s(te);snackBar=s(ee);doctorProfile=s(ie,{optional:!0});hide=!0;loading=!1;apiError=null;otpRequired=!1;form=this.fb.group({email:["",[p.required,p.email]],password:["",[p.required,p.minLength(6)]]});submit(){if(this.form.invalid){this.form.markAllAsTouched();return}let m={email:(this.form.value.email??"").trim().toLowerCase(),password:this.form.value.password??""};this.loading=!0,this.apiError=null,this.auth.login(m).subscribe({next:e=>{this.loading=!1,console.log("Login result:",e),e.token&&e.role==="ADMIN"?this.adminSocketService.connect():e.token&&this.socketService.connect(e.id,e.role);let n=this.routeForRole(e.role);if(e.role==="DOCTOR"&&this.doctorProfile){this.doctorProfile.refreshProfile().subscribe({next:d=>{let f=e.doctorStatus;console.log("Doctor status:",e),f==="NEW"||f==="REJECTED"?(console.log("\u{1FA7A} Navigating to profile setup...",e),this.router.navigateByUrl("/doctor/profile")):f==="PENDING"?this.snackBar.open("Your profile is still pending approval. Please wait for admin confirmation.","Close",{duration:5e3}):f==="ACCEPTED"&&(this.doctorProfile?.markAsUnlocked(),console.log("\u{1FA75} Navigating to dashboard..."),this.router.navigateByUrl("/doctor/dashboard"))},error:()=>this.router.navigateByUrl(n)});return}this.router.navigateByUrl(n)},error:e=>{if(this.loading=!1,this.apiError=e,console.log("Login error:",e),console.log(e==="Please verify your account with OTP first."),e==="Please verify your account with the OTP sent to your email and phone."||e==="Your OTP expired. A new one has been sent to your email and phone."){let n=this.form.value.email?.trim();localStorage.setItem("otpEmail",n?.toString()??""),this.router.navigateByUrl("/auth/otp")}}})}routeForRole(m){switch(m){case"ADMIN":return"/admin";case"DOCTOR":return"/doctor";default:return"/patient"}}goToOtp(){let m=this.form.value.email?.trim();this.router.navigateByUrl("/auth/otp")}static \u0275fac=function(e){return new(e||o)(b(oe),b(ae))};static \u0275cmp=P({type:o,selectors:[["app-login"]],decls:54,vars:13,consts:[[1,"auth-shell"],[1,"auth-frame"],[1,"hero-pane"],[1,"brand"],["src","https://ik.imagekit.io/a2wpi1kd9/imgToUrl/image-to-url_HEow9eLbR","alt","Medtik",1,"brand-mark"],[1,"tag"],[1,"benefits"],[1,"form-pane"],[1,"sub"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"stagger"],["matInput","","type","email","formControlName","email","autocomplete","email"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","password","autocomplete","current-password",3,"type"],["mat-icon-button","","matSuffix","","type","button","aria-label","Toggle password",3,"click"],["class","api-error","role","alert",4,"ngIf"],["mat-stroked-button","","color","accent",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","submit",1,"submit","stagger",3,"disabled"],[1,"aux","stagger",2,"display","flex","justify-content","space-between","align-items","center","margin-top","16px"],["routerLink","/auth/forgot",1,"forgot-link"],["mat-stroked-button","","color","primary","routerLink","/auth/sign-up"],["role","alert",1,"api-error"],["mat-stroked-button","","color","accent",3,"click"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"aside",2)(3,"div",3),u(4,"img",4),i(5,"h1"),r(6,"Medtik"),t(),i(7,"p",5),r(8,"Care that comes to you"),t()(),i(9,"ul",6)(10,"li")(11,"mat-icon"),r(12,"military_tech"),t(),r(13," Best doctors in the middle east"),t(),i(14,"li")(15,"mat-icon"),r(16,"videocam"),t(),r(17," Chat, voice, or video - your choice"),t(),i(18,"li")(19,"mat-icon"),r(20,"payments"),t(),r(21," Secure, verified checkout with Paymob"),t()()(),i(22,"main",7)(23,"h2"),r(24,"Welcome back"),t(),i(25,"p",8),r(26,"Sign in to manage your consultations"),t(),i(27,"form",9),h("ngSubmit",function(){return n.submit()}),i(28,"mat-form-field",10)(29,"mat-label"),r(30,"Email"),t(),u(31,"input",11),i(32,"mat-icon",12),r(33,"mail"),t(),g(34,le,2,0,"mat-error",13)(35,se,2,0,"mat-error",13),t(),i(36,"mat-form-field",10)(37,"mat-label"),r(38,"Password"),t(),u(39,"input",14),i(40,"button",15),h("click",function(){return n.hide=!n.hide}),i(41,"mat-icon"),r(42),t()(),g(43,pe,2,0,"mat-error",13)(44,ce,2,0,"mat-error",13),t(),g(45,de,2,1,"p",16)(46,fe,2,0,"button",17),i(47,"button",18),r(48),t()(),i(49,"div",19)(50,"a",20),r(51,"Forgot password?"),t(),i(52,"button",21),r(53," Sign up "),t()()()()()),e&2&&(l("@flyIn",void 0),a(22),l("@staggerIn",void 0),a(5),l("formGroup",n.form),a(7),l("ngIf",n.form.controls.email.hasError("required")),a(),l("ngIf",n.form.controls.email.hasError("email")),a(4),l("type",n.hide?"password":"text"),a(3),_(n.hide?"visibility":"visibility_off"),a(),l("ngIf",n.form.controls.password.hasError("required")),a(),l("ngIf",n.form.controls.password.hasError("minlength")),a(),l("ngIf",n.apiError),a(),l("ngIf",n.otpRequired),a(),l("disabled",n.loading),a(),E(" ",n.loading?"Signing in...":"Sign in"," "))},dependencies:[w,O,U,R,N,B,D,F,A,L,T,G,K,J,Y,W,H,$,Z,V,j,z,X,Q],styles:['@charset "UTF-8";.auth-shell[_ngcontent-%COMP%]{min-height:100svh;display:flex;align-items:center;justify-content:center;padding:clamp(16px,4vmin,32px)}.auth-frame[_ngcontent-%COMP%]{width:min(960px,96vw);max-height:88svh;overflow:hidden;display:grid;grid-template-columns:1.15fr 1fr;border-radius:24px;background:linear-gradient(180deg,#ffffff08,#ffffff05),#101828b8;-webkit-backdrop-filter:blur(10px) saturate(120%);backdrop-filter:blur(10px) saturate(120%);border:1px solid rgba(255,255,255,.08);box-shadow:0 24px 70px #00000080}.hero-pane[_ngcontent-%COMP%]{position:relative;padding:28px 24px;border-right:1px solid rgba(255,255,255,.06)}.hero-pane[_ngcontent-%COMP%]:before, .hero-pane[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:-20%;background:radial-gradient(40% 35% at 20% 15%,rgba(42,118,183,.28),transparent 60%),radial-gradient(35% 30% at 80% 10%,rgba(29,183,160,.22),transparent 60%),radial-gradient(45% 40% at 60% 80%,rgba(42,118,183,.16),transparent 70%);filter:blur(14px);animation:_ngcontent-%COMP%_drift 16s linear infinite;pointer-events:none;z-index:0}.hero-pane[_ngcontent-%COMP%]:after{animation-duration:22s;animation-direction:reverse;opacity:.7}@keyframes _ngcontent-%COMP%_drift{0%{transform:translate3d(-2%,0,0) rotate(0)}50%{transform:translate3d(2%,1%,0) rotate(4deg)}to{transform:translate3d(-2%,0,0) rotate(0)}}.brand[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;place-items:center;gap:.35rem;margin-bottom:.75rem;text-align:center}.brand-mark[_ngcontent-%COMP%]{width:110px;height:110px;object-fit:contain;filter:drop-shadow(0 10px 24px rgba(42,118,183,.6))}.brand[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.45rem;letter-spacing:.3px;font-weight:800;color:#e6eef6}.tag[_ngcontent-%COMP%]{margin:0;color:#a7b4c5}.benefits[_ngcontent-%COMP%]{position:relative;z-index:1;list-style:none;margin:1rem 0 0;padding:0;display:grid;gap:.5rem}.benefits[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.55rem .65rem;border:1px solid rgba(255,255,255,.06);background:#ffffff05;border-radius:12px;color:#d4dce8}.benefits[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;height:18px;width:18px;color:#8fc7ff}.form-pane[_ngcontent-%COMP%]{padding:28px 20px;display:grid;align-content:start}.form-pane[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:.25rem 0 0;font-weight:800;font-size:clamp(1.25rem,2.2vw,1.6rem);color:#e6eef6}.form-pane[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{margin:.2rem 0 1rem;color:#a7b4c5}form[_ngcontent-%COMP%]{display:grid;gap:.8rem}.submit[_ngcontent-%COMP%]{width:100%;border-radius:12px;margin-top:.25rem}.aux[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:.25rem}.aux[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#a7b4c5;text-decoration:none}.aux[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#e6eaf2}@media (max-width: 900px){.auth-frame[_ngcontent-%COMP%]{grid-template-columns:1fr;max-height:unset}.hero-pane[_ngcontent-%COMP%]{border-right:0;border-bottom:1px solid rgba(255,255,255,.06)}.brand-mark[_ngcontent-%COMP%]{width:120px;height:120px}}@media (max-width: 480px){.auth-frame[_ngcontent-%COMP%]{width:94vw}.hero-pane[_ngcontent-%COMP%], .form-pane[_ngcontent-%COMP%]{padding:18px 14px}}.api-error[_ngcontent-%COMP%]{color:#f44336;font-size:.85rem;margin:-.25rem 0 .5rem}'],data:{animation:[v("flyIn",[C(":enter",[c({opacity:0,transform:"translateY(16px) scale(.98)"}),y("500ms cubic-bezier(.2,.8,.2,1)",c({opacity:1,transform:"none"}))])]),v("staggerIn",[C(":enter",[re(".stagger",[c({opacity:0,transform:"translateY(10px)"}),ne(60,y("380ms ease-out",c({opacity:1,transform:"none"})))])])])]}})};export{me as LoginComponent};
