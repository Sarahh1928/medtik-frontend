import"./chunk-BC57U3EU.js";import{a as W,b as Z}from"./chunk-OQ674PF3.js";import"./chunk-F5X5MWHG.js";import{b as X}from"./chunk-XGLVXY7I.js";import{a as q,b as H}from"./chunk-Y5ANY4EP.js";import"./chunk-4K5T2QBN.js";import"./chunk-BR5LHSVS.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import"./chunk-YN6JIHUF.js";import{a as Q}from"./chunk-SYFUGY5Q.js";import"./chunk-JQ5JD7Q3.js";import{a as J,b as K}from"./chunk-W6QHVSTW.js";import{Y,Z as G}from"./chunk-YSTQL2PO.js";import{d as j,e as z,h as B}from"./chunk-QJG5D5WU.js";import{$ as v,$b as S,Ac as R,Bc as $,Da as b,Ga as c,Hc as L,Jb as y,Mc as F,Nb as o,Ob as s,Pb as E,Ra as U,Wa as C,Zb as k,_b as A,bc as T,ea as f,fa as u,fc as I,lb as p,mb as a,nb as n,oa as h,ob as P,vb as w,xb as x,zb as m,zc as V}from"./chunk-HKUWCROW.js";import{a as D,b as N}from"./chunk-JKOY2XUY.js";var et=r=>["/patient/booking",r],nt=r=>["/patient/chat",r];function it(r,e){r&1&&(a(0,"mat-icon"),o(1,"payment"),n())}function ot(r,e){r&1&&(a(0,"mat-icon"),o(1,"schedule"),n())}function at(r,e){r&1&&(a(0,"mat-icon"),o(1,"check_circle"),n())}function rt(r,e){r&1&&(a(0,"mat-icon"),o(1,"cancel"),n())}function ct(r,e){r&1&&(a(0,"mat-icon"),o(1,"report"),n())}function pt(r,e){if(r&1){let t=w();a(0,"div",10)(1,"div",11),P(2,"img",12),a(3,"div",13)(4,"div",14),o(5),n(),a(6,"div",15)(7,"span",16),o(8),n()()()(),a(9,"div",17)(10,"span",18),C(11,it,2,0,"mat-icon",19)(12,ot,2,0,"mat-icon",19)(13,at,2,0,"mat-icon",19)(14,rt,2,0,"mat-icon",19)(15,ct,2,0,"mat-icon",19),o(16),n(),a(17,"span",20),A(18,"lowercase"),o(19),n()(),a(20,"div",21)(21,"button",22),x("click",function(){let d=f(t).$implicit,l=m(2);return u(l.join(d))}),a(22,"mat-icon"),o(23,"play_circle"),n(),o(24," Join now "),n(),a(25,"button",23),x("click",function(){let d=f(t).$implicit,l=m(2);return u(l.reschedule(d))}),a(26,"mat-icon"),o(27,"calendar_month"),n(),o(28," Reschedule "),n(),a(29,"button",23),x("click",function(){let d=f(t).$implicit,l=m(2);return u(l.addToCalendar(d))}),a(30,"mat-icon"),o(31,"event"),n(),o(32," Add to calendar "),n(),a(33,"button",24),x("click",function(){let d=f(t).$implicit,l=m(2);return u(l.cancel(d))}),a(34,"mat-icon"),o(35,"cancel"),n(),o(36," Cancel "),n()()()}if(r&2){let t=e.$implicit,i=m(2);c(2),p("src",t.doctor.avatarUrl,b),c(3),s(t.doctor.fullName||"Doctor"),c(3),s(i.toLocal(t.date)),c(2),p("ngClass",i.statusClass(t)),c(),p("ngIf",t.status==="PENDING_PAYMENT"),c(),p("ngIf",t.status==="scheduled"),c(),p("ngIf",t.status==="completed"),c(),p("ngIf",t.status==="canceled"),c(),p("ngIf",t.status==="no_show"),c(),E(" ",t.status," "),c(),p("ngClass",S(18,13,t.appointmentType)),c(2),s(t.appointmentType),c(2),p("disabled",t.status!=="scheduled")}}function dt(r,e){if(r&1&&(a(0,"div",8),C(1,pt,37,15,"div",9),n()),r&2){let t=m();c(),p("ngForOf",t.upcoming())}}function lt(r,e){r&1&&(a(0,"div",25)(1,"mat-icon"),o(2,"event_busy"),n(),P(3,"br"),o(4," No upcoming appointments "),n())}function mt(r,e){if(r&1){let t=w();a(0,"div",27)(1,"div",11),P(2,"img",12),a(3,"div",13)(4,"div",14),o(5),n(),a(6,"div",15)(7,"span",28),o(8),n(),a(9,"span",29),o(10,"\u2022"),n(),a(11,"span",16),o(12),n()()()(),a(13,"div",17)(14,"span",18),o(15),n(),a(16,"span",20),A(17,"lowercase"),o(18),n()(),a(19,"div",21)(20,"button",23),x("click",function(){let d=f(t).$implicit,l=m(2);return u(l.addToCalendar(d))}),a(21,"mat-icon"),o(22,"event"),n(),o(23," Save event "),n(),a(24,"button",30)(25,"mat-icon"),o(26,"refresh"),n(),o(27," Book again "),n(),a(28,"button",30)(29,"mat-icon"),o(30,"chat"),n(),o(31," Chat With Doctor "),n()()()}if(r&2){let t=e.$implicit,i=m(2);c(2),p("src",t.doctor.avatarUrl,b),c(3),s(t.doctor.fullName||"Doctor"),c(3),s(t.doctor.department||t.doctor.title),c(4),s(i.toLocal(t.date)),c(2),p("ngClass",i.statusClass(t)),c(),E(" ",t.status," "),c(),p("ngClass",S(17,10,t.appointmentType)),c(2),s(t.appointmentType),c(6),p("routerLink",k(12,et,t.doctor.userId)),c(4),p("routerLink",k(14,nt,t.doctor.userId))}}function st(r,e){if(r&1&&(a(0,"div",8),C(1,mt,32,16,"div",26),n()),r&2){let t=m();c(),p("ngForOf",t.past())}}function gt(r,e){r&1&&(a(0,"div",25)(1,"mat-icon"),o(2,"hourglass_empty"),n(),a(3,"div"),o(4,"No past appointments"),n()())}var tt=class r{router=v(j);snack=v(q);service=v(Q);all=h([]);loading=h(!0);now=h(Date.now());_timer=setInterval(()=>this.now.set(Date.now()),1e3);ngOnInit(){this.fetchAppointments()}ngOnDestroy(){clearInterval(this._timer)}fetchAppointments(){this.loading.set(!0),this.service.getAppointments().subscribe({next:e=>{console.log("Appointments from API:",e);let t=e.map(i=>({id:i.id,doctorId:i.doctorId,patientId:i.patientId,date:i.date,appointmentType:i.appointmentType,status:i.status||"scheduled",notes:i.notes??null,doctor:{userId:i.doctor.userId,id:i.doctor.id,title:i.doctor.title,fullName:i.doctor.fullName,phone:i.doctor.phone,department:i.doctor.department??null,avatarUrl:i.doctor.avatarUrl??null}}));this.all.set(t),this.loading.set(!1)},error:e=>{console.error(e),this.snack.open("Failed to load appointments","Close",{duration:4e3}),this.loading.set(!1)}})}chat(e){let t=e.doctor.id;this.router.navigate(["/chat",t])}upcoming=I(()=>Array.isArray(this.all())?this.all().filter(e=>new Date(e.date).getTime()>=this.now()).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()):[]);past=I(()=>Array.isArray(this.all())?this.all().filter(e=>new Date(e.date).getTime()<this.now()).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()):[]);toLocal=e=>new Date(e).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});statusClass(e){return{scheduled:e.status==="scheduled",completed:e.status==="completed",canceled:e.status==="canceled",no_show:e.status==="no_show",pending_payment:e.status==="PENDING_PAYMENT"}}canJoin(e){if(e.status!=="scheduled")return!1;let t=new Date(e.date).getTime();return this.now()>=t-600*1e3}countdown(e){let t=this.now(),i=new Date(e.date).getTime()-t;if(i<=0)return"Starts soon";let d=Math.floor(i/6e4),l=Math.floor(i%6e4/1e3),M=g=>g<10?"0"+g:g;return`${M(d)}:${M(l)}`}join(e){this.canJoin(e)&&this.snack.open("Join link not available","OK",{duration:2e3})}reschedule(e){console.log("Rescheduling appointment:",e),this.router.navigate(["/patient/reschedule",e.id],{queryParams:{appointmentId:e.id}})}cancel(e){confirm("Cancel this appointment?")&&this.service.cancelSlot(Number(e.id)).subscribe({next:()=>{this.all.update(t=>t.map(i=>i.id===e.id?N(D({},i),{status:"canceled"}):i)),this.snack.open("Appointment canceled","OK",{duration:1800})},error:t=>{console.error("Cancel failed",t),this.snack.open("Failed to cancel appointment","Close",{duration:2500})}})}addToCalendar(e){let t=O=>O<10?"0"+O:O,i=O=>{let _=new Date(O);return _.getUTCFullYear().toString()+t(_.getUTCMonth()+1)+t(_.getUTCDate())+"T"+t(_.getUTCHours())+t(_.getUTCMinutes())+t(_.getUTCSeconds())+"Z"},d=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//YourApp//Appointments//EN","BEGIN:VEVENT",`UID:${e.id}@yourapp`,`DTSTAMP:${i(new Date().toISOString())}`,`DTSTART:${i(e.date)}`,`SUMMARY:${e.appointmentType} with ${e.doctor.title}`,`DESCRIPTION:Doctor: ${e.doctor.title}
Department: ${e.doctor.department||""}
Status: ${e.status}`,"END:VEVENT","END:VCALENDAR"].join(`\r
`),l=new Blob([d],{type:"text/calendar;charset=utf-8"}),M=URL.createObjectURL(l),g=document.createElement("a");g.href=M,g.download=`appointment-${e.id}.ics`,g.click(),URL.revokeObjectURL(M)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=U({type:r,selectors:[["app-appointments"]],decls:24,vars:4,consts:[["emptyUpcoming",""],["emptyPast",""],[1,"appt-wrap"],[1,"toolbar"],[1,"title"],[1,"block"],[1,"block-title"],["class","grid",4,"ngIf","ngIfElse"],[1,"grid"],["class","card neon",4,"ngFor","ngForOf"],[1,"card","neon"],[1,"head"],["alt","",1,"avatar",3,"src"],[1,"info"],[1,"name"],[1,"meta"],[1,"when"],[1,"tags"],[1,"pill","status",3,"ngClass"],[4,"ngIf"],[1,"pill","modality",3,"ngClass"],[1,"row-actions"],["mat-flat-button","","color","primary",1,"join",3,"click","disabled"],["mat-stroked-button","",3,"click"],["mat-button","","color","warn",3,"click"],[1,"empty"],["class","card glass",4,"ngFor","ngForOf"],[1,"card","glass"],[1,"dept"],[1,"dot"],["mat-stroked-button","",3,"routerLink"]],template:function(t,i){if(t&1&&(a(0,"div",2)(1,"div",3)(2,"div",4)(3,"mat-icon"),o(4,"event_note"),n(),a(5,"h2"),o(6,"Appointments"),n()()(),a(7,"section",5)(8,"h3",6)(9,"mat-icon"),o(10,"schedule"),n(),o(11," Upcoming "),n(),C(12,dt,2,1,"div",7)(13,lt,5,0,"ng-template",null,0,T),n(),P(15,"mat-divider"),a(16,"section",5)(17,"h3",6)(18,"mat-icon"),o(19,"history"),n(),o(20," Past "),n(),C(21,st,2,1,"div",7)(22,gt,5,0,"ng-template",null,1,T),n()()),t&2){let d=y(14),l=y(23);c(12),p("ngIf",i.upcoming().length)("ngIfElse",d),c(9),p("ngIf",i.past().length)("ngIfElse",l)}},dependencies:[F,V,R,$,B,z,K,J,G,Y,X,Z,W,H,L],styles:[".appt-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.block[_ngcontent-%COMP%]{margin:.25rem 0 1rem}.block-title[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;margin:0 0 .7rem;font-weight:700}.block-title[_ngcontent-%COMP%]   .glow-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:999px;display:inline-block;box-shadow:0 0 16px currentColor}.block-title[_ngcontent-%COMP%]   .glow-dot.up[_ngcontent-%COMP%]{background:#7ea6ff;color:#7ea6ff}.block-title[_ngcontent-%COMP%]   .glow-dot.past[_ngcontent-%COMP%]{background:#9fa6b2;color:#9fa6b2}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(2,minmax(0,1fr))}@media (max-width: 1000px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.card[_ngcontent-%COMP%]{background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 25px #00000040;padding:.85rem;transition:transform .16s ease,background .16s ease,border-color .16s ease,box-shadow .16s ease}.card.neon[_ngcontent-%COMP%]{box-shadow:0 10px 25px #00000040,0 0 24px #5591ff26 inset}.card.glass[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);background:linear-gradient(180deg,#ffffff08,#ffffff05)}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);background:#ffffff0a;border-color:#ffffff1f}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto;gap:.75rem;align-items:center}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;object-fit:cover}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{opacity:.85;display:flex;gap:.35rem;align-items:center;flex-wrap:wrap}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{opacity:.5}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{text-align:right}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]   .val[_ngcontent-%COMP%]{font-weight:800}.card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{opacity:.7;font-size:.85rem}.card[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.6rem;align-items:center;flex-wrap:wrap}.card[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]{padding:.2rem .5rem;border-radius:999px;font-size:.75rem;border:1px solid rgba(255,255,255,.1);background:#ffffff0f;text-transform:capitalize}.card[_ngcontent-%COMP%]   .pill.modality.chat[_ngcontent-%COMP%]{border-color:#5591ff80;background:#5591ff1f}.card[_ngcontent-%COMP%]   .pill.modality.voice[_ngcontent-%COMP%]{border-color:#42d39280;background:#42d3921f}.card[_ngcontent-%COMP%]   .pill.modality.video[_ngcontent-%COMP%]{border-color:#b78cff80;background:#b78cff1f}.card[_ngcontent-%COMP%]   .status.scheduled[_ngcontent-%COMP%]{border-color:#5591ff66;background:#5591ff1a}.card[_ngcontent-%COMP%]   .status.completed[_ngcontent-%COMP%]{border-color:#42d39266;background:#42d3921a}.card[_ngcontent-%COMP%]   .status.canceled[_ngcontent-%COMP%]{border-color:#ff787866;background:#ff78781a}.card[_ngcontent-%COMP%]   .status.no_show[_ngcontent-%COMP%]{border-color:#ffba7866;background:#ffba781a}.card[_ngcontent-%COMP%]   .countdown[_ngcontent-%COMP%]{margin-left:auto;font-weight:700;opacity:.85}.card[_ngcontent-%COMP%]   .row-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.7rem}.card[_ngcontent-%COMP%]   .row-actions[_ngcontent-%COMP%]   .join[_ngcontent-%COMP%]{font-weight:700}.card[_ngcontent-%COMP%]   .kv[_ngcontent-%COMP%]{margin-top:.5rem;display:grid;gap:.35rem;grid-template-columns:repeat(3,minmax(0,1fr))}.card[_ngcontent-%COMP%]   .kv[_ngcontent-%COMP%]   .k[_ngcontent-%COMP%]{opacity:.75;margin-right:.35rem}@media (max-width: 800px){.card[_ngcontent-%COMP%]   .kv[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media (max-width: 520px){.card[_ngcontent-%COMP%]   .kv[_ngcontent-%COMP%]{grid-template-columns:1fr}}.empty[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.4rem;padding:.6rem .75rem;border-radius:10px;border:1px dashed rgba(255,255,255,.15);opacity:.8}.appt-wrap[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0}.appt-wrap[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.appt-wrap[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.6rem;font-weight:600}.appt-wrap[_ngcontent-%COMP%]   .grid[_ngcontent-%COMP%]{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));margin-top:12px}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:12px;border-radius:12px}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]{display:flex;gap:12px}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;object-fit:cover}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.85rem;color:#888;display:flex;gap:4px;align-items:center}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]{margin-top:8px;display:flex;gap:6px;flex-wrap:wrap}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:2px 6px;font-size:.75rem;border-radius:6px}.appt-wrap[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .row-actions[_ngcontent-%COMP%]{margin-top:10px;display:flex;flex-wrap:wrap;gap:6px}.appt-wrap[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;font-size:1rem;color:#666}.appt-wrap[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:8px}"]})};export{tt as AppointmentsComponent};
