import{a as se}from"./chunk-6O75L666.js";import{a as re}from"./chunk-GSNOPASS.js";import{a as le}from"./chunk-LVHP3QQG.js";import{c as H}from"./chunk-M4CUV4U7.js";import"./chunk-GGQ7LRWG.js";import{c as k,d as S,f as d,g as M,h as ae,i as me}from"./chunk-NQP6NLRO.js";import{a as ne}from"./chunk-Y5ANY4EP.js";import"./chunk-4K5T2QBN.js";import{a as J,b as K,e as Q,h as X,i as Z,m as oe,n as ie}from"./chunk-LCR2LKFI.js";import"./chunk-TR43TC6U.js";import{A as G,b as F,d as p,f as A,g as q,l as j,o as U,r as z,y as V}from"./chunk-YN6JIHUF.js";import{a as C,b}from"./chunk-JQ5JD7Q3.js";import{a as ee,b as te}from"./chunk-W6QHVSTW.js";import{T as Y,Y as W,Z as $}from"./chunk-YSTQL2PO.js";import{d as D,e as R,h as B}from"./chunk-QJG5D5WU.js";import{$ as c,Bc as L,Ga as m,Ka as x,Mc as N,Nb as i,Ob as y,Pb as T,Ra as E,W as P,Wa as g,ea as O,fa as w,lb as l,mb as o,nb as t,ob as u,vb as I,xb as h,zb as _}from"./chunk-HKUWCROW.js";import"./chunk-JKOY2XUY.js";var v=class r{socket=null;authService=c(b);connect(){let a=C.production,e=this.authService.getToken();this.socket&&this.disconnect();let n=a?{withCredentials:!0,transports:["websocket"]}:{auth:{token:e},transports:["websocket"]};this.socket=le(C.socketUrl,n),this.socket.on("connect",()=>{console.log(`\u{1F50C} Connected to socket: ${this.socket?.id}`)}),this.socket.on("disconnect",s=>{console.log(`\u26A1 Disconnected: ${s}`)}),this.socket.on("connect_error",s=>{console.error("\u274C Socket connection error:",s.message||s)})}getSocket(){return this.socket}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=P({token:r,factory:r.\u0275fac,providedIn:"root"})};function fe(r,a){r&1&&(o(0,"mat-error"),i(1,"Email is required"),t())}function ge(r,a){r&1&&(o(0,"mat-error"),i(1,"Enter a valid email"),t())}function ue(r,a){r&1&&(o(0,"mat-error"),i(1,"Password is required"),t())}function he(r,a){r&1&&(o(0,"mat-error"),i(1,"Min 6 characters"),t())}function be(r,a){if(r&1&&(o(0,"p",22),i(1),t()),r&2){let e=_();m(),y(e.apiError)}}function ve(r,a){if(r&1){let e=I();o(0,"button",23),h("click",function(){O(e);let s=_();return w(s.goToOtp())}),i(1," Verify with OTP "),t()}}var ce=class r{constructor(a,e){this.socketService=a;this.adminSocketService=e}fb=c(V);router=c(D);auth=c(b);snackBar=c(ne);doctorProfile=c(re,{optional:!0});hide=!0;loading=!1;apiError=null;otpRequired=!1;form=this.fb.group({email:["",[p.required,p.email]],password:["",[p.required,p.minLength(6)]]});submit(){if(this.form.invalid){this.form.markAllAsTouched();return}let a={email:(this.form.value.email??"").trim().toLowerCase(),password:this.form.value.password??""};this.loading=!0,this.apiError=null,this.auth.login(a).subscribe({next:e=>{this.loading=!1,console.log("Login result:",e),e.token&&e.role==="ADMIN"?this.adminSocketService.connect():e.token&&e.role==="DOCTOR"&&this.socketService.connect();let n=this.routeForRole(e.role);if(e.role==="DOCTOR"&&this.doctorProfile){this.doctorProfile.refreshProfile().subscribe({next:s=>{let f=e.doctorStatus;console.log("Doctor status:",e),f==="NEW"||f==="REJECTED"?(console.log("\u{1FA7A} Navigating to profile setup...",e),this.router.navigateByUrl("/doctor/profile")):f==="PENDING"?this.snackBar.open("Your profile is still pending approval. Please wait for admin confirmation.","Close",{duration:5e3}):f==="ACCEPTED"&&(this.doctorProfile?.markAsUnlocked(),console.log("\u{1FA75} Navigating to dashboard..."),this.router.navigateByUrl("/doctor/dashboard"))},error:()=>this.router.navigateByUrl(n)});return}this.router.navigateByUrl(n)},error:e=>{if(this.loading=!1,this.apiError=e,console.log("Login error:",e),console.log(e==="Please verify your account with OTP first."),e==="Please verify your account with the OTP sent to your email and phone."||e==="Your OTP expired. A new one has been sent to your email and phone."){let n=this.form.value.email?.trim();localStorage.setItem("otpEmail",n?.toString()??""),this.router.navigateByUrl("/auth/otp")}}})}routeForRole(a){switch(a){case"ADMIN":return"/admin";case"DOCTOR":return"/doctor";default:return"/patient"}}goToOtp(){let a=this.form.value.email?.trim();this.router.navigateByUrl("/auth/otp")}static \u0275fac=function(e){return new(e||r)(x(v),x(se))};static \u0275cmp=E({type:r,selectors:[["app-login"]],decls:54,vars:13,consts:[[1,"auth-shell"],[1,"auth-frame"],[1,"hero-pane"],[1,"brand"],["src","https://ik.imagekit.io/a2wpi1kd9/imgToUrl/image-to-url_HEow9eLbR","alt","Medtik",1,"brand-mark"],[1,"tag"],[1,"benefits"],[1,"form-pane"],[1,"sub"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"stagger"],["matInput","","type","email","formControlName","email","autocomplete","email"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","password","autocomplete","current-password",3,"type"],["mat-icon-button","","matSuffix","","type","button","aria-label","Toggle password",3,"click"],["class","api-error","role","alert",4,"ngIf"],["mat-stroked-button","","color","accent",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","submit",1,"submit","stagger",3,"disabled"],[1,"aux","stagger",2,"display","flex","justify-content","space-between","align-items","center","margin-top","16px"],["routerLink","/auth/forgot",1,"forgot-link"],["mat-stroked-button","","color","primary","routerLink","/auth/sign-up"],["role","alert",1,"api-error"],["mat-stroked-button","","color","accent",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"aside",2)(3,"div",3),u(4,"img",4),o(5,"h1"),i(6,"Medtik"),t(),o(7,"p",5),i(8,"Care that comes to you"),t()(),o(9,"ul",6)(10,"li")(11,"mat-icon"),i(12,"military_tech"),t(),i(13," Best doctors in the middle east"),t(),o(14,"li")(15,"mat-icon"),i(16,"videocam"),t(),i(17," Chat, voice, or video - your choice"),t(),o(18,"li")(19,"mat-icon"),i(20,"payments"),t(),i(21," Secure, verified checkout with Paymob"),t()()(),o(22,"main",7)(23,"h2"),i(24,"Welcome back"),t(),o(25,"p",8),i(26,"Sign in to manage your consultations"),t(),o(27,"form",9),h("ngSubmit",function(){return n.submit()}),o(28,"mat-form-field",10)(29,"mat-label"),i(30,"Email"),t(),u(31,"input",11),o(32,"mat-icon",12),i(33,"mail"),t(),g(34,fe,2,0,"mat-error",13)(35,ge,2,0,"mat-error",13),t(),o(36,"mat-form-field",10)(37,"mat-label"),i(38,"Password"),t(),u(39,"input",14),o(40,"button",15),h("click",function(){return n.hide=!n.hide}),o(41,"mat-icon"),i(42),t()(),g(43,ue,2,0,"mat-error",13)(44,he,2,0,"mat-error",13),t(),g(45,be,2,1,"p",16)(46,ve,2,0,"button",17),o(47,"button",18),i(48),t()(),o(49,"div",19)(50,"a",20),i(51,"Forgot password?"),t(),o(52,"button",21),i(53," Sign up "),t()()()()()),e&2&&(l("@flyIn",void 0),m(22),l("@staggerIn",void 0),m(5),l("formGroup",n.form),m(7),l("ngIf",n.form.controls.email.hasError("required")),m(),l("ngIf",n.form.controls.email.hasError("email")),m(4),l("type",n.hide?"password":"text"),m(3),y(n.hide?"visibility":"visibility_off"),m(),l("ngIf",n.form.controls.password.hasError("required")),m(),l("ngIf",n.form.controls.password.hasError("minlength")),m(),l("ngIf",n.apiError),m(),l("ngIf",n.otpRequired),m(),l("disabled",n.loading),m(),T(" ",n.loading?"Signing in...":"Sign in"," "))},dependencies:[N,L,G,j,F,A,q,U,z,B,R,H,Z,X,J,K,Q,ie,oe,$,W,Y,te,ee],styles:['@charset "UTF-8";.auth-shell[_ngcontent-%COMP%]{min-height:100svh;display:flex;align-items:center;justify-content:center;padding:clamp(16px,4vmin,32px)}.auth-frame[_ngcontent-%COMP%]{width:min(960px,96vw);max-height:88svh;overflow:hidden;display:grid;grid-template-columns:1.15fr 1fr;border-radius:24px;background:linear-gradient(180deg,#ffffff08,#ffffff05),#101828b8;-webkit-backdrop-filter:blur(10px) saturate(120%);backdrop-filter:blur(10px) saturate(120%);border:1px solid rgba(255,255,255,.08);box-shadow:0 24px 70px #00000080}.hero-pane[_ngcontent-%COMP%]{position:relative;padding:28px 24px;border-right:1px solid rgba(255,255,255,.06)}.hero-pane[_ngcontent-%COMP%]:before, .hero-pane[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:-20%;background:radial-gradient(40% 35% at 20% 15%,rgba(42,118,183,.28),transparent 60%),radial-gradient(35% 30% at 80% 10%,rgba(29,183,160,.22),transparent 60%),radial-gradient(45% 40% at 60% 80%,rgba(42,118,183,.16),transparent 70%);filter:blur(14px);animation:_ngcontent-%COMP%_drift 16s linear infinite;pointer-events:none;z-index:0}.hero-pane[_ngcontent-%COMP%]:after{animation-duration:22s;animation-direction:reverse;opacity:.7}@keyframes _ngcontent-%COMP%_drift{0%{transform:translate3d(-2%,0,0) rotate(0)}50%{transform:translate3d(2%,1%,0) rotate(4deg)}to{transform:translate3d(-2%,0,0) rotate(0)}}.brand[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;place-items:center;gap:.35rem;margin-bottom:.75rem;text-align:center}.brand-mark[_ngcontent-%COMP%]{width:110px;height:110px;object-fit:contain;filter:drop-shadow(0 10px 24px rgba(42,118,183,.6))}.brand[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.45rem;letter-spacing:.3px;font-weight:800;color:#e6eef6}.tag[_ngcontent-%COMP%]{margin:0;color:#a7b4c5}.benefits[_ngcontent-%COMP%]{position:relative;z-index:1;list-style:none;margin:1rem 0 0;padding:0;display:grid;gap:.5rem}.benefits[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.55rem .65rem;border:1px solid rgba(255,255,255,.06);background:#ffffff05;border-radius:12px;color:#d4dce8}.benefits[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;height:18px;width:18px;color:#8fc7ff}.form-pane[_ngcontent-%COMP%]{padding:28px 20px;display:grid;align-content:start}.form-pane[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:.25rem 0 0;font-weight:800;font-size:clamp(1.25rem,2.2vw,1.6rem);color:#e6eef6}.form-pane[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{margin:.2rem 0 1rem;color:#a7b4c5}form[_ngcontent-%COMP%]{display:grid;gap:.8rem}.submit[_ngcontent-%COMP%]{width:100%;border-radius:12px;margin-top:.25rem}.aux[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:.25rem}.aux[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#a7b4c5;text-decoration:none}.aux[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#e6eaf2}@media (max-width: 900px){.auth-frame[_ngcontent-%COMP%]{grid-template-columns:1fr;max-height:unset}.hero-pane[_ngcontent-%COMP%]{border-right:0;border-bottom:1px solid rgba(255,255,255,.06)}.brand-mark[_ngcontent-%COMP%]{width:120px;height:120px}}@media (max-width: 480px){.auth-frame[_ngcontent-%COMP%]{width:94vw}.hero-pane[_ngcontent-%COMP%], .form-pane[_ngcontent-%COMP%]{padding:18px 14px}}.api-error[_ngcontent-%COMP%]{color:#f44336;font-size:.85rem;margin:-.25rem 0 .5rem}'],data:{animation:[k("flyIn",[M(":enter",[d({opacity:0,transform:"translateY(16px) scale(.98)"}),S("500ms cubic-bezier(.2,.8,.2,1)",d({opacity:1,transform:"none"}))])]),k("staggerIn",[M(":enter",[ae(".stagger",[d({opacity:0,transform:"translateY(10px)"}),me(60,S("380ms ease-out",d({opacity:1,transform:"none"})))])])])]}})};export{ce as LoginComponent};
