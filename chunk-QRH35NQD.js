import{d as X}from"./chunk-B453S2AB.js";import{a as Q,b as H,c as J}from"./chunk-KRFRCSHC.js";import{a as Y}from"./chunk-OGDSJRSL.js";import{a as $}from"./chunk-B6RKTF43.js";import"./chunk-LVHP3QQG.js";import"./chunk-F5X5MWHG.js";import{a as j,b as G}from"./chunk-XGLVXY7I.js";import{a as U,b as z}from"./chunk-Y5ANY4EP.js";import"./chunk-4K5T2QBN.js";import{a as V,h as R,m as W,n as K}from"./chunk-LCR2LKFI.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import"./chunk-YN6JIHUF.js";import{a as q,b as L}from"./chunk-W6QHVSTW.js";import"./chunk-W6FI7VKQ.js";import{T as F,Y as A,Z as B}from"./chunk-YSTQL2PO.js";import{d as D}from"./chunk-QJG5D5WU.js";import{$ as m,$b as k,Ac as w,Bc as P,Ga as l,Ic as T,Lb as y,Mc as I,Nb as a,Ob as g,Pb as S,Ra as x,Wa as b,_b as O,ea as N,fa as M,fc as E,lb as p,mb as n,nb as o,oa as f,vb as C,xb as d,zb as u,zc as h}from"./chunk-HKUWCROW.js";import{a as _,b as v}from"./chunk-JKOY2XUY.js";function tt(c,t){if(c&1){let e=C();n(0,"div",16)(1,"div",17)(2,"span",18),a(3),O(4,"titlecase"),o(),n(5,"div",19)(6,"div",20)(7,"span",2),a(8),o(),n(9,"span",21),a(10,"\u2022"),o(),n(11,"span",22),a(12),o()(),n(13,"div",23),a(14),o()()(),n(15,"div",24)(16,"button",25),d("click",function(){let r=N(e).$implicit,s=u();return M(s.toggleRead(r))}),n(17,"mat-icon"),a(18),o()(),n(19,"button",26),d("click",function(){let r=N(e).$implicit,s=u();return M(s.clear(r.kind))}),n(20,"mat-icon"),a(21,"close"),o()()()()}if(c&2){let e=t.$implicit,i=u();l(2),p("ngClass",i.badgeClass(e.kind)),l(),S(" ",k(4,8,e.kind)," "),l(5),g(e.title),l(4),g(i.time(e.time)),l(),y("muted",e.read),l(),g(e.body),l(4),g(e.read?"mark_email_read":"mark_email_unread")}}function et(c,t){c&1&&(n(0,"div",27)(1,"mat-icon"),a(2,"inbox"),o(),n(3,"div"),a(4,"No notifications"),o()())}var Z=class c{snack=m(U);service=m(Y);socketService=m($);router=m(D);all=f([]);query=f("");filter=f("all");filtered=E(()=>{let t=this.query().trim().toLowerCase(),e=this.filter();console.log("Filter:",e,"Query:",t),console.log("All notifications:",this.all());let i=this.all().filter(r=>e==="all"?!0:r.kind===e).filter(r=>!t||r.title.toLowerCase().includes(t)||r.body.toLowerCase().includes(t)).sort((r,s)=>+new Date(s.time)-+new Date(r.time));return console.log("Filtered list:",i),i});ngOnInit(){this.loadNotifications(),this.listenForNotifications()}ngOnDestroy(){console.log("\u{1F9F9} DoctorNotificationsComponent destroyed")}loadNotifications(){this.service.getNotifications().subscribe({next:t=>{console.log("Notifications:",t),this.all.set(t.map(e=>({id:e.id,kind:e.type?.toUpperCase()??"UNKNOWN",title:e.title,body:e.body,time:e.createdAt,read:e.read})))},error:t=>{console.error("\u274C Failed to load notifications:",t),this.snack.open("Failed to load notifications","OK",{duration:1500})}})}listenForNotifications(){console.log("\u{1F514} Setting up socket listener for notifications..."),this.socketService.on("notification:new",t=>{console.log("\u{1F4E9} [Socket] New notification received:",t);let e={id:t.id,kind:t.type?.toUpperCase()??"UNKNOWN",title:t.title,body:t.message||t.body||"",time:t.createdAt||new Date().toISOString(),read:!1};this.all.update(i=>[e,...i]),this.snack.open("New notification","View",{duration:2500}).onAction().subscribe(()=>this.open(e))})}open(t){console.log("\u{1F9ED} Navigating to notification:",t),this.router.navigate(["/doctor/notifications"])}markRead(t){this.all.update(e=>e.map(i=>i.id===t.id?v(_({},i),{read:!0}):i))}toggleRead(t){this.all.update(e=>e.map(i=>i.id===t.id?v(_({},i),{read:!i.read}):i))}clear(t){confirm("Clear notifications?")&&(!t||t==="all"?this.all.set([]):this.all.update(e=>e.filter(i=>i.kind!==t)),this.snack.open("Notifications cleared","OK",{duration:1200}))}time(t){return new Date(t).toLocaleString()}badgeClass(t){return{appointment:t==="APPOINTMENT",review:t==="REVIEW",mention:t==="MENTION",system:t==="SYSTEM"}}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=x({type:c,selectors:[["app-doctor-notifications"]],decls:28,vars:4,consts:[[1,"wrap","container"],[1,"bar"],[1,"title"],[1,"controls"],["appearance","outline",1,"search"],["matInput","",3,"input","value"],[3,"change","value"],["value","all"],["value","APPOINTMENT"],["value","MENTION"],["value","REVIEW"],["value","SYSTEM"],["mat-stroked-button","",3,"click"],[1,"list","card"],["class","item",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"item"],[1,"left"],[1,"pill",3,"ngClass"],[1,"meta"],[1,"t"],[1,"dot"],[1,"time"],[1,"b"],[1,"right"],["mat-icon-button","","matTooltip","Toggle read",3,"click"],["mat-icon-button","","matTooltip","Dismiss",3,"click"],[1,"empty"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"header",1)(2,"div",2)(3,"mat-icon"),a(4,"notifications"),o(),n(5,"h2"),a(6,"Notifications"),o()(),n(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),a(10,"Search"),o(),n(11,"input",5),d("input",function(s){return i.query.set(s.target.value)}),o()(),n(12,"mat-button-toggle-group",6),d("change",function(s){return i.filter.set(s.value)}),n(13,"mat-button-toggle",7),a(14,"All"),o(),n(15,"mat-button-toggle",8),a(16,"Appointments"),o(),n(17,"mat-button-toggle",9),a(18,"Mentions"),o(),n(19,"mat-button-toggle",10),a(20,"Reviews"),o(),n(21,"mat-button-toggle",11),a(22,"System"),o()(),n(23,"button",12),d("click",function(){return i.clear()}),a(24,"Clear all"),o()()(),n(25,"section",13),b(26,tt,22,10,"div",14)(27,et,5,0,"div",15),o()()),e&2&&(l(11),p("value",i.query()),l(),p("value",i.filter()),l(14),p("ngForOf",i.filtered()),l(),p("ngIf",!i.filtered().length))},dependencies:[I,h,w,P,L,q,B,A,F,X,G,j,z,J,Q,H,K,W,R,V,T],styles:[".wrap[_ngcontent-%COMP%]{padding:14px 12px}.bar[_ngcontent-%COMP%]{display:grid;gap:12px;align-items:center;margin-bottom:10px;grid-template-columns:auto 1fr}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:flex-end;flex-wrap:wrap}.search[_ngcontent-%COMP%]{width:min(340px,45vw)}.list.card[_ngcontent-%COMP%]{padding:8px;display:grid;gap:8px}.item[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;gap:10px;padding:12px;border:1px solid var(--border);border-radius:14px;background:#ffffff08}.left[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:flex-start}.meta[_ngcontent-%COMP%]{display:grid;gap:4px}.t[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;flex-wrap:wrap}.title[_ngcontent-%COMP%]{font-weight:800}.time[_ngcontent-%COMP%]{opacity:.8;font-size:12px}.b.muted[_ngcontent-%COMP%]{opacity:.6}.pill[_ngcontent-%COMP%]{padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--border);text-transform:capitalize}.pill.appointment[_ngcontent-%COMP%]{background:#1db7a029}.pill.mention[_ngcontent-%COMP%]{background:#3b8bd329}.pill.review[_ngcontent-%COMP%]{background:#eab30829}.pill.system[_ngcontent-%COMP%]{background:#94a3b829}.right[_ngcontent-%COMP%]{display:flex;gap:6px}.empty[_ngcontent-%COMP%]{text-align:center;opacity:.8;padding:20px 0;display:grid;gap:6px}"]})};export{Z as DoctorNotificationsComponent};
