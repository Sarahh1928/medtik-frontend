import{b as ae}from"./chunk-VDGTLRZA.js";import{a as me,c as se,d as pe,e as de,f as ce,g as fe,h as ue}from"./chunk-7FBEAZQZ.js";import"./chunk-PVDG46DZ.js";import{a as le}from"./chunk-Z5BVUGGB.js";import{a as X,b as ee}from"./chunk-TQOOYVQA.js";import"./chunk-MS4AQ6UA.js";import{a as ne,b as oe,d as ie}from"./chunk-S4N5XNDO.js";import"./chunk-EQK2A33D.js";import{b as te}from"./chunk-IPF6I5W2.js";import"./chunk-CBB6Q34Z.js";import"./chunk-3RK6DDJD.js";import{a as E,b as J,h as F,i as N,m as k,n as T}from"./chunk-FXUZVO2G.js";import{a as re}from"./chunk-KADNFXRE.js";import"./chunk-ZF73G4FL.js";import"./chunk-CHFE4G6B.js";import"./chunk-J42FRN67.js";import"./chunk-XDTU2MFJ.js";import{a as Q,b as W}from"./chunk-CQ63BDYT.js";import{B as x,b as P,d as p,f as M,g as B,h as y,j as s,l as K,n as $,o as Y,r as H,y as Z}from"./chunk-NZBL2PSU.js";import{Y as S,Z as O}from"./chunk-YNMGB45N.js";import{b as j}from"./chunk-F426BNRH.js";import{Bb as z,Db as g,Gc as q,Hc as G,Ia as R,Ma as l,Pb as U,Qa as L,Sc as _,Tb as i,Ub as D,Xa as C,ab as u,ea as h,ja as v,ka as b,rb as m,sb as n,ta as A,tb as e,ub as d}from"./chunk-BE7DJT6W.js";var V=class a{otp=new s("",[p.required,p.pattern(/^\d{6}$/)]);dialogRef=h(me);verify(){this.otp.valid&&this.dialogRef.close(this.otp.value)}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=C({type:a,selectors:[["app-verify-otp-dialog"]],decls:14,vars:2,consts:[["mat-dialog-title",""],["appearance","outline",1,"full"],["matInput","","type","text","maxlength","6",3,"formControl"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(r,o){r&1&&(n(0,"h2",0),i(1,"Verify Phone Number"),e(),n(2,"mat-dialog-content")(3,"p"),i(4,"Enter the 6-digit OTP sent to your phone."),e(),n(5,"mat-form-field",1)(6,"mat-label"),i(7,"OTP"),e(),d(8,"input",2),e()(),n(9,"mat-dialog-actions",3)(10,"button",4),i(11,"Cancel"),e(),n(12,"button",5),g("click",function(){return o.verify()}),i(13,"Verify"),e()()),r&2&&(l(8),m("formControl",o.otp),l(4),m("disabled",o.otp.invalid))},dependencies:[_,x,P,M,Z,$,N,F,E,T,k,O,S,ue,pe,de,fe,ce],encapsulation:2})};function Pe(a,t){a&1&&(n(0,"mat-error"),i(1," Name is required (min 3 chars). "),e())}function Me(a,t){a&1&&(n(0,"mat-error"),i(1," Enter a valid email. "),e())}function ye(a,t){if(a&1&&(n(0,"mat-option",36),i(1),e()),a&2){let r=t.$implicit;m("value",r.code),l(),D(r.name)}}function xe(a,t){if(a&1&&(n(0,"mat-option",36),i(1),e()),a&2){let r=t.$implicit;m("value",r),l(),D(r)}}function Se(a,t){a&1&&(n(0,"mat-error"),i(1," Required. "),e())}function Oe(a,t){a&1&&(n(0,"mat-error"),i(1," Required. "),e())}function Ee(a,t){a&1&&(n(0,"mat-error"),i(1," Min 8 characters. "),e())}function Fe(a,t){a&1&&(n(0,"mat-error"),i(1," Use letters and numbers. "),e())}function Ne(a,t){a&1&&(n(0,"mat-error"),i(1," Passwords don\u2019t match. "),e())}var ge=class a{constructor(t){this.patientService=t}snack=h(X);auth=h(j);dialog=h(se);avatarUrl=A("https://i.pravatar.cc/120?img=13");originalPhone="";countries=[{code:"EG",name:"Egypt"},{code:"SA",name:"Saudi Arabia"},{code:"AE",name:"United Arab Emirates"},{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"}];languages=[{code:"en",name:"English"},{code:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"}];timezones=["Africa/Cairo","Asia/Riyadh","Asia/Dubai","Europe/London","America/New_York"];isPhoneVerified=!1;otpDialogOpen=!1;profileForm=new y({fullName:new s("",{nonNullable:!0,validators:[p.required,p.minLength(3)]}),email:new s("",{nonNullable:!0,validators:[p.required,p.email]}),dob:new s(""),phone:new s(""),country:new s("EG",{nonNullable:!0}),gender:new s("female",{nonNullable:!0}),language:new s("english",{nonNullable:!0}),timezone:new s("Africa/Cairo",{nonNullable:!0}),avatarUrl:new s("",{nonNullable:!0})});ngOnInit(){this.loadProfile()}loadProfile(){this.patientService.getProfile().subscribe({next:t=>{let r=t?.user?.patient||{};this.originalPhone=r.phone||"",this.profileForm.get("phone")?.valueChanges.subscribe(o=>{this.isPhoneVerified=o===this.originalPhone}),console.log("Patient data:",r),this.avatarUrl.set(r.avatarUrl||""),this.profileForm.patchValue({fullName:t?.user?.fullName||"",email:t?.user?.email||"",dob:r.birthdate?r.birthdate.split("T")[0]:"",phone:r.phone||"",country:r.country||"EG",gender:r.gender||"female",language:r.language||"english",timezone:"Africa/Cairo"}),console.log("Loaded profile:",t),t?.avatarUrl&&this.avatarUrl.set(t.avatarUrl)},error:t=>{console.error("Profile load failed:",t),this.snack.open("Failed to load profile","Close",{duration:2500})}})}onPickAvatar(t){let o=t.target?.files?.[0];if(o){try{URL.revokeObjectURL(this.avatarUrl())}catch{}this.avatarUrl.set(URL.createObjectURL(o)),this.snack.open("Photo updated (local preview)","OK",{duration:1500})}}saveProfile(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched();return}let t={fullName:this.profileForm.value.fullName,email:this.profileForm.value.email,phone:this.profileForm.value.phone,country:this.profileForm.value.country,birthdate:this.profileForm.value.dob,gender:this.profileForm.value.gender,avatarUrl:this.profileForm.value.avatarUrl,language:this.profileForm.value.language,timezone:this.profileForm.value.timezone};console.log("Saving profile with payload:",t),this.patientService.updateProfile(t).subscribe({next:r=>{this.snack.open("Profile updated successfully!","OK",{duration:2e3})},error:r=>{console.error("Profile update failed:",r),this.snack.open("Failed to update profile","Close",{duration:2500})}})}passwordForm=new y({oldPassword:new s("",{nonNullable:!0,validators:[p.required]}),newPassword:new s("",{nonNullable:!0,validators:[p.required,p.minLength(8),p.pattern(/^(?=.*[A-Za-z])(?=.*\d).{8,}$/)]}),confirm:new s("",{nonNullable:!0,validators:[p.required]})},{validators:[ke]});changePassword(){if(this.passwordForm.invalid){this.passwordForm.markAllAsTouched();return}let{oldPassword:t,newPassword:r,confirm:o}=this.passwordForm.getRawValue(),c={currentPassword:t,newPassword:r,verifyPassword:o};this.auth.changePassword(c).subscribe({next:f=>{this.snack.open(f.message,"OK",{duration:2e3}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""})},error:f=>{this.snack.open(f,"Close",{duration:2500})}}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""}),this.snack.open("Password changed","OK",{duration:1400})}notiForm=new y({push:new s(!0,{nonNullable:!0}),email:new s(!0,{nonNullable:!0}),appt:new s(!0,{nonNullable:!0}),chat:new s(!0,{nonNullable:!0}),marketing:new s(!1,{nonNullable:!0})});saveNotifications(){this.snack.open("Notification preferences saved","OK",{duration:1200})}openVerifyDialog(){let t=this.profileForm.value.phone;if(!t){this.snack.open("Enter a phone number first","Close",{duration:2e3});return}this.patientService.sendOtp(t).subscribe({next:()=>{this.dialog.open(V).afterClosed().subscribe(o=>{o&&this.verifyOtp(o)})},error:()=>{this.snack.open("Failed to send OTP. Try again.","Close",{duration:2e3})}})}verifyOtp(t){this.patientService.verifyOtp(t).subscribe({next:()=>{this.isPhoneVerified=!0,this.originalPhone=this.profileForm.value.phone||"",this.snack.open("Phone verified successfully","OK",{duration:2e3})},error:()=>{this.snack.open("Invalid OTP. Please try again.","Close",{duration:2e3})}})}showTooltip(t,r){r.stopPropagation(),t.disabled=!1,t.show(),setTimeout(()=>{t.hide(),t.disabled=!0},5e3)}onAvatarUrlChange(t){let o=t.target.value;this.avatarUrl.set(o)}static \u0275fac=function(r){return new(r||a)(L(re))};static \u0275cmp=C({type:a,selectors:[["app-settings"]],decls:97,vars:16,consts:[["tooltip","matTooltip"],["countryTooltip","matTooltip"],[1,"settings-wrap"],[1,"toolbar"],[1,"title"],[1,"glowdot"],[1,"grid"],[1,"card","neo"],[1,"section-head"],[1,"profile"],[1,"avatar"],["alt","",3,"src"],[1,"form",3,"formGroup"],["appearance","outline",1,"field","full"],["matInput","","formControlName","fullName"],[4,"ngIf"],["matInput","","formControlName","email","type","email"],["appearance","outline",1,"field"],["formControlName","gender"],["value","male"],["value","female"],["matInput","","type","date","formControlName","dob"],["appearance","outline",1,"field","verify-field"],["matInput","","formControlName","phone","readonly","","tabindex","-1","matTooltip","You can't change your phone number","matTooltipPosition","below",1,"readonly-input",3,"click"],["matInput","","formControlName","country","readonly","","tabindex","-1","matTooltip","You can't change your country","matTooltipPosition","below",1,"readonly-input",3,"click"],["formControlName","language"],[3,"value",4,"ngFor","ngForOf"],["formControlName","timezone"],["matInput","","formControlName","avatarUrl","placeholder","Enter image URL",3,"change"],[1,"actions"],["mat-flat-button","","color","primary",1,"neon",3,"click","disabled"],[1,"pwd",3,"formGroup"],["matInput","","formControlName","oldPassword","autocomplete","current-password",3,"type"],["matInput","","formControlName","newPassword","autocomplete","new-password",3,"type"],["matInput","","formControlName","confirm","autocomplete","new-password",3,"type"],["mat-stroked-button","",1,"neon",3,"click"],[3,"value"]],template:function(r,o){if(r&1){let c=z();n(0,"div",2)(1,"div",3)(2,"div",4),d(3,"span",5),n(4,"h2"),i(5,"Settings"),e()()(),n(6,"div",6)(7,"section",7)(8,"header",8)(9,"mat-icon"),i(10,"account_circle"),e(),n(11,"h3"),i(12,"Profile"),e()(),n(13,"div",9)(14,"div",10),d(15,"img",11),e(),n(16,"form",12)(17,"mat-form-field",13)(18,"mat-label"),i(19,"Full name"),e(),d(20,"input",14),u(21,Pe,2,0,"mat-error",15),e(),n(22,"mat-form-field",13)(23,"mat-label"),i(24,"Email"),e(),d(25,"input",16),u(26,Me,2,0,"mat-error",15),e(),n(27,"mat-form-field",17)(28,"mat-label"),i(29,"Gender"),e(),n(30,"mat-select",18)(31,"mat-option",19),i(32,"Male"),e(),n(33,"mat-option",20),i(34,"Female"),e()()(),n(35,"mat-form-field",17)(36,"mat-label"),i(37,"Date of birth"),e(),d(38,"input",21),e(),n(39,"mat-form-field",22)(40,"mat-label"),i(41,"Phone"),e(),n(42,"input",23,0),g("click",function(w){v(c);let I=U(43);return b(o.showTooltip(I,w))}),e()(),n(44,"mat-form-field",22)(45,"mat-label"),i(46,"Country"),e(),n(47,"input",24,1),g("click",function(w){v(c);let I=U(48);return b(o.showTooltip(I,w))}),e()(),n(49,"mat-form-field",17)(50,"mat-label"),i(51,"Language"),e(),n(52,"mat-select",25),u(53,ye,2,2,"mat-option",26),e()(),n(54,"mat-form-field",17)(55,"mat-label"),i(56,"Time zone"),e(),n(57,"mat-select",27),u(58,xe,2,2,"mat-option",26),e()(),n(59,"mat-form-field",13)(60,"mat-label"),i(61,"Avatar URL"),e(),n(62,"input",28),g("change",function(w){return v(c),b(o.onAvatarUrlChange(w))}),e()(),n(63,"div",29)(64,"button",30),g("click",function(){return v(c),b(o.saveProfile())}),n(65,"mat-icon"),i(66,"save"),e(),i(67," Save profile "),e()()()()(),n(68,"section",7)(69,"header",8)(70,"mat-icon"),i(71,"lock_reset"),e(),n(72,"h3"),i(73,"Change password"),e()(),n(74,"form",31)(75,"mat-form-field",13)(76,"mat-label"),i(77,"Current password"),e(),d(78,"input",32),u(79,Se,2,0,"mat-error",15),e(),n(80,"mat-form-field",17)(81,"mat-label"),i(82,"New password"),e(),d(83,"input",33),u(84,Oe,2,0,"mat-error",15)(85,Ee,2,0,"mat-error",15)(86,Fe,2,0,"mat-error",15),e(),n(87,"mat-form-field",17)(88,"mat-label"),i(89,"Confirm new password"),e(),d(90,"input",34),u(91,Ne,2,0,"mat-error",15),e(),n(92,"div",29)(93,"button",35),g("click",function(){return v(c),b(o.changePassword())}),n(94,"mat-icon"),i(95,"key"),e(),i(96," Update password "),e()()()()()()}r&2&&(l(15),m("src",o.avatarUrl(),R),l(),m("formGroup",o.profileForm),l(5),m("ngIf",o.profileForm.controls.fullName.invalid&&o.profileForm.controls.fullName.touched),l(5),m("ngIf",o.profileForm.controls.email.invalid&&o.profileForm.controls.email.touched),l(27),m("ngForOf",o.languages),l(5),m("ngForOf",o.timezones),l(6),m("disabled",!o.isPhoneVerified||o.profileForm.invalid),l(10),m("formGroup",o.passwordForm),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.controls.oldPassword.invalid&&o.passwordForm.controls.oldPassword.touched),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("required")&&o.passwordForm.controls.newPassword.touched),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("minlength")&&o.passwordForm.controls.newPassword.touched),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("pattern")&&o.passwordForm.controls.newPassword.touched),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.hasError("passwordMismatch")&&o.passwordForm.controls.confirm.touched))},dependencies:[_,q,G,x,K,P,M,B,Y,H,W,Q,O,S,le,te,N,F,E,J,T,k,ie,oe,ne,ae,ee],styles:['.settings-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:900;letter-spacing:.3px}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .glowdot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#71c2ff,#3b8bd3 40%,transparent 65%);box-shadow:0 0 24px #3b8bd3cc}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(1,minmax(0,1fr))}@media (max-width: 1080px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.card.neo[_ngcontent-%COMP%]{position:relative;background:linear-gradient(180deg,#ffffff0a,#ffffff05);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 20px 60px #00000073;padding:.9rem;overflow:hidden}.card.neo[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:-2px;background:conic-gradient(from 0deg,#71c2ffbf,#b78cffbf,#1db7a0bf,#71c2ffbf);filter:blur(18px);opacity:.18;transition:opacity .25s var(--ease);z-index:0}.card.neo[_ngcontent-%COMP%]:hover:before{opacity:.28}.section-head[_ngcontent-%COMP%]{position:relative;z-index:1;display:flex;align-items:center;gap:.6rem;margin-bottom:.55rem}.section-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.section-head[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.1);background:#ffffff0f;border-radius:12px;padding:.35rem}.profile[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:auto 1fr;gap:1rem;align-items:start}.avatar[_ngcontent-%COMP%]{position:relative;width:92px;height:92px;border-radius:50%;overflow:hidden;border:1px solid rgba(255,255,255,.1);box-shadow:0 10px 25px #00000059}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{position:absolute;right:-8px;bottom:-8px;width:38px;height:38px;border-radius:50%;display:grid;place-items:center;background:#ffffff1f;border:1px solid rgba(255,255,255,.18);cursor:pointer}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.field.full[_ngcontent-%COMP%]{grid-column:1/-1}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;margin-top:.5rem}.pwd[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.pwd[_ngcontent-%COMP%]   .field.full[_ngcontent-%COMP%]{grid-column:1/-1}.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:1fr 1fr}@media (max-width: 900px){.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.notis[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{display:grid;gap:.35rem}.notis[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px;opacity:.95}.neon[_ngcontent-%COMP%]{position:relative;border-radius:12px;box-shadow:0 8px 30px #3b8bd340}.neon[_ngcontent-%COMP%]:hover{box-shadow:0 12px 38px #3b8bd359}.mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important;line-height:1!important}.mat-mdc-form-field[_ngcontent-%COMP%]{--mat-form-field-container-vertical-padding: 15px}.verify-field[_ngcontent-%COMP%]{display:flex;align-items:center}.verify-field[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:4px}.readonly-input[_ngcontent-%COMP%]{pointer-events:auto;color:#837a7acc;cursor:not-allowed}  .mat-mdc-tooltip{margin-top:-6px!important}']})};function ke(a){let t=a.get("newPassword")?.value,r=a.get("confirm")?.value;return!t||!r||t===r?null:{passwordMismatch:!0}}export{ge as SettingsComponent};
