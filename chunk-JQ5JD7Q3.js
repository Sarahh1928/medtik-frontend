import{$ as n,Nc as u,Sc as i,T as g,Tc as c,W as h,l as p,o as l,ya as d,z as r}from"./chunk-HKUWCROW.js";var a={production:!0,apiBaseUrl:"https://medtik-backend.onrender.com/api",socketUrl:"https://medtik-backend.onrender.com"};var m=class o{http=n(c);platformId=n(d);isBrowser=u(this.platformId);baseUrl=a.apiBaseUrl;tokenKey="medtik_token";isProd=a.production;registerPatient(t){return this.http.post(`${this.baseUrl}/auth/register-patient`,t,this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}verifyOtp(t){return this.http.post(`${this.baseUrl}/auth/verify-otp`,t,this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}login(t){return this.http.post(`${this.baseUrl}/auth/login`,t,this.getHttpOptions()).pipe(g(e=>{console.log("\u{1F7E9} Raw response from backend:",e),!this.isProd&&e?.token&&this.setToken(e.token)}),l(e=>{let s={message:e.message,role:e.role??e.user?.role??null,doctorStatus:e.doctorStatus??null,token:e.token??null};return console.log("\u{1F7E6} Transformed response after map:",s),s}),r(e=>this.handleError(e)))}resendOtp(t){return this.http.post(`${this.baseUrl}/auth/resend-otp`,{email:t},this.getHttpOptions()).pipe(r(e=>this.handleError(e)))}changePassword(t){let e=this.isProd?void 0:new i({"Content-Type":"application/json",Authorization:`Bearer ${this.getToken()??""}`});return this.http.post(`${this.baseUrl}/auth/change-password`,t,this.isProd?{withCredentials:!0}:{headers:e}).pipe(r(s=>this.handleError(s)))}logout(){return this.http.post(`${this.baseUrl}/auth/logout`,{},this.getHttpOptions()).pipe(r(t=>this.handleError(t)))}getToken(){return this.isBrowser?localStorage.getItem(this.tokenKey):null}clearToken(){this.isBrowser&&localStorage.removeItem(this.tokenKey)}setToken(t){this.isBrowser&&localStorage.setItem(this.tokenKey,t)}getCurrentRole(){if(!this.isBrowser)return null;let t=this.getToken();return t?this.extractRoleFromToken(t):null}extractRoleFromToken(t){try{let e=t.split(".")[1];if(!e)return null;let s=e.replace(/-/g,"+").replace(/_/g,"/"),f=atob(s);return JSON.parse(f)?.role??null}catch(e){return console.warn("Failed to decode JWT role",e),null}}getHttpOptions(){return this.isProd?{withCredentials:!0}:{headers:new i({"Content-Type":"application/json",Authorization:`Bearer ${this.getToken()??""}`})}}handleError(t){let e="Something went wrong. Please try again.";return t.error?typeof t.error=="string"?e=t.error:typeof t.error=="object"&&(e=t.error.error??t.error.message??e):t.message&&(e=t.message),p(()=>e)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};export{a,m as b};
