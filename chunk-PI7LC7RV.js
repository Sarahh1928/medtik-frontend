import{a as K,b as q,c as H}from"./chunk-H2BNK2GT.js";import"./chunk-F5X5MWHG.js";import{b as G}from"./chunk-OZY4EI32.js";import{a as z,b as j}from"./chunk-FNX66O3M.js";import"./chunk-JXSMCY7E.js";import{a as B}from"./chunk-OC6UHY2H.js";import"./chunk-HRQB4EEZ.js";import"./chunk-GED64AQA.js";import"./chunk-Z4D3JJEG.js";import{a as L,b as F}from"./chunk-ENKIQ3XX.js";import"./chunk-K2DA6FBL.js";import{Y as U,Z as N}from"./chunk-LVPX6TEL.js";import"./chunk-P6PSD35X.js";import{d as D,h as R}from"./chunk-L73FSOJZ.js";import{$a as v,Ab as x,Cb as u,Eb as s,Ec as T,Fc as A,Gc as V,Ia as C,La as r,Ob as E,Rc as $,Sb as n,Tb as m,Ub as I,Vb as P,Wa as O,ea as M,gc as k,ja as _,ka as g,kc as f,qb as p,rb as i,sb as e,ta as b,tb as y,xb as w,yb as S}from"./chunk-WZIMFKHB.js";function W(c,a){if(c&1){let t=x();i(0,"button",30),u("click",function(){_(t);let l=s().$implicit,d=s(2);return g(d.payNow(l))}),i(1,"mat-icon"),n(2,"payments"),e(),n(3," Pay now "),e()}}function X(c,a){if(c&1){let t=x();i(0,"section",13)(1,"div",14),y(2,"img",15),i(3,"div",16)(4,"div",17)(5,"div",18),n(6),e(),i(7,"div",19),n(8),e()(),i(9,"div",20),n(10),e()()(),i(11,"div",21)(12,"div",22)(13,"div",23),n(14),e(),i(15,"div",24)(16,"mat-icon"),n(17),e(),n(18),e()(),i(19,"div",25),v(20,W,4,0,"button",26),i(21,"button",27),u("click",function(){let l=_(t).$implicit,d=s(2);return g(d.downloadReceipt(l))}),i(22,"mat-icon"),n(23,"download"),e(),n(24," Receipt "),e(),i(25,"button",28),u("click",function(){let l=_(t).$implicit,d=s(2);return g(d.viewAppointment(l))}),i(26,"mat-icon"),n(27,"event"),e(),n(28," Appointment "),e()(),i(29,"div",29),n(30),e()()()}if(c&2){let t=a.$implicit,o=s(2);r(2),p("src",t.doctor.avatar,C),r(4),m(t.doctor.name),r(2),m(t.doctor.department),r(2),m(o.toLocal(t.createdAt)),r(4),P("",t.amount.value," ",t.amount.currency),r(),p("ngClass",t.modality),r(2),m(o.modalityIcon(t.modality)),r(),m(t.modality),r(2),p("ngIf",t.status==="unpaid"),r(9),p("ngClass",t.status),r(),m(t.status)}}function Y(c,a){if(c&1&&(w(0),i(1,"div",11),v(2,X,31,12,"section",12),e(),S()),c&2){let t=s();r(2),p("ngForOf",t.filtered())}}function Z(c,a){if(c&1){let t=x();i(0,"section",13)(1,"div",14),y(2,"img",15),i(3,"div",16)(4,"div",17)(5,"div",18),n(6),e(),i(7,"div",19),n(8),e()(),i(9,"div",20),n(10),e()()(),i(11,"div",21)(12,"div",22)(13,"div",23),n(14),e(),i(15,"div",24)(16,"mat-icon"),n(17),e(),n(18),e()(),i(19,"div",25)(20,"button",30),u("click",function(){let l=_(t).$implicit,d=s(3);return g(d.payNow(l))}),i(21,"mat-icon"),n(22,"payments"),e(),n(23," Pay now"),e(),i(24,"button",27),u("click",function(){let l=_(t).$implicit,d=s(3);return g(d.downloadReceipt(l))}),i(25,"mat-icon"),n(26,"download"),e(),n(27," Receipt"),e(),i(28,"button",28),u("click",function(){let l=_(t).$implicit,d=s(3);return g(d.viewAppointment(l))}),i(29,"mat-icon"),n(30,"event"),e(),n(31," Appointment"),e()(),i(32,"div",33),n(33,"unpaid"),e()()()}if(c&2){let t=a.$implicit,o=s(3);r(2),p("src",t.doctor.avatar,C),r(4),m(t.doctor.name),r(2),m(t.doctor.department),r(2),m(o.toLocal(t.createdAt)),r(4),P("",t.amount.value," ",t.amount.currency),r(),p("ngClass",t.modality),r(2),m(o.modalityIcon(t.modality)),r(),m(t.modality)}}function tt(c,a){if(c&1&&(i(0,"div",32)(1,"h3")(2,"mat-icon"),n(3,"warning"),e(),n(4," Unpaid"),e(),i(5,"div",11),v(6,Z,34,9,"section",12),e()()),c&2){let t=s(2);r(6),p("ngForOf",t.unpaid())}}function et(c,a){if(c&1){let t=x();i(0,"section",13)(1,"div",14),y(2,"img",15),i(3,"div",16)(4,"div",17)(5,"div",18),n(6),e(),i(7,"div",19),n(8),e()(),i(9,"div",20),n(10),e()()(),i(11,"div",21)(12,"div",22)(13,"div",23),n(14),e(),i(15,"div",24)(16,"mat-icon"),n(17),e(),n(18),e()(),i(19,"div",25)(20,"button",27),u("click",function(){let l=_(t).$implicit,d=s(3);return g(d.downloadReceipt(l))}),i(21,"mat-icon"),n(22,"download"),e(),n(23," Receipt"),e(),i(24,"button",28),u("click",function(){let l=_(t).$implicit,d=s(3);return g(d.viewAppointment(l))}),i(25,"mat-icon"),n(26,"event"),e(),n(27," Appointment"),e()(),i(28,"div",34),n(29,"paid"),e()()()}if(c&2){let t=a.$implicit,o=s(3);r(2),p("src",t.doctor.avatar,C),r(4),m(t.doctor.name),r(2),m(t.doctor.department),r(2),m(o.toLocal(t.createdAt)),r(4),P("",t.amount.value," ",t.amount.currency),r(),p("ngClass",t.modality),r(2),m(o.modalityIcon(t.modality)),r(),m(t.modality)}}function nt(c,a){if(c&1&&(i(0,"div",32)(1,"h3")(2,"mat-icon"),n(3,"check_circle"),e(),n(4," Paid"),e(),i(5,"div",11),v(6,et,30,9,"section",12),e()()),c&2){let t=s(2);r(6),p("ngForOf",t.paid())}}function it(c,a){if(c&1){let t=x();i(0,"section",13)(1,"div",14),y(2,"img",15),i(3,"div",16)(4,"div",17)(5,"div",18),n(6),e(),i(7,"div",19),n(8),e()(),i(9,"div",20),n(10),e()()(),i(11,"div",21)(12,"div",22)(13,"div",23),n(14),e(),i(15,"div",24)(16,"mat-icon"),n(17),e(),n(18),e()(),i(19,"div",25)(20,"button",27),u("click",function(){let l=_(t).$implicit,d=s(3);return g(d.downloadReceipt(l))}),i(21,"mat-icon"),n(22,"download"),e(),n(23," Receipt"),e(),i(24,"button",28),u("click",function(){let l=_(t).$implicit,d=s(3);return g(d.viewAppointment(l))}),i(25,"mat-icon"),n(26,"event"),e(),n(27," Appointment"),e()(),i(28,"div",35),n(29,"refunded"),e()()()}if(c&2){let t=a.$implicit,o=s(3);r(2),p("src",t.doctor.avatar,C),r(4),m(t.doctor.name),r(2),m(t.doctor.department),r(2),m(o.toLocal(t.createdAt)),r(4),P("",t.amount.value," ",t.amount.currency),r(),p("ngClass",t.modality),r(2),m(o.modalityIcon(t.modality)),r(),m(t.modality)}}function at(c,a){if(c&1&&(i(0,"div",32)(1,"h3")(2,"mat-icon"),n(3,"redeem"),e(),n(4," Refunded"),e(),i(5,"div",11),v(6,it,30,9,"section",12),e()()),c&2){let t=s(2);r(6),p("ngForOf",t.refunded())}}function ot(c,a){if(c&1&&v(0,tt,7,1,"div",31)(1,nt,7,1,"div",31)(2,at,7,1,"div",31),c&2){let t=s();p("ngIf",t.unpaid().length),r(),p("ngIf",t.paid().length),r(),p("ngIf",t.refunded().length)}}var J=c=>new Date(c).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});var h=class c{router=M(D);snack=M(z);service=M(B);all=b([]);loading=b(!0);constructor(){this.fetchInvoices()}fetchInvoices(){this.loading.set(!0),this.service.getTransactions().subscribe({next:a=>{let t=a.map(o=>({id:`${o.id}-${o.paymobTransactionId}`,appointmentId:o.appointmentId.toString(),createdAt:o.createdAt,modality:(o.appointment?.appointmentType||"chat").toLowerCase(),amount:{currency:o.currency,value:o.amount},status:o.status.toLowerCase(),doctor:{name:o.doctor?.user?.fullName||"Unknown",department:o.doctor?.title||"Unknown",avatar:o.doctor?.avatarUrl||""},patient:{name:o.patient?.user?.fullName||"Unknown"},method:"card",last4:o.paymobTransactionId,txnId:o.paymobTransactionId,paymentUrl:o.paymentUrl}));this.all.set(t),this.loading.set(!1)},error:a=>{console.error(a),this.snack.open("Failed to load invoices","Close",{duration:4e3}),this.loading.set(!1)}})}status=b("all");filtered=f(()=>{let a=this.status();return this.all().filter(t=>a==="all"?!0:t.status===a).sort((t,o)=>new Date(o.createdAt).getTime()-new Date(t.createdAt).getTime())});unpaid=f(()=>this.all().filter(a=>a.status==="unpaid").sort((a,t)=>new Date(a.createdAt).getTime()-new Date(t.createdAt).getTime()));paid=f(()=>this.all().filter(a=>a.status==="paid").sort((a,t)=>new Date(t.createdAt).getTime()-new Date(a.createdAt).getTime()));refunded=f(()=>this.all().filter(a=>a.status==="refunded").sort((a,t)=>new Date(t.createdAt).getTime()-new Date(a.createdAt).getTime()));unpaidCount=f(()=>this.all().filter(a=>a.status==="unpaid").length);toLocal=J;modalityIcon(a){return a==="chat"?"chat":a==="voice"?"call":"videocam"}payNow(a){a.status==="unpaid"&&(window.location.href=a.paymentUrl,this.snack.open("Payment successful","OK",{duration:1800}))}downloadReceipt(a){let t=`
<!doctype html>
<meta charset="utf-8">
<title>Receipt ${a.id}</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;padding:24px;background:#0c1018;color:#eaf0ff}
  .card{max-width:640px;margin:auto;border:1px solid #1e2633;border-radius:12px;padding:20px;background:#0f1520}
  h1{margin:0 0 10px;font-size:18px}
  .kv{display:grid;grid-template-columns:140px 1fr;row-gap:8px;column-gap:10px}
  .k{opacity:.75}
  .total{margin-top:12px;padding-top:12px;border-top:1px dashed #2a3446;font-weight:700}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #2a3446;background:#121a27}
</style>
<div class="card">
  <h1>Receipt</h1>
  <div class="kv">
    <div class="k">Invoice</div><div>${a.id}</div>
    <div class="k">Appointment</div><div>${a.appointmentId}</div>
    <div class="k">Date</div><div>${J(a.createdAt)}</div>
    <div class="k">Doctor</div><div>${a.doctor.name} \u2014 ${a.doctor.department}</div>
    <div class="k">Type</div><div><span class="pill">${a.modality}</span></div>
    <div class="k total">Total</div><div class="total">${a.amount.value} ${a.amount.currency}</div>
  </div>
</div>`,o=new Blob([t],{type:"text/html;charset=utf-8"}),l=URL.createObjectURL(o),d=document.createElement("a");d.href=l,d.download=`receipt-${a.id}.html`,d.click(),URL.revokeObjectURL(l)}viewAppointment(a){this.router.navigate(["/patient/appointments"])}setFilter(a){this.status.set(a)}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=O({type:c,selectors:[["app-payments"]],decls:29,vars:4,consts:[["grouped",""],[1,"pay-wrap"],[1,"toolbar"],[1,"title"],[1,"muted"],["aria-label","Filter invoices",1,"filters",3,"change","value"],["value","all"],["value","unpaid"],["value","paid"],["value","refunded"],[4,"ngIf","ngIfElse"],[1,"grid"],["class","inv-card",4,"ngFor","ngForOf"],[1,"inv-card"],[1,"left"],["alt","",1,"avatar",3,"src"],[1,"meta"],[1,"doc"],[1,"name"],[1,"dept","muted"],[1,"when","muted"],[1,"right"],[1,"amount"],[1,"val"],[1,"pill","modality",3,"ngClass"],[1,"actions"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],["mat-stroked-button","",3,"click"],["mat-button","",3,"click"],[1,"status","chip",3,"ngClass"],["mat-flat-button","","color","primary",3,"click"],["class","section",4,"ngIf"],[1,"section"],[1,"status","chip","unpaid"],[1,"status","chip","paid"],[1,"status","chip","refunded"]],template:function(t,o){if(t&1){let l=x();i(0,"div",1)(1,"div",2)(2,"div",3)(3,"mat-icon"),n(4,"receipt_long"),e(),i(5,"h2"),n(6,"Payments & Invoices"),e(),i(7,"span",4),n(8),e()(),i(9,"mat-button-toggle-group",5),u("change",function(Q){return _(l),g(o.setFilter(Q.value))}),i(10,"mat-button-toggle",6)(11,"mat-icon"),n(12,"all_inclusive"),e(),n(13," All"),e(),i(14,"mat-button-toggle",7)(15,"mat-icon"),n(16,"warning"),e(),n(17," Unpaid"),e(),i(18,"mat-button-toggle",8)(19,"mat-icon"),n(20,"check_circle"),e(),n(21," Paid"),e(),i(22,"mat-button-toggle",9)(23,"mat-icon"),n(24,"redeem"),e(),n(25," Refunded"),e()()(),v(26,Y,3,1,"ng-container",10)(27,ot,3,3,"ng-template",null,0,k),e()}if(t&2){let l=E(28);r(8),I("(",o.unpaidCount()," unpaid)"),r(),p("value",o.status()),r(17),p("ngIf",o.status()!=="all")("ngIfElse",l)}},dependencies:[$,T,A,V,R,F,L,N,U,H,K,q,G,j],styles:[".pay-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{opacity:.75;font-size:.9rem}.toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{border-radius:999px;overflow:hidden}.toolbar   .filters   [_nghost-%COMP%]     .mat-button-toggle-button{padding:.38rem .75rem}.section[_ngcontent-%COMP%]{margin-top:1rem}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;margin:0 0 .5rem;font-weight:700}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(2,minmax(0,1fr))}@media (max-width: 1100px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.inv-card[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;gap:1rem;background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 25px #00000040;padding:.85rem}.inv-card[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;gap:.75rem;align-items:center}.inv-card[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;object-fit:cover}.inv-card[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px}.inv-card[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .dept[_ngcontent-%COMP%]{opacity:.8}.inv-card[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .when[_ngcontent-%COMP%]{opacity:.8;font-size:.9rem;margin-top:.15rem}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:grid;align-content:space-between;gap:.5rem;justify-items:end;text-align:right}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{display:grid;gap:.25rem;justify-items:end}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]   .val[_ngcontent-%COMP%]{font-weight:800}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]   .modality.pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.15rem .5rem;border-radius:999px;border:1px solid rgba(255,255,255,.08);background:#ffffff0a;text-transform:capitalize}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]   .modality.pill[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]   .modality.pill.chat[_ngcontent-%COMP%]{border-left:3px solid #5591ff}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]   .modality.pill.voice[_ngcontent-%COMP%]{border-left:3px solid #42d392}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]   .modality.pill.video[_ngcontent-%COMP%]{border-left:3px solid #b78cff}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:flex-end}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .status.chip[_ngcontent-%COMP%]{display:inline-block;padding:.15rem .5rem;border-radius:999px;border:1px solid rgba(255,255,255,.1);background:#ffffff0a;text-transform:capitalize;font-size:.85rem}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .status.chip.unpaid[_ngcontent-%COMP%]{border-left:3px solid #ffb84d}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .status.chip.paid[_ngcontent-%COMP%]{border-left:3px solid #42d392}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .status.chip.refunded[_ngcontent-%COMP%]{border-left:3px solid #7ea6ff}.inv-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .status.chip.failed[_ngcontent-%COMP%]{border-left:3px solid #ff7a7a}"]})},Mt=h;export{h as PaymentsComponent,Mt as default};
