import{$ as i,Nc as d,Sc as f,T as h,Tc as m,W as c,l as p,o as g,ya as u,z as r}from"./chunk-HKUWCROW.js";import{a,b as l}from"./chunk-JKOY2XUY.js";var R={production:!1,apiBaseUrl:"http://localhost:4000/api",socketUrl:"http://localhost:4000"};var y=class s{http=i(m);platformId=i(u);isBrowser=d(this.platformId);baseUrl=R.apiBaseUrl;tokenKey="medtik_token";registerPatient(t){return this.http.post(`${this.baseUrl}/auth/register-patient`,t).pipe(r(e=>this.handleError(e)))}verifyOtp(t){return this.http.post(`${this.baseUrl}/auth/verify-otp`,t).pipe(r(e=>this.handleError(e)))}login(t){return this.http.post(`${this.baseUrl}/auth/login`,t).pipe(h(e=>{e?.token&&this.setToken(e.token)}),g(e=>l(a({},e),{role:e?.token?this.extractRoleFromToken(e.token):null,doctorStatus:e?.doctorStatus??null})),r(e=>this.handleError(e)))}getToken(){return this.isBrowser?localStorage.getItem(this.tokenKey):null}getCurrentRole(){if(!this.isBrowser)return null;let t=this.getToken();return t?this.extractRoleFromToken(t):null}clearToken(){this.isBrowser&&localStorage.removeItem(this.tokenKey)}setToken(t){this.isBrowser&&localStorage.setItem(this.tokenKey,t)}extractRoleFromToken(t){if(!this.isBrowser)return null;try{let e=t.split(".")[1];if(!e)return null;let o=e.replace(/-/g,"+").replace(/_/g,"/"),n=atob(o);return JSON.parse(n)?.role??null}catch(e){return console.warn("Failed to decode JWT role",e),null}}handleError(t){let e="Something went wrong. Please try again.";return t.error?typeof t.error=="string"?e=t.error:typeof t.error=="object"&&(e=t.error.error??t.error.message??e):t.message&&(e=t.message),p(()=>e)}changePassword(t){let e=this.getToken(),o=new f({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""});return this.http.post(`${this.baseUrl}/auth/change-password`,t,{headers:o}).pipe(r(n=>this.handleError(n)))}resendOtp(t){return this.http.post(`${this.baseUrl}/auth/resend-otp`,{email:t}).pipe(r(e=>this.handleError(e)))}static \u0275fac=function(e){return new(e||s)};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};export{R as a,y as b};
