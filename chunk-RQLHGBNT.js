import{a as yt,b as kt}from"./chunk-NOMPSYPU.js";import{a as vt,b as Mt,c as St,e as Ct,f as bt,g as xt,h as Dt}from"./chunk-R5JCIYF3.js";import{a as ft,b as ht,c as _t}from"./chunk-KRFRCSHC.js";import{a as L}from"./chunk-HTWA6YE2.js";import"./chunk-F5X5MWHG.js";import{a as ut,b as gt}from"./chunk-XGLVXY7I.js";import{a as pt}from"./chunk-Y5ANY4EP.js";import"./chunk-3YF2UIUM.js";import"./chunk-4K5T2QBN.js";import{a as lt,h as st,i as ct,m as dt,n as mt}from"./chunk-LCR2LKFI.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import{A as at,b as q,d as S,f as Z,g as J,h as Q,j as M,l as X,m as tt,o as et,r as ot,v as nt,w as it}from"./chunk-YN6JIHUF.js";import"./chunk-JQ5JD7Q3.js";import{a as A,b as B}from"./chunk-W6QHVSTW.js";import{T as rt,Y as V,Z as R}from"./chunk-YSTQL2PO.js";import{$ as w,Ac as Y,Bc as N,Ga as c,Jb as K,Ka as P,Mc as $,Nb as a,Ob as I,Pb as F,Ra as E,Wa as h,bc as U,ea as b,fa as x,fc as y,lb as m,mb as r,nb as n,oa as O,ob as T,vb as D,xb as p,zb as f,zc as H}from"./chunk-HKUWCROW.js";import{a as W,b as z}from"./chunk-JKOY2XUY.js";function $t(l,t){l&1&&(r(0,"div",23),a(1,"Select at least one modality."),n())}function Vt(l,t){l&1&&(r(0,"div",24),a(1,"This time overlaps an existing slot."),n())}function Rt(l,t){if(l&1){let e=D();r(0,"button",25),p("click",function(){b(e);let i=f();return x(i.remove())}),a(1,"Delete"),n()}}var k=class l{constructor(t,e,o){this.dialogRef=t;this.doctorservice=o;this.data=e??{id:"",dayIdx:0,allSlots:[]},this.form=new Q({start:new M(this.data.start??"09:00",{nonNullable:!0,validators:[S.required,S.pattern(/^\d{2}:\d{2}$/)]}),duration:new M(this.data.duration??25,{nonNullable:!0,validators:[S.required,S.min(5),S.max(180)]}),chat:new M(this.data.modalities?.includes("chat")??!0),voice:new M(this.data.modalities?.includes("voice")??!1),video:new M(this.data.modalities?.includes("video")??!1),notes:new M(this.data.notes??"",{nonNullable:!0})})}form;data;get noModSelected(){let t=this.form.value;return!t.chat&&!t.voice&&!t.video}toMinutes(t){let[e,o]=t.split(":").map(Number);return e*60+o}overlaps(t,e){let o=this.data.allSlots??[],i=this.toMinutes(t),s=i+e;return o.some(d=>{let u=this.toMinutes(d.start),v=u+d.duration;return Math.max(i,u)<Math.min(s,v)})}cancel(){this.dialogRef.close()}remove(){if(!this.data.id)return;let t=this.data.id;this.doctorservice.deleteSlot(t.toString()).subscribe({next:()=>{this.dialogRef.close({delete:!0})},error:e=>{console.error("Failed to delete slot:",e)}})}save(){if(this.form.invalid||this.noModSelected)return;let t=this.form.getRawValue();if(this.overlaps(t.start,t.duration)){this.form.setErrors({overlap:!0});return}let e=[];t.chat&&e.push("chat"),t.voice&&e.push("voice"),t.video&&e.push("video");let o={start:t.start,duration:t.duration,modalities:e,notes:(t.notes||"").trim()};this.dialogRef.close(o)}static \u0275fac=function(e){return new(e||l)(P(vt),P(Mt),P(L))};static \u0275cmp=E({type:l,selectors:[["app-slot-dialog"]],decls:43,vars:5,consts:[["mat-dialog-title",""],[1,"content"],[1,"content",3,"formGroup"],[1,"row"],["appearance","outline",1,"field"],["matInput","","type","time","formControlName","start"],["matInput","","type","number","min","5","max","180","formControlName","duration"],[1,"mods"],[1,"checks"],["formControlName","chat"],[1,"chip","chat"],["formControlName","voice"],[1,"chip","voice"],["formControlName","video"],[1,"chip","video"],["class","form-hint",4,"ngIf"],["class","form-hint warn",4,"ngIf"],["appearance","outline",1,"field","full"],["matInput","","rows","3","formControlName","notes"],["align","end"],["mat-button","",3,"click"],["mat-button","","color","warn",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"form-hint"],[1,"form-hint","warn"],["mat-button","","color","warn",3,"click"]],template:function(e,o){e&1&&(r(0,"h2",0)(1,"mat-icon"),a(2,"schedule"),n(),a(3),n(),r(4,"mat-dialog-content",1)(5,"form",2)(6,"div",3)(7,"mat-form-field",4)(8,"mat-label"),a(9,"Start time"),n(),T(10,"input",5),n(),r(11,"mat-form-field",4)(12,"mat-label"),a(13,"Duration (min)"),n(),T(14,"input",6),n()(),r(15,"div",7)(16,"label"),a(17,"Available modalities"),n(),r(18,"div",8)(19,"mat-checkbox",9)(20,"mat-icon",10),a(21,"chat"),n(),a(22," Chat "),n(),r(23,"mat-checkbox",11)(24,"mat-icon",12),a(25,"call"),n(),a(26," Voice "),n(),r(27,"mat-checkbox",13)(28,"mat-icon",14),a(29,"videocam"),n(),a(30," Video "),n()(),h(31,$t,2,0,"div",15)(32,Vt,2,0,"div",16),n(),r(33,"mat-form-field",17)(34,"mat-label"),a(35,"Notes (optional)"),n(),T(36,"textarea",18),n()()(),r(37,"mat-dialog-actions",19)(38,"button",20),p("click",function(){return o.cancel()}),a(39,"Cancel"),n(),h(40,Rt,2,0,"button",21),r(41,"button",22),p("click",function(){return o.save()}),a(42,"Save"),n()()),e&2&&(c(3),F(`
`,o.data.start?"Edit slot":"Add slot",`
`),c(2),m("formGroup",o.form),c(26),m("ngIf",o.noModSelected),c(),m("ngIf",o.form.hasError("overlap")),c(8),m("ngIf",o.data.start))},dependencies:[$,N,at,X,q,tt,Z,J,it,nt,et,ot,Dt,Ct,xt,bt,ct,st,lt,mt,dt,kt,yt,R,V,B,A],styles:['@charset "UTF-8";mat-dialog-content.content[_ngcontent-%COMP%]{padding-top:12px}.content[_ngcontent-%COMP%]{display:grid;gap:1rem}.content[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}@media (max-width: 720px){.content[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.content[_ngcontent-%COMP%]   .field.full[_ngcontent-%COMP%]{grid-column:1/-1}.mat-mdc-form-field[_ngcontent-%COMP%]{--mat-form-field-container-vertical-padding: 16px}.mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important;line-height:1!important}.mods[_ngcontent-%COMP%]{display:grid;gap:.5rem}.mods[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--muted);font-size:.9rem}.mods[_ngcontent-%COMP%]   .checks[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem 1.5rem;align-items:center}.mods[_ngcontent-%COMP%]   .checks[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]{width:26px;height:26px;border-radius:1300px;display:inline-grid;place-items:center;margin-right:.2rem;font-size:12px;box-shadow:0 0 0 1px #ffffff14 inset}.mods[_ngcontent-%COMP%]   .checks[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{background:#4480ff2e;color:#7ea6ff}.mods[_ngcontent-%COMP%]   .checks[_ngcontent-%COMP%]   .voice[_ngcontent-%COMP%]{background:#00b06a2e;color:#62d2a2}.mods[_ngcontent-%COMP%]   .checks[_ngcontent-%COMP%]   .video[_ngcontent-%COMP%]{background:#8b5cf62e;color:#b7a5ff}.mods[_ngcontent-%COMP%]   .form-hint[_ngcontent-%COMP%]{color:#ff9e66;font-size:.85rem}.mods[_ngcontent-%COMP%]   .form-hint.warn[_ngcontent-%COMP%]{color:#ff7a7a}mat-dialog-actions[_ngcontent-%COMP%]{margin-top:.25rem}']})};function At(l,t){if(l&1&&(r(0,"span",31),a(1),n()),l&2){let e=t.$implicit;c(),I(e)}}function Bt(l,t){if(l&1){let e=D();r(0,"div",27),p("click",function(){let i=b(e).$implicit,s=f(3);return x(s.editSlot(i))}),r(1,"div",28)(2,"mat-icon"),a(3,"schedule"),n(),a(4),n(),r(5,"div",29),h(6,At,2,1,"span",30),n()()}if(l&2){let e=t.$implicit,o=f(3);m("ngClass",o.classFor(e)),c(4),F(" ",o.timeRange(e)," "),c(2),m("ngForOf",e.modalities)}}function Lt(l,t){if(l&1&&(r(0,"div",25),h(1,Bt,7,3,"div",26),n()),l&2){let e=f().$implicit,o=f();c(),m("ngForOf",o.slotsForDay(e.date))}}function jt(l,t){l&1&&(r(0,"div",32)(1,"mat-icon"),a(2,"event_busy"),n(),a(3," No slots"),n())}function Gt(l,t){if(l&1){let e=D();r(0,"section",16)(1,"header",17)(2,"div",18),a(3),n(),r(4,"div",19)(5,"span",20),a(6,"Chat"),n(),r(7,"span",21),a(8,"Voice"),n(),r(9,"span",22),a(10,"Video"),n()()(),h(11,Lt,2,1,"div",23)(12,jt,4,0,"ng-template",null,0,U),r(14,"button",24),p("click",function(){let i=b(e).$implicit,s=f();return x(s.addSlot(i.date))}),r(15,"mat-icon"),a(16,"add"),n(),a(17," Add slot "),n()()}if(l&2){let e=t.$implicit,o=K(13),i=f();c(3),I(e.label),c(8),m("ngIf",i.slotsForDay(e.date).length)("ngIfElse",o)}}var Wt=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],_=l=>(l<10?"0":"")+l,zt=l=>`${l.getFullYear()}-${_(l.getMonth()+1)}-${_(l.getDate())}`;function Kt(l){let t=new Date(l),e=t.getDay(),o=e===0?-6:1-e;return t.setDate(t.getDate()+o),t.setHours(0,0,0,0),t}function Ut(l,t){let[e,o]=l.split(":").map(Number),i=e*60+o+t,s=Math.floor(i/60)%24,d=i%60;return`${_(s)}:${_(d)}`}var wt=class l{doctorService=w(L);dialog=w(St);snack=w(pt);daysLabels=Wt;daysIdx=[0,1,2,3,4,5,6];weekOffset=O(0);weekStart=y(()=>{let t=new Date;return t.setDate(t.getDate()+this.weekOffset()*7),Kt(t)});weekLabel=y(()=>{let t=this.weekStart(),e=new Date(t);e.setDate(t.getDate()+6);let o=s=>s.toLocaleDateString("en-US",{day:"numeric",month:"short"});return t.getMonth()===e.getMonth()?`${o(t)} \u2013 ${e.getDate()} ${e.toLocaleDateString("en-US",{month:"short",year:"numeric"})}`:`${o(t)} \u2013 ${o(e)} ${e.getFullYear()}`});weekKey=y(()=>zt(this.weekStart()));store={};_slots=O([]);activeFilter=O("all");ngOnInit(){this.loadSlots()}loadSlots(){let t=this.weekStart(),e=new Date(t);e.setDate(t.getDate()+6);let o=this.store[this.weekKey()];if(o){this._slots.set(o);return}this.doctorService.getProfile().subscribe({next:i=>{let s=i.doctor?.DoctorSlot||[];console.log("Fetched slots:",s);let u=s.filter(v=>{let C=new Date(v.startTime);return C>=t&&C<=e}).map(v=>this.convertToSlot(v));this.store[this.weekKey()]=u,this._slots.set(u)},error:i=>console.error("Error fetching doctor slots:",i)})}convertToSlot(t){let e=new Date(t.startTime),i=(new Date(t.endTime).getTime()-e.getTime())/6e4,s=(e.getDay()+6)%7,d=[];return t.chat&&d.push("chat"),t.voice&&d.push("voice"),t.video&&d.push("video"),{id:t.id,dayIdx:s,start:`${_(e.getHours())}:${_(e.getMinutes())}`,duration:i,modalities:d,notes:t.notes}}slotsForDay(t){let e=this.activeFilter();return this._slots().filter(o=>o.dayIdx===t).filter(o=>e==="all"?!0:o.modalities.includes(e)).sort((o,i)=>o.start.localeCompare(i.start))}timeRange(t){return`${t.start}\u2013${Ut(t.start,t.duration)}`}addSlot(t){let e=this._slots().filter(i=>i.dayIdx===t).map(i=>({start:i.start,duration:i.duration})),o={id:"",dayIdx:t,allSlots:e};this.dialog.open(k,{data:o,panelClass:"medtik-dialog"}).afterClosed().subscribe(i=>{i&&this.saveNewSlot(t,i)})}saveNewSlot(t,e){let o=this.weekStart(),i=new Date(o);i.setDate(o.getDate()+t);let[s,d]=e.start.split(":").map(Number),u=new Date(i);u.setHours(s,d,0,0);let v=new Date(u.getTime()+e.duration*6e4),C=g=>`${String(g.getHours()).padStart(2,"0")}:${String(g.getMinutes()).padStart(2,"0")}:00.000Z`,Ot={date:`${i.getFullYear()}-${_(i.getMonth()+1)}-${_(i.getDate())}`,startTime:C(u),endTime:C(v),chat:e.modalities.includes("chat"),voice:e.modalities.includes("voice"),video:e.modalities.includes("video"),notes:e.notes||""};this.doctorService.addSlot(Ot).subscribe({next:g=>{console.log("Backend addSlot response:",g);let j=g?.slot??g,Pt=this.convertToSlot(j),G=[...this._slots(),Pt];console.log("Updated slots:",G),this._slots.set(G),this.store=z(W({},this.store),{[this.weekKey()]:G}),this.snack.open("Slot added successfully ","Close",{duration:3e3,panelClass:["snack-success"]})},error:g=>{console.error("Failed to save slot:",g);let j=g?.error?.error||"Failed to add slot. Please try again.";this.snack.open(j,"Close",{duration:4e3,panelClass:["snack-error"]})}})}classFor(t){let e=["slot"];return t.modalities.includes("chat")&&e.push("chat"),t.modalities.includes("voice")&&e.push("voice"),t.modalities.includes("video")&&e.push("video"),e.join(" ")}editSlot(t){let e={id:t.id.toString(),dayIdx:t.dayIdx,start:t.start,duration:t.duration,modalities:t.modalities,notes:t.notes||"",editMode:!0,allSlots:this._slots().filter(o=>o.dayIdx===t.dayIdx&&o.id!==t.id)};this.dialog.open(k,{data:e,panelClass:"medtik-dialog"}).afterClosed().subscribe(o=>{if(o&&o.delete){let i=this._slots().filter(s=>s.id!==t.id);this._slots.set(i),this.store=z(W({},this.store),{[this.weekKey()]:i}),this.snack.open("Slot deleted successfully","Close",{duration:3e3,panelClass:["snack-success"]}),this.updateSlot(t,o)}})}updateSlot(t,e){}deleteSlot(t){}setFilter(t){this.activeFilter.set(t)}prevWeek(){this.weekOffset.update(t=>t-1),this.loadSlots()}nextWeek(){this.weekOffset.update(t=>t+1),this.loadSlots()}thisWeek(){this.weekOffset.set(0),this.loadSlots()}displayedDays=y(()=>{let t=this.weekStart(),e=[];for(let o=0;o<7;o++){let i=new Date(t);i.setDate(t.getDate()+o),e.push({date:o,label:i.toLocaleDateString("en-US",{weekday:"short",day:"numeric",month:"short"})})}return e});static \u0275fac=function(e){return new(e||l)};static \u0275cmp=E({type:l,selectors:[["app-schedule"]],decls:37,vars:3,consts:[["emptyDay",""],[1,"sched-wrap"],[1,"toolbar"],[1,"title"],[1,"week-controls"],["mat-icon-button","","matTooltip","Previous week",3,"click"],[1,"week"],["mat-icon-button","","matTooltip","Next week",3,"click"],["mat-stroked-button","",1,"this-week",3,"click"],["aria-label","Filter by modality",1,"filters",3,"change","value"],["value","all"],["value","chat"],["value","voice"],["value","video"],[1,"week-grid"],["class","day-card",4,"ngFor","ngForOf"],[1,"day-card"],[1,"day-head"],[1,"name"],[1,"legend"],[1,"chip","chat"],[1,"chip","voice"],[1,"chip","video"],["class","slots",4,"ngIf","ngIfElse"],["mat-stroked-button","",1,"add",3,"click"],[1,"slots"],["class","slot","matTooltip","Click to edit",3,"ngClass","click",4,"ngFor","ngForOf"],["matTooltip","Click to edit",1,"slot",3,"click","ngClass"],[1,"time"],[1,"mods"],["class","pill",4,"ngFor","ngForOf"],[1,"pill"],[1,"empty"]],template:function(e,o){e&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"mat-icon"),a(4,"calendar_today"),n(),r(5,"h2"),a(6,"Schedule"),n(),r(7,"div",4)(8,"button",5),p("click",function(){return o.prevWeek()}),r(9,"mat-icon"),a(10,"chevron_left"),n()(),r(11,"span",6),a(12),n(),r(13,"button",7),p("click",function(){return o.nextWeek()}),r(14,"mat-icon"),a(15,"chevron_right"),n()(),r(16,"button",8),p("click",function(){return o.thisWeek()}),a(17,"This week"),n()()(),r(18,"mat-button-toggle-group",9),p("change",function(s){return o.setFilter(s.value)}),r(19,"mat-button-toggle",10)(20,"mat-icon"),a(21,"all_inclusive"),n(),a(22," All"),n(),r(23,"mat-button-toggle",11)(24,"mat-icon"),a(25,"chat"),n(),a(26," Chat"),n(),r(27,"mat-button-toggle",12)(28,"mat-icon"),a(29,"call"),n(),a(30," Voice"),n(),r(31,"mat-button-toggle",13)(32,"mat-icon"),a(33,"videocam"),n(),a(34," Video"),n()()(),r(35,"div",14),h(36,Gt,18,3,"section",15),n()()),e&2&&(c(12),I(o.weekLabel()),c(6),m("value",o.activeFilter),c(18),m("ngForOf",o.displayedDays()))},dependencies:[$,H,Y,N,R,V,rt,B,A,_t,ft,ht,gt,ut],styles:[".sched-wrap[_ngcontent-%COMP%]{padding:24px;background:#0b1620;color:#e0e6ed;min-height:100%;overflow-y:auto}.sched-wrap[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:16px}.sched-wrap[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.sched-wrap[_ngcontent-%COMP%]   .week-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:16px}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]{background:#121c26;border-radius:12px;padding:12px}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .day-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .day-head[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]{background:#1f2b3a;color:#5c7aff;border-radius:8px;padding:2px 6px;font-size:.8rem}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .slot[_ngcontent-%COMP%]{background:#182433;border-radius:8px;padding:8px;margin-bottom:6px;cursor:pointer;transition:.2s}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .slot[_ngcontent-%COMP%]:hover{background:#24344a}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .slot[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-weight:600}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .slot[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]{background:#5c7aff;padding:2px 6px;border-radius:6px;font-size:.75rem;margin-right:4px}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .add[_ngcontent-%COMP%]{width:100%;margin-top:8px}.sched-wrap[_ngcontent-%COMP%]   .day-card[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{color:#888;font-size:.9rem;text-align:center;padding:12px 0}.snack-error[_ngcontent-%COMP%]{background:#d32f2f;color:#fff;font-weight:500}.snack-success[_ngcontent-%COMP%]{background:#388e3c;color:#fff;font-weight:500}"]})};export{wt as ScheduleComponent};
