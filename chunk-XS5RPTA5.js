import{a as ne,c as oe,d as ie,e as re,f as ae,g as le,h as me}from"./chunk-R5JCIYF3.js";import{b as X}from"./chunk-7E725CH7.js";import"./chunk-F5X5MWHG.js";import{a as ee,b as te}from"./chunk-XGLVXY7I.js";import{a as $,b as Y}from"./chunk-Y5ANY4EP.js";import"./chunk-MS4AQ6UA.js";import{a as Z,b as J,d as Q}from"./chunk-ZCFZR4S3.js";import"./chunk-3YF2UIUM.js";import"./chunk-4K5T2QBN.js";import{a as O,b as j,h as S,i as E,m as F,n as N}from"./chunk-LCR2LKFI.js";import"./chunk-BR5LHSVS.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import{A as M,b as C,d,f as P,g as U,h as _,j as s,l as R,n as L,o as z,r as q,x as G}from"./chunk-YN6JIHUF.js";import{a as W}from"./chunk-P4UCSFGP.js";import{a as B,b as K}from"./chunk-W6QHVSTW.js";import{b as H}from"./chunk-W6FI7VKQ.js";import{Y as y,Z as x}from"./chunk-YSTQL2PO.js";import{$ as f,Ac as V,Bc as A,Da as I,Ga as l,Ka as D,Mc as w,Nb as o,Ob as v,Ra as b,Wa as c,lb as m,mb as t,nb as e,oa as T,ob as p,xb as u}from"./chunk-HKUWCROW.js";import"./chunk-JKOY2XUY.js";var k=class a{otp=new s("",[d.required,d.pattern(/^\d{6}$/)]);dialogRef=f(ne);verify(){this.otp.valid&&this.dialogRef.close(this.otp.value)}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=b({type:a,selectors:[["app-verify-otp-dialog"]],decls:14,vars:2,consts:[["mat-dialog-title",""],["appearance","outline",1,"full"],["matInput","","type","text","maxlength","6",3,"formControl"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(r,i){r&1&&(t(0,"h2",0),o(1,"Verify Phone Number"),e(),t(2,"mat-dialog-content")(3,"p"),o(4,"Enter the 6-digit OTP sent to your phone."),e(),t(5,"mat-form-field",1)(6,"mat-label"),o(7,"OTP"),e(),p(8,"input",2),e()(),t(9,"mat-dialog-actions",3)(10,"button",4),o(11,"Cancel"),e(),t(12,"button",5),u("click",function(){return i.verify()}),o(13,"Verify"),e()()),r&2&&(l(8),m("formControl",i.otp),l(4),m("disabled",i.otp.invalid))},dependencies:[w,M,C,P,G,L,E,S,O,N,F,x,y,me,ie,re,le,ae],encapsulation:2})};function he(a,n){a&1&&(t(0,"mat-error"),o(1," Name is required (min 3 chars). "),e())}function be(a,n){a&1&&(t(0,"mat-error"),o(1," Enter a valid email. "),e())}function ve(a,n){if(a&1&&(t(0,"mat-option",35),o(1),e()),a&2){let r=n.$implicit;m("value",r.code),l(),v(r.name)}}function we(a,n){if(a&1&&(t(0,"mat-option",35),o(1),e()),a&2){let r=n.$implicit;m("value",r.code),l(),v(r.name)}}function Ce(a,n){if(a&1&&(t(0,"mat-option",35),o(1),e()),a&2){let r=n.$implicit;m("value",r),l(),v(r)}}function Pe(a,n){a&1&&(t(0,"mat-error"),o(1," Required. "),e())}function _e(a,n){a&1&&(t(0,"mat-error"),o(1," Required. "),e())}function Me(a,n){a&1&&(t(0,"mat-error"),o(1," Min 8 characters. "),e())}function ye(a,n){a&1&&(t(0,"mat-error"),o(1," Use letters and numbers. "),e())}function xe(a,n){a&1&&(t(0,"mat-error"),o(1," Passwords don\u2019t match. "),e())}var se=class a{constructor(n){this.patientService=n}snack=f($);auth=f(H);dialog=f(oe);avatarUrl=T("https://i.pravatar.cc/120?img=13");originalPhone="";countries=[{code:"EG",name:"Egypt"},{code:"SA",name:"Saudi Arabia"},{code:"AE",name:"United Arab Emirates"},{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"}];languages=[{code:"en",name:"English"},{code:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"}];timezones=["Africa/Cairo","Asia/Riyadh","Asia/Dubai","Europe/London","America/New_York"];isPhoneVerified=!1;otpDialogOpen=!1;profileForm=new _({fullName:new s("",{nonNullable:!0,validators:[d.required,d.minLength(3)]}),email:new s("",{nonNullable:!0,validators:[d.required,d.email]}),dob:new s(""),phone:new s(""),country:new s("EG",{nonNullable:!0}),gender:new s("female",{nonNullable:!0}),language:new s("en",{nonNullable:!0}),timezone:new s("Africa/Cairo",{nonNullable:!0})});ngOnInit(){this.loadProfile()}loadProfile(){this.patientService.getProfile().subscribe({next:n=>{console.log("Loaded profile:",n),console.log("Loaded profile:",n.user.patient),console.log("Loaded profile:",n.user.patient.phone);let r=n?.user?.patient||{};this.originalPhone=r.phone||"",this.profileForm.get("phone")?.valueChanges.subscribe(i=>{this.isPhoneVerified=i===this.originalPhone}),this.avatarUrl.set(r.avatar||""),this.profileForm.patchValue({fullName:n?.user?.fullName||"",email:n?.user?.email||"",dob:r.birthdate?r.birthdate.split("T")[0]:"",phone:r.phone||"",country:r.country||"EG",gender:r.gender||"female",language:"en",timezone:"Africa/Cairo"}),n?.avatarUrl&&this.avatarUrl.set(n.avatarUrl)},error:n=>{console.error("Profile load failed:",n),this.snack.open("Failed to load profile","Close",{duration:2500})}})}onPickAvatar(n){let i=n.target?.files?.[0];if(i){try{URL.revokeObjectURL(this.avatarUrl())}catch{}this.avatarUrl.set(URL.createObjectURL(i)),this.snack.open("Photo updated (local preview)","OK",{duration:1500})}}saveProfile(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched();return}let n={fullName:this.profileForm.value.fullName,email:this.profileForm.value.email,phone:this.profileForm.value.phone,country:this.profileForm.value.country,birthdate:this.profileForm.value.dob,gender:this.profileForm.value.gender,avatarUrl:this.avatarUrl()};this.patientService.updateProfile(n).subscribe({next:r=>{this.snack.open("Profile updated successfully!","OK",{duration:2e3})},error:r=>{console.error("Profile update failed:",r),this.snack.open("Failed to update profile","Close",{duration:2500})}})}passwordForm=new _({oldPassword:new s("",{nonNullable:!0,validators:[d.required]}),newPassword:new s("",{nonNullable:!0,validators:[d.required,d.minLength(8),d.pattern(/^(?=.*[A-Za-z])(?=.*\d).{8,}$/)]}),confirm:new s("",{nonNullable:!0,validators:[d.required]})},{validators:[Oe]});changePassword(){if(this.passwordForm.invalid){this.passwordForm.markAllAsTouched();return}let{oldPassword:n,newPassword:r,confirm:i}=this.passwordForm.getRawValue(),g={currentPassword:n,newPassword:r,verifyPassword:i};this.auth.changePassword(g).subscribe({next:h=>{this.snack.open(h.message,"OK",{duration:2e3}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""})},error:h=>{this.snack.open(h,"Close",{duration:2500})}}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""}),this.snack.open("Password changed","OK",{duration:1400})}notiForm=new _({push:new s(!0,{nonNullable:!0}),email:new s(!0,{nonNullable:!0}),appt:new s(!0,{nonNullable:!0}),chat:new s(!0,{nonNullable:!0}),marketing:new s(!1,{nonNullable:!0})});saveNotifications(){this.snack.open("Notification preferences saved","OK",{duration:1200})}openVerifyDialog(){let n=this.profileForm.value.phone;if(!n){this.snack.open("Enter a phone number first","Close",{duration:2e3});return}this.patientService.sendOtp(n).subscribe({next:()=>{this.dialog.open(k).afterClosed().subscribe(i=>{i&&this.verifyOtp(i)})},error:()=>{this.snack.open("Failed to send OTP. Try again.","Close",{duration:2e3})}})}verifyOtp(n){this.patientService.verifyOtp(n).subscribe({next:()=>{this.isPhoneVerified=!0,this.originalPhone=this.profileForm.value.phone||"",this.snack.open("Phone verified successfully","OK",{duration:2e3})},error:()=>{this.snack.open("Invalid OTP. Please try again.","Close",{duration:2e3})}})}static \u0275fac=function(r){return new(r||a)(D(W))};static \u0275cmp=b({type:a,selectors:[["app-settings"]],decls:96,vars:17,consts:[[1,"settings-wrap"],[1,"toolbar"],[1,"title"],[1,"glowdot"],[1,"grid"],[1,"card","neo"],[1,"section-head"],[1,"profile"],[1,"avatar"],["alt","",3,"src"],["matTooltip","Change photo",1,"change"],["type","file","accept","image/*",3,"change"],[1,"form",3,"formGroup"],["appearance","outline",1,"field","full"],["matInput","","formControlName","fullName"],[4,"ngIf"],["matInput","","formControlName","email","type","email"],["appearance","outline",1,"field"],["formControlName","gender"],["value","male"],["value","female"],["matInput","","type","date","formControlName","dob"],["appearance","outline","matTooltip","You can't change your phone number","matTooltipPosition","below",1,"field","verify-field"],["matInput","","formControlName","phone","readonly","","tabindex","-1",1,"readonly-input"],["formControlName","country"],[3,"value",4,"ngFor","ngForOf"],["formControlName","language"],["formControlName","timezone"],[1,"actions"],["mat-flat-button","","color","primary",1,"neon",3,"click","disabled"],[1,"pwd",3,"formGroup"],["matInput","","formControlName","oldPassword","autocomplete","current-password",3,"type"],["matInput","","formControlName","newPassword","autocomplete","new-password",3,"type"],["matInput","","formControlName","confirm","autocomplete","new-password",3,"type"],["mat-stroked-button","",1,"neon",3,"click"],[3,"value"]],template:function(r,i){r&1&&(t(0,"div",0)(1,"div",1)(2,"div",2),p(3,"span",3),t(4,"h2"),o(5,"Settings"),e()()(),t(6,"div",4)(7,"section",5)(8,"header",6)(9,"mat-icon"),o(10,"account_circle"),e(),t(11,"h3"),o(12,"Profile"),e()(),t(13,"div",7)(14,"div",8),p(15,"img",9),t(16,"label",10)(17,"input",11),u("change",function(h){return i.onPickAvatar(h)}),e(),t(18,"mat-icon"),o(19,"camera_alt"),e()()(),t(20,"form",12)(21,"mat-form-field",13)(22,"mat-label"),o(23,"Full name"),e(),p(24,"input",14),c(25,he,2,0,"mat-error",15),e(),t(26,"mat-form-field",13)(27,"mat-label"),o(28,"Email"),e(),p(29,"input",16),c(30,be,2,0,"mat-error",15),e(),t(31,"mat-form-field",17)(32,"mat-label"),o(33,"Gender"),e(),t(34,"mat-select",18)(35,"mat-option",19),o(36,"Male"),e(),t(37,"mat-option",20),o(38,"Female"),e()()(),t(39,"mat-form-field",17)(40,"mat-label"),o(41,"Date of birth"),e(),p(42,"input",21),e(),t(43,"mat-form-field",22)(44,"mat-label"),o(45,"Phone"),e(),p(46,"input",23),e(),t(47,"mat-form-field",17)(48,"mat-label"),o(49,"Country"),e(),t(50,"mat-select",24),c(51,ve,2,2,"mat-option",25),e()(),t(52,"mat-form-field",17)(53,"mat-label"),o(54,"Language"),e(),t(55,"mat-select",26),c(56,we,2,2,"mat-option",25),e()(),t(57,"mat-form-field",13)(58,"mat-label"),o(59,"Time zone"),e(),t(60,"mat-select",27),c(61,Ce,2,2,"mat-option",25),e()(),t(62,"div",28)(63,"button",29),u("click",function(){return i.saveProfile()}),t(64,"mat-icon"),o(65,"save"),e(),o(66," Save profile "),e()()()()(),t(67,"section",5)(68,"header",6)(69,"mat-icon"),o(70,"lock_reset"),e(),t(71,"h3"),o(72,"Change password"),e()(),t(73,"form",30)(74,"mat-form-field",13)(75,"mat-label"),o(76,"Current password"),e(),p(77,"input",31),c(78,Pe,2,0,"mat-error",15),e(),t(79,"mat-form-field",17)(80,"mat-label"),o(81,"New password"),e(),p(82,"input",32),c(83,_e,2,0,"mat-error",15)(84,Me,2,0,"mat-error",15)(85,ye,2,0,"mat-error",15),e(),t(86,"mat-form-field",17)(87,"mat-label"),o(88,"Confirm new password"),e(),p(89,"input",33),c(90,xe,2,0,"mat-error",15),e(),t(91,"div",28)(92,"button",34),u("click",function(){return i.changePassword()}),t(93,"mat-icon"),o(94,"key"),e(),o(95," Update password "),e()()()()()()),r&2&&(l(15),m("src",i.avatarUrl(),I),l(5),m("formGroup",i.profileForm),l(5),m("ngIf",i.profileForm.controls.fullName.invalid&&i.profileForm.controls.fullName.touched),l(5),m("ngIf",i.profileForm.controls.email.invalid&&i.profileForm.controls.email.touched),l(21),m("ngForOf",i.countries),l(5),m("ngForOf",i.languages),l(5),m("ngForOf",i.timezones),l(2),m("disabled",!i.isPhoneVerified||i.profileForm.invalid),l(10),m("formGroup",i.passwordForm),l(4),m("type","password"),l(),m("ngIf",i.passwordForm.controls.oldPassword.invalid&&i.passwordForm.controls.oldPassword.touched),l(4),m("type","password"),l(),m("ngIf",i.passwordForm.controls.newPassword.hasError("required")&&i.passwordForm.controls.newPassword.touched),l(),m("ngIf",i.passwordForm.controls.newPassword.hasError("minlength")&&i.passwordForm.controls.newPassword.touched),l(),m("ngIf",i.passwordForm.controls.newPassword.hasError("pattern")&&i.passwordForm.controls.newPassword.touched),l(4),m("type","password"),l(),m("ngIf",i.passwordForm.hasError("passwordMismatch")&&i.passwordForm.controls.confirm.touched))},dependencies:[w,V,A,M,R,C,P,U,z,q,K,B,x,y,te,ee,E,S,O,j,N,F,Q,J,Z,X,Y],styles:['.settings-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:900;letter-spacing:.3px}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .glowdot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#71c2ff,#3b8bd3 40%,transparent 65%);box-shadow:0 0 24px #3b8bd3cc}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(1,minmax(0,1fr))}@media (max-width: 1080px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.card.neo[_ngcontent-%COMP%]{position:relative;background:linear-gradient(180deg,#ffffff0a,#ffffff05);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 20px 60px #00000073;padding:.9rem;overflow:hidden}.card.neo[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:-2px;background:conic-gradient(from 0deg,#71c2ffbf,#b78cffbf,#1db7a0bf,#71c2ffbf);filter:blur(18px);opacity:.18;transition:opacity .25s var(--ease);z-index:0}.card.neo[_ngcontent-%COMP%]:hover:before{opacity:.28}.section-head[_ngcontent-%COMP%]{position:relative;z-index:1;display:flex;align-items:center;gap:.6rem;margin-bottom:.55rem}.section-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.section-head[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.1);background:#ffffff0f;border-radius:12px;padding:.35rem}.profile[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:auto 1fr;gap:1rem;align-items:start}.avatar[_ngcontent-%COMP%]{position:relative;width:92px;height:92px;border-radius:50%;overflow:hidden;border:1px solid rgba(255,255,255,.1);box-shadow:0 10px 25px #00000059}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{position:absolute;right:-8px;bottom:-8px;width:38px;height:38px;border-radius:50%;display:grid;place-items:center;background:#ffffff1f;border:1px solid rgba(255,255,255,.18);cursor:pointer}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.field.full[_ngcontent-%COMP%]{grid-column:1/-1}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;margin-top:.5rem}.pwd[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.pwd[_ngcontent-%COMP%]   .field.full[_ngcontent-%COMP%]{grid-column:1/-1}.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:1fr 1fr}@media (max-width: 900px){.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.notis[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{display:grid;gap:.35rem}.notis[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px;opacity:.95}.neon[_ngcontent-%COMP%]{position:relative;border-radius:12px;box-shadow:0 8px 30px #3b8bd340}.neon[_ngcontent-%COMP%]:hover{box-shadow:0 12px 38px #3b8bd359}.mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important;line-height:1!important}.mat-mdc-form-field[_ngcontent-%COMP%]{--mat-form-field-container-vertical-padding: 15px}.verify-field[_ngcontent-%COMP%]{display:flex;align-items:center}.verify-field[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:4px}.readonly-input[_ngcontent-%COMP%]{pointer-events:none;color:#837a7acc;cursor:not-allowed}  .mat-mdc-tooltip{margin-top:-50px!important}']})};function Oe(a){let n=a.get("newPassword")?.value,r=a.get("confirm")?.value;return!n||!r||n===r?null:{passwordMismatch:!0}}export{se as SettingsComponent};
