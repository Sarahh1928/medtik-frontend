import{d as X}from"./chunk-B453S2AB.js";import{a as Y,b as H,c as J}from"./chunk-KRFRCSHC.js";import{a as $}from"./chunk-2CXAHJYG.js";import"./chunk-F5X5MWHG.js";import{a as G,b as Q}from"./chunk-XGLVXY7I.js";import{a as z,b as U}from"./chunk-Y5ANY4EP.js";import"./chunk-4K5T2QBN.js";import{a as A,h as L,m as K,n as j}from"./chunk-LCR2LKFI.js";import{a as W}from"./chunk-CDNE4KZQ.js";import"./chunk-LVHP3QQG.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import"./chunk-YN6JIHUF.js";import{a as R,b as V}from"./chunk-W6QHVSTW.js";import"./chunk-W6FI7VKQ.js";import{T as F,Y as B,Z as q}from"./chunk-YSTQL2PO.js";import{d as T}from"./chunk-QJG5D5WU.js";import{$ as u,$b as h,Ac as S,Bc as D,Ga as r,Ic as E,Lb as O,Mc as I,Nb as a,Ob as p,Pb as P,Ra as y,Wa as g,_b as k,ea as b,fa as C,fc as M,lb as c,mb as o,nb as i,oa as _,vb as N,xb as f,zb as d,zc as w}from"./chunk-HKUWCROW.js";import{a as x,b as v}from"./chunk-JKOY2XUY.js";function tt(l,e){if(l&1&&(o(0,"span",17),a(1),i()),l&2){let t=d();r(),p(t.counts().all)}}function et(l,e){if(l&1&&(o(0,"span",17),a(1),i()),l&2){let t=d();r(),p(t.counts().appointment)}}function nt(l,e){if(l&1&&(o(0,"span",17),a(1),i()),l&2){let t=d();r(),p(t.counts().mention)}}function it(l,e){if(l&1&&(o(0,"span",17),a(1),i()),l&2){let t=d();r(),p(t.counts().review)}}function ot(l,e){if(l&1&&(o(0,"span",17),a(1),i()),l&2){let t=d();r(),p(t.counts().system)}}function at(l,e){if(l&1){let t=N();o(0,"div",18)(1,"div",19)(2,"div",20)(3,"mat-icon"),a(4),i()(),o(5,"span",21),a(6),k(7,"titlecase"),i(),o(8,"div",22)(9,"div",23)(10,"span",2),a(11),i(),o(12,"span",24),a(13,"\u2022"),i(),o(14,"span",25),a(15),i()(),o(16,"div",26),a(17),i()()(),o(18,"div",27)(19,"button",28),f("click",function(){let s=b(t).$implicit,m=d();return C(m.toggleRead(s))}),o(20,"mat-icon"),a(21),i()(),o(22,"button",29),f("click",function(){let s=b(t).$implicit,m=d();return C(m.clear(s.kind))}),o(23,"mat-icon"),a(24,"close"),i()()()()}if(l&2){let t=e.$implicit,n=d();r(2),c("ngClass",t.kind),r(2),p(n.icon(t.kind)),r(),c("ngClass",n.badgeClass(t.kind)),r(),P(" ",h(7,10,t.kind)," "),r(5),p(t.title),r(4),p(n.time(t.time)),r(),O("muted",t.read),r(),p(t.message),r(4),p(t.read?"mark_email_read":"mark_email_unread")}}function rt(l,e){l&1&&(o(0,"div",30)(1,"mat-icon"),a(2,"inbox"),i(),o(3,"div"),a(4,"No notifications"),i()())}var Z=class l{snack=u(z);service=u($);socketService=u(W);router=u(T);all=_([]);query=_("");filter=_("all");filtered=M(()=>{let e=this.query().trim().toLowerCase(),t=this.filter();console.log("Filter:",t,"Query:",e),console.log("All notifications:",this.all());let n=this.all().filter(s=>t==="all"?!0:s.kind===t).filter(s=>!e||s.title.toLowerCase().includes(e)||s.message.toLowerCase().includes(e)).sort((s,m)=>+new Date(m.time)-+new Date(s.time));return console.log("Filtered list:",n),n});ngOnInit(){this.loadNotifications(),this.listenForNotifications()}ngOnDestroy(){console.log("\u{1F9F9} DoctorNotificationsComponent destroyed")}loadNotifications(){this.service.getNotifications().subscribe({next:e=>{console.log("Notifications:",e),this.all.set(e.map(t=>({id:t.id,kind:t.type?.toUpperCase()??"UNKNOWN",title:t.title,message:t.message,time:t.createdAt,read:t.read})))},error:e=>{console.error("\u274C Failed to load notifications:",e),this.snack.open("Failed to load notifications","OK",{duration:1500})}})}listenForNotifications(){console.log("\u{1F514} Setting up socket listener for notifications..."),this.socketService.on("notification:new",e=>{console.log("\u{1F4E9} [Socket] New notification received:",e);let t={id:e.id,kind:e.type?.toUpperCase()??"UNKNOWN",title:e.title,message:e.message,time:e.createdAt||new Date().toISOString(),read:!1};this.all.update(n=>[t,...n]),this.snack.open("New notification","View",{duration:2500}).onAction().subscribe(()=>this.open(t))})}open(e){console.log("\u{1F9ED} Navigating to notification:",e),this.router.navigate(["/doctor/notifications"])}markRead(e){this.all.update(t=>t.map(n=>n.id===e.id?v(x({},n),{read:!0}):n))}toggleRead(e){this.all.update(t=>t.map(n=>n.id===e.id?v(x({},n),{read:!n.read}):n))}clear(e){confirm("Clear notifications?")&&(!e||e==="all"?this.all.set([]):this.all.update(t=>t.filter(n=>n.kind!==e)),this.snack.open("Notifications cleared","OK",{duration:1200}))}time(e){return new Date(e).toLocaleString()}badgeClass(e){return{appointment:e==="appointment",review:e==="review",mention:e==="mention",system:e==="system"}}counts=M(()=>{let e={all:0,appointment:0,mention:0,review:0,system:0};for(let t of this.all())t.read||(e.all++,e[t.kind]++);return e});icon(e){switch(e){case"appointment":return"event_available";case"mention":return"chat";case"review":return"receipt_long";case"system":return"notifications"}}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=y({type:l,selectors:[["app-doctor-notifications"]],decls:43,vars:9,consts:[[1,"wrap","container"],[1,"toolbar"],[1,"title"],[1,"controls"],["appearance","outline",1,"search"],["matInput","",3,"input","value"],[1,"filters",3,"change","value"],["value","all"],["class","badge",4,"ngIf"],["value","appointment"],["value","mention"],["value","review"],["value","system"],["mat-stroked-button","",3,"click"],[1,"list","card"],["class","item",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"badge"],[1,"item"],[1,"left"],[1,"icon",3,"ngClass"],[1,"pill",3,"ngClass"],[1,"meta"],[1,"t"],[1,"dot"],[1,"time"],[1,"b"],[1,"right"],["mat-icon-button","","matTooltip","Toggle read",3,"click"],["mat-icon-button","","matTooltip","Dismiss",3,"click"],[1,"empty"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"header",1)(2,"div",2)(3,"mat-icon"),a(4,"notificationss"),i(),o(5,"h2"),a(6,"Notifications"),i()(),o(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),a(10,"Search"),i(),o(11,"input",5),f("input",function(m){return n.query.set(m.target.value)}),i()(),o(12,"mat-button-toggle-group",6),f("change",function(m){return n.filter.set(m.value)}),o(13,"mat-button-toggle",7)(14,"mat-icon"),a(15,"all_inclusive"),i(),a(16," All "),g(17,tt,2,1,"span",8),i(),o(18,"mat-button-toggle",9)(19,"mat-icon"),a(20,"event_available"),i(),a(21," Appointments "),g(22,et,2,1,"span",8),i(),o(23,"mat-button-toggle",10)(24,"mat-icon"),a(25,"chat"),i(),a(26," Mentions "),g(27,nt,2,1,"span",8),i(),o(28,"mat-button-toggle",11)(29,"mat-icon"),a(30,"folder_shared"),i(),a(31," Reviews "),g(32,it,2,1,"span",8),i(),o(33,"mat-button-toggle",12)(34,"mat-icon"),a(35,"notifications"),i(),a(36," System "),g(37,ot,2,1,"span",8),i()(),o(38,"button",13),f("click",function(){return n.clear()}),a(39,"Clear all"),i()()(),o(40,"section",14),g(41,at,25,12,"div",15)(42,rt,5,0,"div",16),i()()),t&2&&(r(11),c("value",n.query()),r(),c("value",n.filter()),r(5),c("ngIf",n.counts().all),r(5),c("ngIf",n.counts().appointment),r(5),c("ngIf",n.counts().mention),r(5),c("ngIf",n.counts().review),r(5),c("ngIf",n.counts().system),r(4),c("ngForOf",n.filtered()),r(),c("ngIf",!n.filtered().length))},dependencies:[I,w,S,D,V,R,q,B,F,X,Q,G,U,J,Y,H,j,K,L,A,E],styles:[".wrap[_ngcontent-%COMP%]{padding:14px 12px}.bar[_ngcontent-%COMP%]{display:grid;gap:12px;align-items:center;margin-bottom:10px;grid-template-columns:auto 1fr}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:flex-end;flex-wrap:wrap}.search[_ngcontent-%COMP%]{width:min(340px,45vw)}.list.card[_ngcontent-%COMP%]{padding:8px;display:grid;gap:8px}.item[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;gap:10px;padding:12px;border:1px solid var(--border);border-radius:14px;background:#ffffff08}.left[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:flex-start}.meta[_ngcontent-%COMP%]{display:grid;gap:4px}.t[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;flex-wrap:wrap}.title[_ngcontent-%COMP%]{font-weight:800}.time[_ngcontent-%COMP%]{opacity:.8;font-size:12px}.b.muted[_ngcontent-%COMP%]{opacity:.6}.pill[_ngcontent-%COMP%]{padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--border);text-transform:capitalize}.pill.appointment[_ngcontent-%COMP%]{background:#1db7a029}.pill.mention[_ngcontent-%COMP%]{background:#3b8bd329}.pill.review[_ngcontent-%COMP%]{background:#eab30829}.pill.system[_ngcontent-%COMP%]{background:#94a3b829}.right[_ngcontent-%COMP%]{display:flex;gap:6px}.empty[_ngcontent-%COMP%]{text-align:center;opacity:.8;padding:20px 0;display:grid;gap:6px}.filters[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;border-radius:16px;margin-bottom:.9rem}.filters[_ngcontent-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{border:none;background:transparent}.filters[_ngcontent-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{border-radius:999px!important;margin-right:.35rem;border:1px solid rgba(255,255,255,.08)!important;background:#ffffff05}.filters[_ngcontent-%COMP%]   .mat-button-toggle-checked[_ngcontent-%COMP%]{background:#ffffff0f!important}.filters[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{margin-left:.35rem;font-size:.75rem;padding:.05rem .4rem;border-radius:999px;background:#ffffff1f}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem;margin-bottom:.75rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.toolbar[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{position:relative}.toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:min(540px,75vw);padding:.55rem 2.2rem .55rem .9rem;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#ffffff05;color:var(--text);outline:none}.toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);opacity:.7}"]})};export{Z as DoctorNotificationsComponent};
