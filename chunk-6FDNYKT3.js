import{a as me,c as se,d as pe,e as de,f as ce,g as fe,h as ue}from"./chunk-R5JCIYF3.js";import{b as re}from"./chunk-7E725CH7.js";import"./chunk-F5X5MWHG.js";import{a as ae,b as le}from"./chunk-XGLVXY7I.js";import{a as W,b as X}from"./chunk-Y5ANY4EP.js";import"./chunk-MS4AQ6UA.js";import{a as te,b as ne,d as oe}from"./chunk-ZCFZR4S3.js";import"./chunk-3YF2UIUM.js";import"./chunk-4K5T2QBN.js";import{a as S,b as Y,e as Z,h as O,i as E,m as F,n as N}from"./chunk-LCR2LKFI.js";import"./chunk-BR5LHSVS.js";import"./chunk-OY7Y436C.js";import"./chunk-YCVTR2B7.js";import"./chunk-TR43TC6U.js";import{A as M,b as w,d as p,f as C,g as q,h as P,j as s,l as G,n as j,o as B,r as K,x as $}from"./chunk-YN6JIHUF.js";import{a as ie}from"./chunk-3CM536L4.js";import{b as ee}from"./chunk-JQ5JD7Q3.js";import{a as J,b as Q}from"./chunk-W6QHVSTW.js";import{T as H,Y as y,Z as x}from"./chunk-YSTQL2PO.js";import{$ as g,Ac as L,Bc as z,Da as D,Ga as l,Ka as A,Mc as _,Nb as i,Ob as v,Ra as b,Wa as c,ea as I,fa as T,lb as m,mb as t,nb as e,oa as V,ob as d,vb as U,xb as u,zb as R}from"./chunk-HKUWCROW.js";import"./chunk-JKOY2XUY.js";var k=class a{otp=new s("",[p.required,p.pattern(/^\d{6}$/)]);dialogRef=g(me);verify(){this.otp.valid&&this.dialogRef.close(this.otp.value)}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=b({type:a,selectors:[["app-verify-otp-dialog"]],decls:14,vars:2,consts:[["mat-dialog-title",""],["appearance","outline",1,"full"],["matInput","","type","text","maxlength","6",3,"formControl"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(r,o){r&1&&(t(0,"h2",0),i(1,"Verify Phone Number"),e(),t(2,"mat-dialog-content")(3,"p"),i(4,"Enter the 6-digit OTP sent to your phone."),e(),t(5,"mat-form-field",1)(6,"mat-label"),i(7,"OTP"),e(),d(8,"input",2),e()(),t(9,"mat-dialog-actions",3)(10,"button",4),i(11,"Cancel"),e(),t(12,"button",5),u("click",function(){return o.verify()}),i(13,"Verify"),e()()),r&2&&(l(8),m("formControl",o.otp),l(4),m("disabled",o.otp.invalid))},dependencies:[_,M,w,C,$,j,E,O,S,N,F,x,y,ue,pe,de,fe,ce],encapsulation:2})};function Pe(a,n){a&1&&(t(0,"mat-error"),i(1," Name is required (min 3 chars). "),e())}function Me(a,n){a&1&&(t(0,"mat-error"),i(1," Enter a valid email. "),e())}function ye(a,n){if(a&1){let r=U();t(0,"button",37),u("click",function(){I(r);let f=R();return T(f.openVerifyDialog())}),t(1,"mat-icon"),i(2,"verified"),e()()}}function xe(a,n){a&1&&(t(0,"mat-icon",38),i(1,"check_circle"),e())}function Se(a,n){if(a&1&&(t(0,"mat-option",39),i(1),e()),a&2){let r=n.$implicit;m("value",r.code),l(),v(r.name)}}function Oe(a,n){if(a&1&&(t(0,"mat-option",39),i(1),e()),a&2){let r=n.$implicit;m("value",r.code),l(),v(r.name)}}function Ee(a,n){if(a&1&&(t(0,"mat-option",39),i(1),e()),a&2){let r=n.$implicit;m("value",r),l(),v(r)}}function Fe(a,n){a&1&&(t(0,"mat-error"),i(1," Required. "),e())}function Ne(a,n){a&1&&(t(0,"mat-error"),i(1," Required. "),e())}function ke(a,n){a&1&&(t(0,"mat-error"),i(1," Min 8 characters. "),e())}function Ie(a,n){a&1&&(t(0,"mat-error"),i(1," Use letters and numbers. "),e())}function Te(a,n){a&1&&(t(0,"mat-error"),i(1," Passwords don\u2019t match. "),e())}var ge=class a{constructor(n){this.patientService=n}snack=g(W);auth=g(ee);dialog=g(se);avatarUrl=V("https://i.pravatar.cc/120?img=13");originalPhone="";countries=[{code:"EG",name:"Egypt"},{code:"SA",name:"Saudi Arabia"},{code:"AE",name:"United Arab Emirates"},{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"}];languages=[{code:"en",name:"English"},{code:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"}];timezones=["Africa/Cairo","Asia/Riyadh","Asia/Dubai","Europe/London","America/New_York"];isPhoneVerified=!1;otpDialogOpen=!1;profileForm=new P({fullName:new s("",{nonNullable:!0,validators:[p.required,p.minLength(3)]}),email:new s("",{nonNullable:!0,validators:[p.required,p.email]}),dob:new s(""),phone:new s(""),country:new s("EG",{nonNullable:!0}),gender:new s("female",{nonNullable:!0}),language:new s("en",{nonNullable:!0}),timezone:new s("Africa/Cairo",{nonNullable:!0})});ngOnInit(){this.loadProfile()}loadProfile(){this.patientService.getProfile().subscribe({next:n=>{console.log("Loaded profile:",n),console.log("Loaded profile:",n.user.patient),console.log("Loaded profile:",n.user.patient.phone);let r=n?.user?.patient||{};this.originalPhone=r.phone||"",this.profileForm.get("phone")?.valueChanges.subscribe(o=>{this.isPhoneVerified=o===this.originalPhone}),this.profileForm.patchValue({fullName:n?.user?.fullName||"",email:n?.user?.email||"",dob:r.birthdate?r.birthdate.split("T")[0]:"",phone:r.phone||"",country:r.country||"EG",gender:r.gender||"female",language:"en",timezone:"Africa/Cairo"}),n?.avatarUrl&&this.avatarUrl.set(n.avatarUrl)},error:n=>{console.error("Profile load failed:",n),this.snack.open("Failed to load profile","Close",{duration:2500})}})}onPickAvatar(n){let o=n.target?.files?.[0];if(o){try{URL.revokeObjectURL(this.avatarUrl())}catch{}this.avatarUrl.set(URL.createObjectURL(o)),this.snack.open("Photo updated (local preview)","OK",{duration:1500})}}saveProfile(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched();return}let n={fullName:this.profileForm.value.fullName,email:this.profileForm.value.email,phone:this.profileForm.value.phone,country:this.profileForm.value.country,birthdate:this.profileForm.value.dob,gender:this.profileForm.value.gender,avatarUrl:this.avatarUrl()};this.patientService.updateProfile(n).subscribe({next:r=>{this.snack.open("Profile updated successfully!","OK",{duration:2e3})},error:r=>{console.error("Profile update failed:",r),this.snack.open("Failed to update profile","Close",{duration:2500})}})}passwordForm=new P({oldPassword:new s("",{nonNullable:!0,validators:[p.required]}),newPassword:new s("",{nonNullable:!0,validators:[p.required,p.minLength(8),p.pattern(/^(?=.*[A-Za-z])(?=.*\d).{8,}$/)]}),confirm:new s("",{nonNullable:!0,validators:[p.required]})},{validators:[Ve]});changePassword(){if(this.passwordForm.invalid){this.passwordForm.markAllAsTouched();return}let{oldPassword:n,newPassword:r,confirm:o}=this.passwordForm.getRawValue(),f={currentPassword:n,newPassword:r,verifyPassword:o};this.auth.changePassword(f).subscribe({next:h=>{this.snack.open(h.message,"OK",{duration:2e3}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""})},error:h=>{this.snack.open(h,"Close",{duration:2500})}}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""}),this.snack.open("Password changed","OK",{duration:1400})}notiForm=new P({push:new s(!0,{nonNullable:!0}),email:new s(!0,{nonNullable:!0}),appt:new s(!0,{nonNullable:!0}),chat:new s(!0,{nonNullable:!0}),marketing:new s(!1,{nonNullable:!0})});saveNotifications(){this.snack.open("Notification preferences saved","OK",{duration:1200})}openVerifyDialog(){let n=this.profileForm.value.phone;if(!n){this.snack.open("Enter a phone number first","Close",{duration:2e3});return}this.patientService.sendOtp(n).subscribe({next:()=>{this.dialog.open(k).afterClosed().subscribe(o=>{o&&this.verifyOtp(o)})},error:()=>{this.snack.open("Failed to send OTP. Try again.","Close",{duration:2e3})}})}verifyOtp(n){this.patientService.verifyOtp(n).subscribe({next:()=>{this.isPhoneVerified=!0,this.originalPhone=this.profileForm.value.phone||"",this.snack.open("Phone verified successfully","OK",{duration:2e3})},error:()=>{this.snack.open("Invalid OTP. Please try again.","Close",{duration:2e3})}})}static \u0275fac=function(r){return new(r||a)(A(ie))};static \u0275cmp=b({type:a,selectors:[["app-settings"]],decls:98,vars:19,consts:[[1,"settings-wrap"],[1,"toolbar"],[1,"title"],[1,"glowdot"],[1,"grid"],[1,"card","neo"],[1,"section-head"],[1,"profile"],[1,"avatar"],["alt","",3,"src"],["matTooltip","Change photo",1,"change"],["type","file","accept","image/*",3,"change"],[1,"form",3,"formGroup"],["appearance","outline",1,"field","full"],["matInput","","formControlName","fullName"],[4,"ngIf"],["matInput","","formControlName","email","type","email"],["appearance","outline",1,"field"],["formControlName","gender"],["value","male"],["value","female"],["matInput","","type","date","formControlName","dob"],["appearance","outline",1,"field","verify-field"],["matInput","","formControlName","phone"],["mat-icon-button","","matSuffix","","color","primary",3,"click",4,"ngIf"],["matSuffix","","color","accent",4,"ngIf"],["formControlName","country"],[3,"value",4,"ngFor","ngForOf"],["formControlName","language"],["formControlName","timezone"],[1,"actions"],["mat-flat-button","","color","primary",1,"neon",3,"click","disabled"],[1,"pwd",3,"formGroup"],["matInput","","formControlName","oldPassword","autocomplete","current-password",3,"type"],["matInput","","formControlName","newPassword","autocomplete","new-password",3,"type"],["matInput","","formControlName","confirm","autocomplete","new-password",3,"type"],["mat-stroked-button","",1,"neon",3,"click"],["mat-icon-button","","matSuffix","","color","primary",3,"click"],["matSuffix","","color","accent"],[3,"value"]],template:function(r,o){r&1&&(t(0,"div",0)(1,"div",1)(2,"div",2),d(3,"span",3),t(4,"h2"),i(5,"Settings"),e()()(),t(6,"div",4)(7,"section",5)(8,"header",6)(9,"mat-icon"),i(10,"account_circle"),e(),t(11,"h3"),i(12,"Profile"),e()(),t(13,"div",7)(14,"div",8),d(15,"img",9),t(16,"label",10)(17,"input",11),u("change",function(h){return o.onPickAvatar(h)}),e(),t(18,"mat-icon"),i(19,"camera_alt"),e()()(),t(20,"form",12)(21,"mat-form-field",13)(22,"mat-label"),i(23,"Full name"),e(),d(24,"input",14),c(25,Pe,2,0,"mat-error",15),e(),t(26,"mat-form-field",13)(27,"mat-label"),i(28,"Email"),e(),d(29,"input",16),c(30,Me,2,0,"mat-error",15),e(),t(31,"mat-form-field",17)(32,"mat-label"),i(33,"Gender"),e(),t(34,"mat-select",18)(35,"mat-option",19),i(36,"Male"),e(),t(37,"mat-option",20),i(38,"Female"),e()()(),t(39,"mat-form-field",17)(40,"mat-label"),i(41,"Date of birth"),e(),d(42,"input",21),e(),t(43,"mat-form-field",22)(44,"mat-label"),i(45,"Phone"),e(),d(46,"input",23),c(47,ye,3,0,"button",24)(48,xe,2,0,"mat-icon",25),e(),t(49,"mat-form-field",17)(50,"mat-label"),i(51,"Country"),e(),t(52,"mat-select",26),c(53,Se,2,2,"mat-option",27),e()(),t(54,"mat-form-field",17)(55,"mat-label"),i(56,"Language"),e(),t(57,"mat-select",28),c(58,Oe,2,2,"mat-option",27),e()(),t(59,"mat-form-field",13)(60,"mat-label"),i(61,"Time zone"),e(),t(62,"mat-select",29),c(63,Ee,2,2,"mat-option",27),e()(),t(64,"div",30)(65,"button",31),u("click",function(){return o.saveProfile()}),t(66,"mat-icon"),i(67,"save"),e(),i(68," Save profile "),e()()()()(),t(69,"section",5)(70,"header",6)(71,"mat-icon"),i(72,"lock_reset"),e(),t(73,"h3"),i(74,"Change password"),e()(),t(75,"form",32)(76,"mat-form-field",13)(77,"mat-label"),i(78,"Current password"),e(),d(79,"input",33),c(80,Fe,2,0,"mat-error",15),e(),t(81,"mat-form-field",17)(82,"mat-label"),i(83,"New password"),e(),d(84,"input",34),c(85,Ne,2,0,"mat-error",15)(86,ke,2,0,"mat-error",15)(87,Ie,2,0,"mat-error",15),e(),t(88,"mat-form-field",17)(89,"mat-label"),i(90,"Confirm new password"),e(),d(91,"input",35),c(92,Te,2,0,"mat-error",15),e(),t(93,"div",30)(94,"button",36),u("click",function(){return o.changePassword()}),t(95,"mat-icon"),i(96,"key"),e(),i(97," Update password "),e()()()()()()),r&2&&(l(15),m("src",o.avatarUrl(),D),l(5),m("formGroup",o.profileForm),l(5),m("ngIf",o.profileForm.controls.fullName.invalid&&o.profileForm.controls.fullName.touched),l(5),m("ngIf",o.profileForm.controls.email.invalid&&o.profileForm.controls.email.touched),l(17),m("ngIf",!o.isPhoneVerified),l(),m("ngIf",o.isPhoneVerified),l(5),m("ngForOf",o.countries),l(5),m("ngForOf",o.languages),l(5),m("ngForOf",o.timezones),l(2),m("disabled",!o.isPhoneVerified||o.profileForm.invalid),l(10),m("formGroup",o.passwordForm),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.controls.oldPassword.invalid&&o.passwordForm.controls.oldPassword.touched),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("required")&&o.passwordForm.controls.newPassword.touched),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("minlength")&&o.passwordForm.controls.newPassword.touched),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("pattern")&&o.passwordForm.controls.newPassword.touched),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.hasError("passwordMismatch")&&o.passwordForm.controls.confirm.touched))},dependencies:[_,L,z,M,G,w,C,q,B,K,Q,J,x,y,H,le,ae,E,O,S,Y,Z,N,F,oe,ne,te,re,X],styles:['.settings-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:900;letter-spacing:.3px}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .glowdot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#71c2ff,#3b8bd3 40%,transparent 65%);box-shadow:0 0 24px #3b8bd3cc}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(1,minmax(0,1fr))}@media (max-width: 1080px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.card.neo[_ngcontent-%COMP%]{position:relative;background:linear-gradient(180deg,#ffffff0a,#ffffff05);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 20px 60px #00000073;padding:.9rem;overflow:hidden}.card.neo[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:-2px;background:conic-gradient(from 0deg,#71c2ffbf,#b78cffbf,#1db7a0bf,#71c2ffbf);filter:blur(18px);opacity:.18;transition:opacity .25s var(--ease);z-index:0}.card.neo[_ngcontent-%COMP%]:hover:before{opacity:.28}.section-head[_ngcontent-%COMP%]{position:relative;z-index:1;display:flex;align-items:center;gap:.6rem;margin-bottom:.55rem}.section-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.section-head[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.1);background:#ffffff0f;border-radius:12px;padding:.35rem}.profile[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:auto 1fr;gap:1rem;align-items:start}.avatar[_ngcontent-%COMP%]{position:relative;width:92px;height:92px;border-radius:50%;overflow:hidden;border:1px solid rgba(255,255,255,.1);box-shadow:0 10px 25px #00000059}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{position:absolute;right:-8px;bottom:-8px;width:38px;height:38px;border-radius:50%;display:grid;place-items:center;background:#ffffff1f;border:1px solid rgba(255,255,255,.18);cursor:pointer}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.field.full[_ngcontent-%COMP%]{grid-column:1/-1}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;margin-top:.5rem}.pwd[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.pwd[_ngcontent-%COMP%]   .field.full[_ngcontent-%COMP%]{grid-column:1/-1}.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:1fr 1fr}@media (max-width: 900px){.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.notis[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{display:grid;gap:.35rem}.notis[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px;opacity:.95}.neon[_ngcontent-%COMP%]{position:relative;border-radius:12px;box-shadow:0 8px 30px #3b8bd340}.neon[_ngcontent-%COMP%]:hover{box-shadow:0 12px 38px #3b8bd359}.mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important;line-height:1!important}.mat-mdc-form-field[_ngcontent-%COMP%]{--mat-form-field-container-vertical-padding: 15px}.verify-field[_ngcontent-%COMP%]{display:flex;align-items:center}.verify-field[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:4px}']})};function Ve(a){let n=a.get("newPassword")?.value,r=a.get("confirm")?.value;return!n||!r||n===r?null:{passwordMismatch:!0}}export{ge as SettingsComponent};
