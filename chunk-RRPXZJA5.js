import{a as W,b as Y,c as G,d as H}from"./chunk-P7GMHTU3.js";import{a as q,b as L,c as j}from"./chunk-H2BNK2GT.js";import"./chunk-F5X5MWHG.js";import{a as B,b as U}from"./chunk-OZY4EI32.js";import{a as z}from"./chunk-APZWTK3L.js";import{a as R,b as V}from"./chunk-FNX66O3M.js";import"./chunk-JXSMCY7E.js";import{n as K}from"./chunk-AK7HCWPM.js";import{a as $}from"./chunk-5Z2H6K7H.js";import"./chunk-ZN66PTI3.js";import"./chunk-HRQB4EEZ.js";import"./chunk-GED64AQA.js";import"./chunk-Z4D3JJEG.js";import{a as F,b as A}from"./chunk-ENKIQ3XX.js";import"./chunk-K2DA6FBL.js";import{T as I,Y as E,Z as T}from"./chunk-LVPX6TEL.js";import"./chunk-P6PSD35X.js";import{d as D}from"./chunk-L73FSOJZ.js";import{$a as f,Ab as M,Cb as g,Eb as d,Ec as h,Fc as N,Gc as w,La as l,Ob as y,Qb as P,Rc as S,Sb as a,Tb as p,Wa as k,a as b,b as C,ea as u,ja as _,ka as x,kc as O,qb as s,rb as i,sb as n,ta as v}from"./chunk-WZIMFKHB.js";function Q(r,e){if(r&1&&(i(0,"span",19),a(1),n()),r&2){let t=d();l(),p(t.counts().all)}}function X(r,e){if(r&1&&(i(0,"span",19),a(1),n()),r&2){let t=d();l(),p(t.counts().appointment)}}function Z(r,e){if(r&1&&(i(0,"span",19),a(1),n()),r&2){let t=d();l(),p(t.counts().mention)}}function tt(r,e){if(r&1&&(i(0,"span",19),a(1),n()),r&2){let t=d();l(),p(t.counts().review)}}function et(r,e){if(r&1&&(i(0,"span",19),a(1),n()),r&2){let t=d();l(),p(t.counts().system)}}function nt(r,e){if(r&1&&(i(0,"span",37),a(1),n()),r&2){let t=d().$implicit;l(),p(t.pill)}}function it(r,e){if(r&1&&(i(0,"div",38),a(1),n()),r&2){let t=d().$implicit;l(),p(t.message)}}function ot(r,e){if(r&1){let t=M();i(0,"button",39),g("click",function(){_(t);let c=d().$implicit,m=d(2);return x(m.open(c))}),a(1),n()}if(r&2){let t=d().$implicit;l(),p(t.cta.label)}}function at(r,e){if(r&1){let t=M();i(0,"div",23)(1,"div",24)(2,"mat-icon"),a(3),n()(),i(4,"div",25),g("click",function(){let c=_(t).$implicit,m=d(2);return x(m.open(c))}),i(5,"div",26)(6,"div",3),a(7),n(),f(8,nt,2,1,"span",27),n(),f(9,it,2,1,"div",28),i(10,"div",29)(11,"span",30),a(12),n(),i(13,"span",31),a(14,"\u2022"),n(),i(15,"span",32),a(16),n()()(),i(17,"div",33),f(18,ot,2,1,"button",34),i(19,"button",35)(20,"mat-icon"),a(21,"more_horiz"),n()(),i(22,"mat-menu",null,0)(24,"button",36),g("click",function(){let c=_(t).$implicit,m=d(2);return x(m.toggleRead(c))}),i(25,"mat-icon"),a(26),n(),i(27,"span"),a(28),n()(),i(29,"button",36),g("click",function(){let c=_(t).$implicit,m=d(2);return x(m.delete(c))}),i(30,"mat-icon"),a(31,"delete"),n(),i(32,"span"),a(33,"Delete"),n()()()()()}if(r&2){let t=e.$implicit,o=y(23),c=d(2);P("read",t.read),l(),s("ngClass",t.kind),l(2),p(c.icon(t.kind)),l(4),p(t.title),l(),s("ngIf",t.pill),l(),s("ngIf",t.message),l(3),p(t.kind),l(4),p(c.time(t.time)),l(2),s("ngIf",t.cta),l(),s("matMenuTriggerFor",o),l(7),p(t.read?"mark_email_unread":"mark_email_read"),l(2),p(t.read?"Mark unread":"Mark read")}}function rt(r,e){if(r&1&&(i(0,"div",20)(1,"div",21),f(2,at,34,13,"div",22),n()()),r&2){let t=d();l(2),s("ngForOf",t.filtered())}}function lt(r,e){r&1&&(i(0,"div",40)(1,"mat-icon"),a(2,"inbox"),n(),i(3,"div"),a(4,"No notifications"),n()())}var J=class r{snack=u(R);service=u(z);socketService=u($);router=u(D);all=v([]);query=v("");filter=v("all");filtered=O(()=>{let e=this.query().trim().toLowerCase(),t=this.filter();return this.all().filter(c=>t==="all"?!0:c.kind===t).filter(c=>!e||c.title.toLowerCase().includes(e)||c.message.toLowerCase().includes(e)).sort((c,m)=>+new Date(m.time)-+new Date(c.time))});ngOnInit(){this.loadNotifications(),this.listenForNotifications()}ngOnDestroy(){}loadNotifications(){this.service.getNotifications().subscribe({next:e=>{this.all.set(e.map(t=>({id:t.id,kind:t.type?.toUpperCase()??"UNKNOWN",title:t.title,message:t.message,time:t.createdAt,read:t.read})))},error:e=>{console.error("\u274C Failed to load notifications:",e),this.snack.open("Failed to load notifications","OK",{duration:1500})}})}listenForNotifications(){this.socketService.on("notification:new",e=>{let t={id:e.id,kind:e.type?.toUpperCase()??"UNKNOWN",title:e.title,message:e.message,time:e.createdAt||new Date().toISOString(),read:!1};this.all.update(o=>[t,...o]),this.snack.open("New notification","View",{duration:2500}).onAction().subscribe(()=>this.open(t))})}markRead(e){this.service.markNotificationRead(e.id).subscribe({next:()=>{this.service.decrementUnreadCount(),this.all.update(t=>t.map(o=>o.id===e.id?C(b({},o),{read:!0}):o)),this.snack.open("Marked as read","OK",{duration:1200})},error:t=>{console.error("\u274C Failed to mark read:",t),this.snack.open("Failed to mark read","OK",{duration:1500})}})}toggleRead(e){this.all.update(t=>t.map(o=>o.id===e.id?C(b({},o),{read:!o.read}):o))}clear(e){confirm("Clear notifications?")&&(!e||e==="all"?this.all.set([]):this.all.update(t=>t.filter(o=>o.kind!==e)),this.snack.open("Notifications cleared","OK",{duration:1200}))}time(e){return new Date(e).toLocaleString()}badgeClass(e){return{appointment:e==="appointment",review:e==="review",mention:e==="mention",system:e==="system"}}counts=O(()=>{let e={all:0,appointment:0,mention:0,review:0,system:0};for(let t of this.all())t.read||(e.all++,e[t.kind]++);return e});icon(e){switch(e){case"appointment":return"event_available";case"mention":return"chat";case"review":return"receipt_long";case"system":return"notifications"}}markAllRead(){this.service.markallNotificationRead().subscribe({next:()=>{this.all.update(e=>e.map(t=>t.read?t:C(b({},t),{read:!0}))),this.service.updateUnreadCount(0)}})}clearOlderThan(e=30){let t=Date.now()-e*864e5;this.snack.open(`Cleared items older than ${e}d`,"OK",{duration:1200})}open(e){this.markRead(e),e.cta?.route?this.router.navigate(e.cta.route):e.cta?.external&&window.open(e.cta.external,"_blank")}delete(e){let t=!1;e.read===!1&&(t=!0),this.service.deleteNotification(e.id).subscribe({next:()=>{this.all.update(o=>o.filter(c=>c.id!==e.id)),t&&this.service.decrementUnreadCount(),this.snack.open("Notification deleted","OK",{duration:1200})},error:o=>{console.error("\u274C Failed to delete notification:",o),this.snack.open("Failed to delete notification","OK",{duration:1500})}})}clearAll(){confirm("Are you sure you want to delete all notifications?")&&this.service.clearAllNotifications().subscribe({next:()=>{this.all.set([]),this.snack.open("All notifications deleted","OK",{duration:1200})},error:e=>{console.error("\u274C Failed to clear all notifications:",e),this.snack.open("Failed to clear all notifications","OK",{duration:1500})}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=k({type:r,selectors:[["app-doctor-notifications"]],decls:47,vars:9,consts:[["menu","matMenu"],[1,"notif-wrap"],[1,"toolbar"],[1,"title"],[1,"tools"],[1,"search"],["type","text","placeholder","Search notifications\u2026",3,"input","value"],["mat-stroked-button","","matTooltip","Mark all as read",3,"click"],["mat-stroked-button","","color","warn","matTooltip","Delete all notifications",3,"click"],[1,"filters","card"],[1,"filters",3,"change","value"],["value","all"],["class","badge",4,"ngIf"],["value","appointment"],["value","mention"],["value","review"],["value","system"],["class","group",4,"ngIf"],["class","empty",4,"ngIf"],[1,"badge"],[1,"group"],[1,"list"],["class","item",3,"read",4,"ngFor","ngForOf"],[1,"item"],[1,"icon",3,"ngClass"],[1,"content",3,"click"],[1,"row1"],["class","pill",4,"ngIf"],["class","row2",4,"ngIf"],[1,"meta"],[1,"kind"],[1,"dot"],[1,"ts"],[1,"actions"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","More",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"pill"],[1,"row2"],["mat-stroked-button","",3,"click"],[1,"empty"]],template:function(t,o){t&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"mat-icon"),a(4,"notifications"),n(),i(5,"h2"),a(6,"Notificationss"),n()(),i(7,"div",4)(8,"div",5)(9,"input",6),g("input",function(m){return o.query.set(m.target.value)}),n()(),i(10,"button",7),g("click",function(){return o.markAllRead()}),i(11,"mat-icon"),a(12,"done_all"),n(),a(13," Mark all read "),n(),i(14,"button",8),g("click",function(){return o.clearAll()}),i(15,"mat-icon"),a(16,"delete_sweep"),n(),a(17," Clear All "),n()()(),i(18,"div",9)(19,"mat-button-toggle-group",10),g("change",function(m){return o.filter.set(m.value)}),i(20,"mat-button-toggle",11)(21,"mat-icon"),a(22,"all_inclusive"),n(),a(23," All "),f(24,Q,2,1,"span",12),n(),i(25,"mat-button-toggle",13)(26,"mat-icon"),a(27,"event_available"),n(),a(28," Appointments "),f(29,X,2,1,"span",12),n(),i(30,"mat-button-toggle",14)(31,"mat-icon"),a(32,"chat"),n(),a(33," Mentions "),f(34,Z,2,1,"span",12),n(),i(35,"mat-button-toggle",15)(36,"mat-icon"),a(37,"folder_shared"),n(),a(38," Reviews "),f(39,tt,2,1,"span",12),n(),i(40,"mat-button-toggle",16)(41,"mat-icon"),a(42,"notifications"),n(),a(43," System "),f(44,et,2,1,"span",12),n()()(),f(45,rt,3,1,"div",17)(46,lt,5,0,"div",18),n()),t&2&&(l(9),s("value",o.query()),l(10),s("value",o.filter()),l(5),s("ngIf",o.counts().all),l(5),s("ngIf",o.counts().appointment),l(5),s("ngIf",o.counts().mention),l(5),s("ngIf",o.counts().review),l(5),s("ngIf",o.counts().system),l(),s("ngIf",o.filtered().length),l(),s("ngIf",!o.filtered().length))},dependencies:[S,h,N,w,A,F,T,E,I,H,Y,W,G,U,B,V,j,q,L,K],styles:[".wrap[_ngcontent-%COMP%]{padding:14px 12px}.bar[_ngcontent-%COMP%]{display:grid;gap:12px;align-items:center;margin-bottom:10px;grid-template-columns:auto 1fr}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:flex-end;flex-wrap:wrap}.search[_ngcontent-%COMP%]{width:min(340px,45vw)}.list.card[_ngcontent-%COMP%]{padding:8px;display:grid;gap:8px}.item[_ngcontent-%COMP%]{display:grid;grid-template-columns:44px 1fr auto;gap:.75rem;padding:.7rem .75rem;border:1px solid rgba(255,255,255,.08);border-radius:14px;background:#ffffff05;transition:transform .14s var(--ease),background .14s var(--ease),border-color .14s var(--ease)}.item[_ngcontent-%COMP%]:hover{transform:translateY(-1px);background:#ffffff0a;border-color:#ffffff1f}.item.unread[_ngcontent-%COMP%]{box-shadow:0 0 0 2px #5591ff40 inset}.left[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:flex-start}.meta[_ngcontent-%COMP%]{display:grid;gap:4px}.t[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;flex-wrap:wrap}.title[_ngcontent-%COMP%]{font-weight:800}.time[_ngcontent-%COMP%]{opacity:.8;font-size:12px}.b.muted[_ngcontent-%COMP%]{opacity:.6}.pill[_ngcontent-%COMP%]{padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--border);text-transform:capitalize}.pill.appointment[_ngcontent-%COMP%]{background:#1db7a029}.pill.mention[_ngcontent-%COMP%]{background:#3b8bd329}.pill.review[_ngcontent-%COMP%]{background:#eab30829}.pill.system[_ngcontent-%COMP%]{background:#94a3b829}.right[_ngcontent-%COMP%]{display:flex;gap:6px}.empty[_ngcontent-%COMP%]{text-align:center;opacity:.8;padding:20px 0;display:grid;gap:6px}.filters[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;border-radius:16px;margin-bottom:.9rem}.filters[_ngcontent-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{border:none;background:transparent}.filters[_ngcontent-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{border-radius:999px!important;margin-right:.35rem;border:1px solid rgba(255,255,255,.08)!important;background:#ffffff05}.filters[_ngcontent-%COMP%]   .mat-button-toggle-checked[_ngcontent-%COMP%]{background:#ffffff0f!important}.filters[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{margin-left:.35rem;font-size:.75rem;padding:.05rem .4rem;border-radius:999px;background:#ffffff1f}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem;margin-bottom:.75rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.toolbar[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{position:relative}.toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:min(540px,75vw);padding:.55rem 2.2rem .55rem .9rem;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#ffffff05;color:var(--text);outline:none}.toolbar[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);opacity:.7}.notif-wrap[_ngcontent-%COMP%]{padding:1rem}.group[_ngcontent-%COMP%]{margin-top:.5rem}.group[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]{font-weight:800;letter-spacing:.2px;opacity:.9;margin:.5rem 0 .35rem}.list[_ngcontent-%COMP%]{display:grid;gap:.5rem}.icon[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;background:#ffffff0f;border:1px solid rgba(255,255,255,.08)}.icon.appointment[_ngcontent-%COMP%]{color:#7ea6ff}.icon.message[_ngcontent-%COMP%]{color:#65e0b9}.icon.payment[_ngcontent-%COMP%]{color:#ffd17a}.icon.record[_ngcontent-%COMP%]{color:#bba4ff}.icon.system[_ngcontent-%COMP%]{color:#a7b4c5}.content[_ngcontent-%COMP%]{cursor:pointer;display:grid;gap:.25rem}.content[_ngcontent-%COMP%]   .row1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px}.content[_ngcontent-%COMP%]   .row2[_ngcontent-%COMP%]{opacity:.9}.content[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{opacity:.75;display:flex;align-items:center;gap:.4rem}.content[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{opacity:.5}.pill[_ngcontent-%COMP%]{font-size:.75rem;padding:.1rem .5rem;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#ffffff0d}.kind[_ngcontent-%COMP%]{font-size:.75rem;text-transform:capitalize;padding:.05rem .45rem;border-radius:999px;border:1px solid rgba(255,255,255,.1)}.kind.appointment[_ngcontent-%COMP%]{background:#5591ff1a;border-color:#5591ff4d}.kind.message[_ngcontent-%COMP%]{background:#42d3921a;border-color:#42d3924d}.kind.payment[_ngcontent-%COMP%]{background:#f59e0b1f;border-color:#f59e0b4d}.kind.record[_ngcontent-%COMP%]{background:#b7a4ff1f;border-color:#b7a4ff4d}.kind.system[_ngcontent-%COMP%]{background:#a7b4c51f;border-color:#a7b4c54d}.actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.empty[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.25rem;padding:2rem 1rem;text-align:center;border-radius:16px;opacity:.9}.empty[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;width:40px;height:40px;opacity:.8}"]})};export{J as DoctorNotificationsComponent};
