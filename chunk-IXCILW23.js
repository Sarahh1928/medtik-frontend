import{a}from"./chunk-6ZCLRSJ3.js";import{a as i,b as r}from"./chunk-WSZ2ZTRK.js";import{aa as c,fa as s,l as n}from"./chunk-PCHMKQLW.js";var l=class e{socket=null;authService=s(r);notifSub;notificationsSubject=new n([]);notifications$=this.notificationsSubject.asObservable();constructor(){let o=localStorage.getItem("admin_notifications");if(o)try{this.notificationsSubject.next(JSON.parse(o))}catch{localStorage.removeItem("admin_notifications")}this.notifSub=this.notifications$.subscribe(t=>localStorage.setItem("admin_notifications",JSON.stringify(t)))}connect(){if(this.socket)return this.socket;let o={transports:["websocket"],reconnection:!0,auth:{},withCredentials:!1};if(i.production)o.withCredentials=!0,o.auth={role:"ADMIN"};else{let t=this.authService.getToken();if(!t)return console.warn("No admin token found. Socket not connected."),null;o.auth={token:t,role:"ADMIN"}}return this.socket=a(i.socketUrl,o),this.socket.on("connect",()=>{console.log(`\u2705 Admin socket connected: ${this.socket?.id}`)}),this.socket.on("disconnect",t=>{console.warn(`\u26A1 Admin socket disconnected: ${t}`)}),this.socket.on("connect_error",t=>{console.error("\u274C Socket connection error:",t.message)}),this.socket}getSocket(){return this.socket}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}ngOnDestroy(){this.disconnect(),this.notifSub.unsubscribe()}static \u0275fac=function(t){return new(t||e)};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})};export{l as a};
