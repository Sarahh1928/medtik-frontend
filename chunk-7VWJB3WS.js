import{a as le,c as me,d as se,e as pe,f as de,g as ce,h as fe}from"./chunk-EAVN2IX3.js";import{b as ie}from"./chunk-XVEID4SE.js";import"./chunk-F5X5MWHG.js";import{a as re,b as ae}from"./chunk-OZY4EI32.js";import{a as W,b as X}from"./chunk-FNX66O3M.js";import"./chunk-MS4AQ6UA.js";import{a as ee,b as te,d as ne}from"./chunk-GNF7NEE4.js";import"./chunk-FTUWSJZM.js";import"./chunk-JXSMCY7E.js";import"./chunk-3RK6DDJD.js";import{a as E,b as Z,h as F,i as N,m as k,n as T}from"./chunk-AK7HCWPM.js";import{a as oe}from"./chunk-QG6HNMYG.js";import"./chunk-SCUZIYM3.js";import"./chunk-HRQB4EEZ.js";import"./chunk-GED64AQA.js";import"./chunk-Z4D3JJEG.js";import{a as J,b as Q}from"./chunk-ENKIQ3XX.js";import{A as x,b as P,d as p,f as M,g as j,h as y,j as s,l as B,n as K,o as $,r as Y,x as H}from"./chunk-K2DA6FBL.js";import{Y as S,Z as O}from"./chunk-LVPX6TEL.js";import{b as G}from"./chunk-43CXEHYE.js";import{$a as c,Ab as R,Cb as g,Fc as L,Gc as q,Ia as A,La as l,Ob as z,Pa as U,Rc as C,Sb as i,Tb as _,Wa as w,ea as h,ja as b,ka as v,qb as m,rb as t,sb as e,ta as D,tb as d}from"./chunk-WZIMFKHB.js";var V=class a{otp=new s("",[p.required,p.pattern(/^\d{6}$/)]);dialogRef=h(le);verify(){this.otp.valid&&this.dialogRef.close(this.otp.value)}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=w({type:a,selectors:[["app-verify-otp-dialog"]],decls:14,vars:2,consts:[["mat-dialog-title",""],["appearance","outline",1,"full"],["matInput","","type","text","maxlength","6",3,"formControl"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(r,o){r&1&&(t(0,"h2",0),i(1,"Verify Phone Number"),e(),t(2,"mat-dialog-content")(3,"p"),i(4,"Enter the 6-digit OTP sent to your phone."),e(),t(5,"mat-form-field",1)(6,"mat-label"),i(7,"OTP"),e(),d(8,"input",2),e()(),t(9,"mat-dialog-actions",3)(10,"button",4),i(11,"Cancel"),e(),t(12,"button",5),g("click",function(){return o.verify()}),i(13,"Verify"),e()()),r&2&&(l(8),m("formControl",o.otp),l(4),m("disabled",o.otp.invalid))},dependencies:[C,x,P,M,H,K,N,F,E,T,k,O,S,fe,se,pe,ce,de],encapsulation:2})};function Pe(a,n){a&1&&(t(0,"mat-error"),i(1," Name is required (min 3 chars). "),e())}function Me(a,n){a&1&&(t(0,"mat-error"),i(1," Enter a valid email. "),e())}function ye(a,n){if(a&1&&(t(0,"mat-option",36),i(1),e()),a&2){let r=n.$implicit;m("value",r.code),l(),_(r.name)}}function xe(a,n){if(a&1&&(t(0,"mat-option",36),i(1),e()),a&2){let r=n.$implicit;m("value",r.code),l(),_(r.name)}}function Se(a,n){if(a&1&&(t(0,"mat-option",36),i(1),e()),a&2){let r=n.$implicit;m("value",r),l(),_(r)}}function Oe(a,n){a&1&&(t(0,"mat-error"),i(1," Required. "),e())}function Ee(a,n){a&1&&(t(0,"mat-error"),i(1," Required. "),e())}function Fe(a,n){a&1&&(t(0,"mat-error"),i(1," Min 8 characters. "),e())}function Ne(a,n){a&1&&(t(0,"mat-error"),i(1," Use letters and numbers. "),e())}function ke(a,n){a&1&&(t(0,"mat-error"),i(1," Passwords don\u2019t match. "),e())}var ue=class a{constructor(n){this.patientService=n}snack=h(W);auth=h(G);dialog=h(me);avatarUrl=D("https://i.pravatar.cc/120?img=13");originalPhone="";countries=[{code:"EG",name:"Egypt"},{code:"SA",name:"Saudi Arabia"},{code:"AE",name:"United Arab Emirates"},{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"}];languages=[{code:"en",name:"English"},{code:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"}];timezones=["Africa/Cairo","Asia/Riyadh","Asia/Dubai","Europe/London","America/New_York"];isPhoneVerified=!1;otpDialogOpen=!1;profileForm=new y({fullName:new s("",{nonNullable:!0,validators:[p.required,p.minLength(3)]}),email:new s("",{nonNullable:!0,validators:[p.required,p.email]}),dob:new s(""),phone:new s(""),country:new s("EG",{nonNullable:!0}),gender:new s("female",{nonNullable:!0}),language:new s("en",{nonNullable:!0}),timezone:new s("Africa/Cairo",{nonNullable:!0})});ngOnInit(){this.loadProfile()}loadProfile(){this.patientService.getProfile().subscribe({next:n=>{let r=n?.user?.patient||{};this.originalPhone=r.phone||"",this.profileForm.get("phone")?.valueChanges.subscribe(o=>{this.isPhoneVerified=o===this.originalPhone}),this.avatarUrl.set(r.avatar||""),this.profileForm.patchValue({fullName:n?.user?.fullName||"",email:n?.user?.email||"",dob:r.birthdate?r.birthdate.split("T")[0]:"",phone:r.phone||"",country:r.country||"EG",gender:r.gender||"female",language:"en",timezone:"Africa/Cairo"}),console.log("Loaded profile:",n),n?.avatarUrl&&this.avatarUrl.set(n.avatarUrl)},error:n=>{console.error("Profile load failed:",n),this.snack.open("Failed to load profile","Close",{duration:2500})}})}onPickAvatar(n){let o=n.target?.files?.[0];if(o){try{URL.revokeObjectURL(this.avatarUrl())}catch{}this.avatarUrl.set(URL.createObjectURL(o)),this.snack.open("Photo updated (local preview)","OK",{duration:1500})}}saveProfile(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched();return}let n={fullName:this.profileForm.value.fullName,email:this.profileForm.value.email,phone:this.profileForm.value.phone,country:this.profileForm.value.country,birthdate:this.profileForm.value.dob,gender:this.profileForm.value.gender,avatarUrl:this.avatarUrl()};console.log("Saving profile with payload:",n),this.patientService.updateProfile(n).subscribe({next:r=>{this.snack.open("Profile updated successfully!","OK",{duration:2e3})},error:r=>{console.error("Profile update failed:",r),this.snack.open("Failed to update profile","Close",{duration:2500})}})}passwordForm=new y({oldPassword:new s("",{nonNullable:!0,validators:[p.required]}),newPassword:new s("",{nonNullable:!0,validators:[p.required,p.minLength(8),p.pattern(/^(?=.*[A-Za-z])(?=.*\d).{8,}$/)]}),confirm:new s("",{nonNullable:!0,validators:[p.required]})},{validators:[Te]});changePassword(){if(this.passwordForm.invalid){this.passwordForm.markAllAsTouched();return}let{oldPassword:n,newPassword:r,confirm:o}=this.passwordForm.getRawValue(),f={currentPassword:n,newPassword:r,verifyPassword:o};this.auth.changePassword(f).subscribe({next:u=>{this.snack.open(u.message,"OK",{duration:2e3}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""})},error:u=>{this.snack.open(u,"Close",{duration:2500})}}),this.passwordForm.reset({oldPassword:"",newPassword:"",confirm:""}),this.snack.open("Password changed","OK",{duration:1400})}notiForm=new y({push:new s(!0,{nonNullable:!0}),email:new s(!0,{nonNullable:!0}),appt:new s(!0,{nonNullable:!0}),chat:new s(!0,{nonNullable:!0}),marketing:new s(!1,{nonNullable:!0})});saveNotifications(){this.snack.open("Notification preferences saved","OK",{duration:1200})}openVerifyDialog(){let n=this.profileForm.value.phone;if(!n){this.snack.open("Enter a phone number first","Close",{duration:2e3});return}this.patientService.sendOtp(n).subscribe({next:()=>{this.dialog.open(V).afterClosed().subscribe(o=>{o&&this.verifyOtp(o)})},error:()=>{this.snack.open("Failed to send OTP. Try again.","Close",{duration:2e3})}})}verifyOtp(n){this.patientService.verifyOtp(n).subscribe({next:()=>{this.isPhoneVerified=!0,this.originalPhone=this.profileForm.value.phone||"",this.snack.open("Phone verified successfully","OK",{duration:2e3})},error:()=>{this.snack.open("Invalid OTP. Please try again.","Close",{duration:2e3})}})}showTooltip(n,r){r.stopPropagation(),n.disabled=!1,n.show(),setTimeout(()=>{n.hide(),n.disabled=!0},5e3)}static \u0275fac=function(r){return new(r||a)(U(oe))};static \u0275cmp=w({type:a,selectors:[["app-settings"]],decls:97,vars:17,consts:[["tooltip","matTooltip"],[1,"settings-wrap"],[1,"toolbar"],[1,"title"],[1,"glowdot"],[1,"grid"],[1,"card","neo"],[1,"section-head"],[1,"profile"],[1,"avatar"],["alt","",3,"src"],["matTooltip","Change photo",1,"change"],["type","file","accept","image/*",3,"change"],[1,"form",3,"formGroup"],["appearance","outline",1,"field","full"],["matInput","","formControlName","fullName"],[4,"ngIf"],["matInput","","formControlName","email","type","email"],["appearance","outline",1,"field"],["formControlName","gender"],["value","male"],["value","female"],["matInput","","type","date","formControlName","dob"],["appearance","outline",1,"field","verify-field"],["matInput","","formControlName","phone","readonly","","tabindex","-1","matTooltip","You can't change your phone number","matTooltipPosition","below",1,"readonly-input",3,"click"],["formControlName","country"],[3,"value",4,"ngFor","ngForOf"],["formControlName","language"],["formControlName","timezone"],[1,"actions"],["mat-flat-button","","color","primary",1,"neon",3,"click","disabled"],[1,"pwd",3,"formGroup"],["matInput","","formControlName","oldPassword","autocomplete","current-password",3,"type"],["matInput","","formControlName","newPassword","autocomplete","new-password",3,"type"],["matInput","","formControlName","confirm","autocomplete","new-password",3,"type"],["mat-stroked-button","",1,"neon",3,"click"],[3,"value"]],template:function(r,o){if(r&1){let f=R();t(0,"div",1)(1,"div",2)(2,"div",3),d(3,"span",4),t(4,"h2"),i(5,"Settings"),e()()(),t(6,"div",5)(7,"section",6)(8,"header",7)(9,"mat-icon"),i(10,"account_circle"),e(),t(11,"h3"),i(12,"Profile"),e()(),t(13,"div",8)(14,"div",9),d(15,"img",10),t(16,"label",11)(17,"input",12),g("change",function(I){return b(f),v(o.onPickAvatar(I))}),e(),t(18,"mat-icon"),i(19,"camera_alt"),e()()(),t(20,"form",13)(21,"mat-form-field",14)(22,"mat-label"),i(23,"Full name"),e(),d(24,"input",15),c(25,Pe,2,0,"mat-error",16),e(),t(26,"mat-form-field",14)(27,"mat-label"),i(28,"Email"),e(),d(29,"input",17),c(30,Me,2,0,"mat-error",16),e(),t(31,"mat-form-field",18)(32,"mat-label"),i(33,"Gender"),e(),t(34,"mat-select",19)(35,"mat-option",20),i(36,"Male"),e(),t(37,"mat-option",21),i(38,"Female"),e()()(),t(39,"mat-form-field",18)(40,"mat-label"),i(41,"Date of birth"),e(),d(42,"input",22),e(),t(43,"mat-form-field",23)(44,"mat-label"),i(45,"Phone"),e(),t(46,"input",24,0),g("click",function(I){b(f);let ge=z(47);return v(o.showTooltip(ge,I))}),e()(),t(48,"mat-form-field",18)(49,"mat-label"),i(50,"Country"),e(),t(51,"mat-select",25),c(52,ye,2,2,"mat-option",26),e()(),t(53,"mat-form-field",18)(54,"mat-label"),i(55,"Language"),e(),t(56,"mat-select",27),c(57,xe,2,2,"mat-option",26),e()(),t(58,"mat-form-field",14)(59,"mat-label"),i(60,"Time zone"),e(),t(61,"mat-select",28),c(62,Se,2,2,"mat-option",26),e()(),t(63,"div",29)(64,"button",30),g("click",function(){return b(f),v(o.saveProfile())}),t(65,"mat-icon"),i(66,"save"),e(),i(67," Save profile "),e()()()()(),t(68,"section",6)(69,"header",7)(70,"mat-icon"),i(71,"lock_reset"),e(),t(72,"h3"),i(73,"Change password"),e()(),t(74,"form",31)(75,"mat-form-field",14)(76,"mat-label"),i(77,"Current password"),e(),d(78,"input",32),c(79,Oe,2,0,"mat-error",16),e(),t(80,"mat-form-field",18)(81,"mat-label"),i(82,"New password"),e(),d(83,"input",33),c(84,Ee,2,0,"mat-error",16)(85,Fe,2,0,"mat-error",16)(86,Ne,2,0,"mat-error",16),e(),t(87,"mat-form-field",18)(88,"mat-label"),i(89,"Confirm new password"),e(),d(90,"input",34),c(91,ke,2,0,"mat-error",16),e(),t(92,"div",29)(93,"button",35),g("click",function(){return b(f),v(o.changePassword())}),t(94,"mat-icon"),i(95,"key"),e(),i(96," Update password "),e()()()()()()}r&2&&(l(15),m("src",o.avatarUrl(),A),l(5),m("formGroup",o.profileForm),l(5),m("ngIf",o.profileForm.controls.fullName.invalid&&o.profileForm.controls.fullName.touched),l(5),m("ngIf",o.profileForm.controls.email.invalid&&o.profileForm.controls.email.touched),l(22),m("ngForOf",o.countries),l(5),m("ngForOf",o.languages),l(5),m("ngForOf",o.timezones),l(2),m("disabled",!o.isPhoneVerified||o.profileForm.invalid),l(10),m("formGroup",o.passwordForm),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.controls.oldPassword.invalid&&o.passwordForm.controls.oldPassword.touched),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("required")&&o.passwordForm.controls.newPassword.touched),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("minlength")&&o.passwordForm.controls.newPassword.touched),l(),m("ngIf",o.passwordForm.controls.newPassword.hasError("pattern")&&o.passwordForm.controls.newPassword.touched),l(4),m("type","password"),l(),m("ngIf",o.passwordForm.hasError("passwordMismatch")&&o.passwordForm.controls.confirm.touched))},dependencies:[C,L,q,x,B,P,M,j,$,Y,Q,J,O,S,ae,re,N,F,E,Z,T,k,ne,te,ee,ie,X],styles:['.settings-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:900;letter-spacing:.3px}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .glowdot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#71c2ff,#3b8bd3 40%,transparent 65%);box-shadow:0 0 24px #3b8bd3cc}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(1,minmax(0,1fr))}@media (max-width: 1080px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.card.neo[_ngcontent-%COMP%]{position:relative;background:linear-gradient(180deg,#ffffff0a,#ffffff05);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 20px 60px #00000073;padding:.9rem;overflow:hidden}.card.neo[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:-2px;background:conic-gradient(from 0deg,#71c2ffbf,#b78cffbf,#1db7a0bf,#71c2ffbf);filter:blur(18px);opacity:.18;transition:opacity .25s var(--ease);z-index:0}.card.neo[_ngcontent-%COMP%]:hover:before{opacity:.28}.section-head[_ngcontent-%COMP%]{position:relative;z-index:1;display:flex;align-items:center;gap:.6rem;margin-bottom:.55rem}.section-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.section-head[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.1);background:#ffffff0f;border-radius:12px;padding:.35rem}.profile[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:auto 1fr;gap:1rem;align-items:start}.avatar[_ngcontent-%COMP%]{position:relative;width:92px;height:92px;border-radius:50%;overflow:hidden;border:1px solid rgba(255,255,255,.1);box-shadow:0 10px 25px #00000059}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{position:absolute;right:-8px;bottom:-8px;width:38px;height:38px;border-radius:50%;display:grid;place-items:center;background:#ffffff1f;border:1px solid rgba(255,255,255,.18);cursor:pointer}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.avatar[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.field.full[_ngcontent-%COMP%]{grid-column:1/-1}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;margin-top:.5rem}.pwd[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:1fr 1fr}.pwd[_ngcontent-%COMP%]   .field.full[_ngcontent-%COMP%]{grid-column:1/-1}.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:1fr 1fr}@media (max-width: 900px){.notis[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.notis[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{display:grid;gap:.35rem}.notis[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px;opacity:.95}.neon[_ngcontent-%COMP%]{position:relative;border-radius:12px;box-shadow:0 8px 30px #3b8bd340}.neon[_ngcontent-%COMP%]:hover{box-shadow:0 12px 38px #3b8bd359}.mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important;line-height:1!important}.mat-mdc-form-field[_ngcontent-%COMP%]{--mat-form-field-container-vertical-padding: 15px}.verify-field[_ngcontent-%COMP%]{display:flex;align-items:center}.verify-field[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:4px}.readonly-input[_ngcontent-%COMP%]{pointer-events:auto;color:#837a7acc;cursor:not-allowed}  .mat-mdc-tooltip{margin-top:-6px!important}']})};function Te(a){let n=a.get("newPassword")?.value,r=a.get("confirm")?.value;return!n||!r||n===r?null:{passwordMismatch:!0}}export{ue as SettingsComponent};
