import"./chunk-3RK6DDJD.js";import{a as Q,h as X,i as Y,m as et,n as nt}from"./chunk-AK7HCWPM.js";import{a as it}from"./chunk-OC6UHY2H.js";import{a as Z,b as tt}from"./chunk-ENKIQ3XX.js";import{b as q,f as B,k as W,m as z,v as U,w as $,z as G}from"./chunk-K2DA6FBL.js";import{T as H,Y as J,Z as K}from"./chunk-LVPX6TEL.js";import"./chunk-P6PSD35X.js";import{h as A}from"./chunk-L73FSOJZ.js";import{$a as g,Ab as P,Cb as M,E as R,Eb as m,Fc as k,Gc as V,Ia as S,La as r,Pb as D,Qb as O,Qc as L,Rc as j,Sb as c,Tb as u,Ub as x,Vb as N,Wa as I,Xb as b,Yb as w,Zb as y,dc as F,ea as E,fc as T,ja as p,ka as _,kc as f,p as h,qb as l,rb as n,sb as i,ta as C,tb as v}from"./chunk-WZIMFKHB.js";function at(a,e){if(a&1&&(n(0,"mat-icon"),c(1,"star"),i()),a&2){let t=e.$implicit,o=m(2);O("active",t<=o.roundedAvg())}}function rt(a,e){if(a&1&&(n(0,"div",16)(1,"span",17),c(2),i(),n(3,"div",18),v(4,"span"),i(),n(5,"span",19),c(6),i()()),a&2){let t=e.$implicit,o=m(2);r(2),x("",t,"\u2605"),r(2),D("width",o.distPercent(t),"%"),r(2),x("",o.distPercent(t),"%")}}function ct(a,e){if(a&1&&(n(0,"section",8)(1,"div",9)(2,"div",10),c(3),F(4,"number"),i(),n(5,"div",11),g(6,at,2,2,"mat-icon",12),i(),n(7,"div",13),c(8),i()(),n(9,"div",14),g(10,rt,7,4,"div",15),i()()),a&2){let t=e.ngIf,o=m();r(3),u(T(4,5,o.avg(),"1.1-1")),r(3),l("ngForOf",o.stars),r(2),N("",t," review",t>1?"s":""),r(2),l("ngForOf",o.stars.slice().reverse())}}function dt(a,e){a&1&&(n(0,"div",20)(1,"mat-icon"),c(2,"inbox"),i(),n(3,"div"),c(4,"No reviews found"),i()())}function mt(a,e){if(a&1&&(n(0,"mat-icon"),c(1,"star"),i()),a&2){let t=e.$implicit,o=m().$implicit;O("active",t<=o.rating)}}function lt(a,e){if(a&1&&(n(0,"div",2),c(1),i()),a&2){let t=m().$implicit;r(),u(t.title)}}function st(a,e){if(a&1){let t=P();n(0,"div",38)(1,"mat-form-field",39)(2,"mat-label"),c(3,"Rating (1\u20135)"),i(),n(4,"input",40),y("ngModelChange",function(d){p(t);let s=m(3);return w(s.editRating,d)||(s.editRating=d),_(d)}),i()(),n(5,"mat-form-field",39)(6,"mat-label"),c(7,"Comment"),i(),n(8,"textarea",41),y("ngModelChange",function(d){p(t);let s=m(3);return w(s.editComment,d)||(s.editComment=d),_(d)}),i()(),n(9,"div",42)(10,"button",43),M("click",function(){p(t);let d=m(3);return _(d.cancelEdit())}),c(11,"Cancel"),i(),n(12,"button",44),M("click",function(){p(t);let d=m().$implicit,s=m(2);return _(s.saveEdit(d.id))}),c(13,"Save"),i()()()}if(a&2){let t=m(3);r(4),b("ngModel",t.editRating),r(4),b("ngModel",t.editComment)}}function gt(a,e){if(a&1){let t=P();n(0,"article",23)(1,"div",24)(2,"div",25),v(3,"img",26),n(4,"div",27)(5,"div",28),c(6),i(),n(7,"div",29)(8,"span",11),g(9,mt,2,2,"mat-icon",12),i(),n(10,"span",30),c(11,"\u2022"),i(),n(12,"span",31),c(13),i()()()(),n(14,"div",32)(15,"button",33),M("click",function(){let d=p(t).$implicit,s=m(2);return _(s.startEdit(d))}),n(16,"mat-icon"),c(17,"edit"),i()()()(),n(18,"div",34),g(19,lt,2,1,"div",35),n(20,"p",36),c(21),i()(),g(22,st,14,2,"div",37),i()}if(a&2){let t=e.$implicit,o=m(2);r(3),l("src",t.avatarUrl,S),r(3),u(t.revieweeName),r(3),l("ngForOf",o.stars),r(4),u(o.dateLabel(t.createdAt)),r(6),l("ngIf",t.title),r(2),u(t.comment),r(),l("ngIf",o.editingId===t.id)}}function pt(a,e){if(a&1&&(n(0,"div",21),g(1,gt,23,7,"article",22),i()),a&2){let t=m();r(),l("ngForOf",t.filtered())}}var ot=class a{service=E(it);editingId=null;editRating=null;editComment="";all=C([]);loading=C(!0);error=C(null);query=C("");stars=[1,2,3,4,5];filtered=f(()=>{let e=this.query().trim().toLowerCase();return this.all().filter(t=>!e||t.revieweeName.toLowerCase().includes(e)||t.comment.toLowerCase().includes(e)||t.title?.toLowerCase().includes(e)).sort((t,o)=>new Date(o.createdAt).getTime()-new Date(t.createdAt).getTime())});count=f(()=>this.all().length);avg=f(()=>{let e=this.count();if(!e)return 0;let t=this.all().reduce((o,d)=>o+d.rating,0);return Math.round(t/e*10)/10});roundedAvg=f(()=>Math.round(this.avg()));dist=f(()=>{let e={1:0,2:0,3:0,4:0,5:0};for(let t of this.all())e[t.rating]++;return e});distPercent(e){let t=this.count();return t?Math.round((this.dist()[e]||0)/t*100):0}dateLabel(e){return new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"2-digit"})}ngOnInit(){this.loadReviews()}loadReviews(){this.loading.set(!0),this.error.set(null),this.service.getMyReviews().pipe(R(e=>(this.error.set("Failed to load reviews"),console.error(e),h([])))).subscribe(e=>{console.log("Loaded reviews:",e),this.all.set(e),this.loading.set(!1)})}startEdit(e){this.editingId=e.id,this.editRating=e.rating,this.editComment=e.comment}cancelEdit(){this.editingId=null,this.editRating=null,this.editComment=""}saveEdit(e){!this.editRating||this.editRating<1||this.editRating>5||this.service.submitUpdatedReview(e,this.editRating,this.editComment).subscribe({next:()=>{this.cancelEdit(),this.loadReviews()},error:t=>{console.error("Update failed:",t)}})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=I({type:a,selectors:[["app-reviews"]],decls:14,vars:4,consts:[[1,"reviews-wrap"],[1,"toolbar"],[1,"title"],["appearance","outline",1,"search"],["matInput","","placeholder","Doctor name, comment\u2026",3,"input","value"],["class","card summary",4,"ngIf"],["class","empty",4,"ngIf"],["class","list",4,"ngIf"],[1,"card","summary"],[1,"left"],[1,"avg"],[1,"stars"],[3,"active",4,"ngFor","ngForOf"],[1,"muted"],[1,"dist"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"label"],[1,"bar"],[1,"pct"],[1,"empty"],[1,"list"],["class","card item",4,"ngFor","ngForOf"],[1,"card","item"],[1,"head"],[1,"doc"],["alt","Doctor avatar",1,"avatar",3,"src"],[1,"who"],[1,"name"],[1,"meta"],[1,"dot"],[1,"date"],[1,"actions"],["mat-icon-button","","color","primary",3,"click"],[1,"body"],["class","title",4,"ngIf"],[1,"comment"],["class","edit-form",4,"ngIf"],[1,"edit-form"],["appearance","outline",1,"full"],["matInput","","type","number","min","1","max","5",3,"ngModelChange","ngModel"],["matInput","","rows","3",3,"ngModelChange","ngModel"],[1,"edit-actions"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(t,o){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon"),c(4,"reviews"),i(),n(5,"h2"),c(6,"My Reviews"),i()(),n(7,"mat-form-field",3)(8,"mat-label"),c(9,"Search reviews"),i(),n(10,"input",4),M("input",function(s){return o.query.set(s.target.value)}),i()()(),g(11,ct,11,8,"section",5)(12,dt,5,0,"div",6)(13,pt,2,1,"div",7),i()),t&2&&(r(10),l("value",o.query()),r(),l("ngIf",o.count()),r(),l("ngIf",!o.filtered().length),r(),l("ngIf",o.filtered().length))},dependencies:[j,k,V,A,tt,Z,K,J,H,Y,X,Q,nt,et,G,q,z,B,$,U,W,L],styles:[".rev-wrap[_ngcontent-%COMP%]{padding:1rem}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.toolbar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:800;letter-spacing:.2px}.toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .doctor[_ngcontent-%COMP%], .toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{min-width:220px}.toolbar[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{border-radius:999px;overflow:hidden}.summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:220px 1fr;gap:1rem;background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 25px #00000040}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.25rem;padding:.75rem}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .avg[_ngcontent-%COMP%]{font-size:42px;line-height:1;font-weight:800;letter-spacing:.2px}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]{display:flex;gap:.1rem}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{opacity:.35}.summary[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon.active[_ngcontent-%COMP%]{opacity:1}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]{display:grid;gap:.45rem;padding:.8rem .8rem .9rem}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;grid-template-columns:44px 1fr 44px;align-items:center;gap:.6rem}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{opacity:.8}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:10px;border-radius:999px;background:#ffffff0f;overflow:hidden}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;height:100%;background:linear-gradient(90deg,#2a76b7,#1db7a0)}.summary[_ngcontent-%COMP%]   .dist[_ngcontent-%COMP%]   .pct[_ngcontent-%COMP%]{text-align:right;opacity:.9}.pending[_ngcontent-%COMP%]{margin-top:1rem}.pending[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .6rem}.pending[_ngcontent-%COMP%]   .strip[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-auto-columns:minmax(260px,1fr);gap:.75rem;overflow-x:auto;padding-bottom:.25rem}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]{display:grid;align-content:start;gap:.75rem;background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:.85rem;box-shadow:0 10px 25px #00000040}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.65rem}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;object-fit:cover}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:.9rem}.pending[_ngcontent-%COMP%]   .pcard[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{justify-self:flex-start}.list[_ngcontent-%COMP%]{display:grid;gap:.9rem;margin-top:1rem}.item[_ngcontent-%COMP%]{background:#ffffff05;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:.9rem;box-shadow:0 10px 25px #00000040}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .doc[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:.9rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]{display:flex;gap:.1rem}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{opacity:.35}.item[_ngcontent-%COMP%]   .head[_ngcontent-%COMP%]   .stars[_ngcontent-%COMP%]   mat-icon.active[_ngcontent-%COMP%]{opacity:1}.item[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{margin-top:.5rem}.item[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:.2rem}.item[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{opacity:.95}.item[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-top:.6rem;display:flex;align-items:center;justify-content:space-between;gap:.75rem}.item[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.4rem}.empty[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.4rem;padding:1.5rem;border:1px dashed rgba(255,255,255,.1);border-radius:16px;opacity:.8}.mdc-text-field--outlined[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important;line-height:1!important}.mat-mdc-form-field[_ngcontent-%COMP%]{--mat-form-field-container-vertical-padding: 15px}.actions[_ngcontent-%COMP%]{display:flex;gap:.4rem}.edit-form[_ngcontent-%COMP%]{margin-top:.8rem;background:#ffffff08;border-radius:12px;padding:.8rem;display:grid;gap:.6rem}.edit-form[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}"]})};export{ot as ReviewsComponent};
