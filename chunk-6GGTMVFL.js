import{a as X}from"./chunk-QW23XC2O.js";import{b as W}from"./chunk-EE6PMZG7.js";import{a as O,c as N}from"./chunk-EEDQUWWO.js";import{a as z,b as K}from"./chunk-FNX66O3M.js";import"./chunk-MS4AQ6UA.js";import{a as H,b as J,d as Q}from"./chunk-GNF7NEE4.js";import"./chunk-FTUWSJZM.js";import"./chunk-JXSMCY7E.js";import"./chunk-3RK6DDJD.js";import{a as q,b as B,e as V,h as G,i as j,m as U,n as $}from"./chunk-AK7HCWPM.js";import"./chunk-SCUZIYM3.js";import"./chunk-HRQB4EEZ.js";import"./chunk-GED64AQA.js";import"./chunk-Z4D3JJEG.js";import{a as L,b as R}from"./chunk-ENKIQ3XX.js";import{A as D,b as y,d as p,f as A,g as E,l as I,o as P,r as x,y as w}from"./chunk-K2DA6FBL.js";import{T as k,Y as T,Z as F}from"./chunk-LVPX6TEL.js";import"./chunk-P6PSD35X.js";import{$a as l,Cb as c,Eb as _,Fc as M,Gc as S,La as a,Pa as f,Qb as b,Rc as C,Sb as o,Tb as u,Ub as v,Wa as h,qb as d,rb as i,sb as t,tb as s}from"./chunk-WZIMFKHB.js";function Z(n,r){n&1&&(i(0,"mat-error"),o(1,"Email is required"),t())}function ee(n,r){n&1&&(i(0,"mat-error"),o(1,"Enter a valid email"),t())}function te(n,r){n&1&&(i(0,"mat-error"),o(1,"Phone is required"),t())}function re(n,r){n&1&&(i(0,"mat-error"),o(1,"Enter a valid phone"),t())}function ie(n,r){if(n&1&&(i(0,"mat-option",18),o(1),t()),n&2){let m=r.$implicit;d("value",m.id),a(),u(m.name)}}function ne(n,r){n&1&&(i(0,"mat-error"),o(1,"Select a department"),t())}function oe(n,r){n&1&&(i(0,"mat-error"),o(1,"Password is required"),t())}function ae(n,r){n&1&&(i(0,"mat-error"),o(1,"Min 6 characters"),t())}function me(n,r){if(n&1&&(i(0,"p",19),o(1),t()),n&2){let m=_();a(),u(m.apiError)}}function de(n,r){n&1&&(i(0,"mat-icon"),o(1,"person_add"),t())}var Y=class n{constructor(r,m,e){this.fb=r;this.snack=m;this.adminService=e;this.form=this.fb.group({email:["",[p.required,p.email]],phone:["",[p.required,p.pattern(/^\+?\d[\d\s-]{6,}$/)]],departmentId:[null,p.required],tempPassword:["",[p.required,p.minLength(6)]]})}departments=[];hidePass=!0;loading=!1;apiError=null;form;ngOnInit(){this.adminService.getDepartments().subscribe({next:r=>{this.departments=Array.isArray(r)?r:[],this.departments.length&&this.form.patchValue({departmentId:this.departments[0].id}),this.loading=!1},error:r=>{let m=typeof r=="string"?r:r?.message||"Unknown error";this.snack.open(`Failed to fetch departments: ${m}`,"Close",{duration:3e3}),this.loading=!1}})}get f(){return this.form.controls}generatePassword(){let r="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",m=Array.from(crypto.getRandomValues(new Uint8Array(10))).map(e=>r[e%r.length]).join("");this.form.patchValue({tempPassword:m}),this.hidePass=!1}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}let r=this.departments.find(e=>e.id===this.form.value.departmentId);if(!r){this.apiError="Please pick a valid department.";return}let m={email:this.form.value.email,phoneNumber:this.form.value.phone,password:this.form.value.tempPassword,department:r.name};this.loading=!0,this.apiError=null,this.adminService.registerDoctor(m).subscribe({next:e=>{this.loading=!1,this.snack.open(e.message??"Doctor credentials created","OK",{duration:2800}),this.form.reset({email:"",phone:"",departmentId:this.departments[0].id,tempPassword:""}),this.hidePass=!0},error:e=>{this.loading=!1,this.apiError=e}})}static \u0275fac=function(m){return new(m||n)(f(w),f(z),f(X))};static \u0275cmp=h({type:n,selectors:[["admin-add-doctor"]],decls:45,vars:18,consts:[[1,"title"],[1,"glass-card"],[1,"form-grid",3,"ngSubmit","formGroup"],["appearance","outline"],["matInput","","type","email","formControlName","email","autocomplete","email"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","phone","placeholder","+20 1xx xxx xxxx","autocomplete","tel"],["formControlName","departmentId"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"pass-field"],["matInput","","formControlName","tempPassword","autocomplete","new-password",3,"type"],["mat-icon-button","","matSuffix","","type","button","aria-label","Toggle password",3,"click"],["class","api-error","role","alert",4,"ngIf"],[1,"actions-row"],["mat-stroked-button","","type","button",3,"click","disabled"],[1,"grow"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[3,"value"],["role","alert",1,"api-error"]],template:function(m,e){m&1&&(i(0,"h2",0),o(1,"Add Doctor"),t(),i(2,"mat-card",1)(3,"form",2),c("ngSubmit",function(){return e.submit()}),i(4,"mat-form-field",3)(5,"mat-label"),o(6,"Doctor email"),t(),s(7,"input",4),i(8,"mat-icon",5),o(9,"mail"),t(),l(10,Z,2,0,"mat-error",6)(11,ee,2,0,"mat-error",6),t(),i(12,"mat-form-field",3)(13,"mat-label"),o(14,"Phone numberr"),t(),s(15,"input",7),i(16,"mat-icon",5),o(17,"call"),t(),l(18,te,2,0,"mat-error",6)(19,re,2,0,"mat-error",6),t(),i(20,"mat-form-field",3)(21,"mat-label"),o(22,"Department"),t(),i(23,"mat-select",8),l(24,ie,2,2,"mat-option",9),t(),l(25,ne,2,0,"mat-error",6),t(),i(26,"mat-form-field",10)(27,"mat-label"),o(28,"Temporary password"),t(),s(29,"input",11),i(30,"button",12),c("click",function(){return e.hidePass=!e.hidePass}),i(31,"mat-icon"),o(32),t()(),l(33,oe,2,0,"mat-error",6)(34,ae,2,0,"mat-error",6),t(),l(35,me,2,1,"p",13),i(36,"div",14)(37,"button",15),c("click",function(){return e.generatePassword()}),i(38,"mat-icon"),o(39,"auto_fix_high"),t(),o(40," Generate "),t(),s(41,"span",16),i(42,"button",17),l(43,de,2,0,"mat-icon",6),o(44),t()()()()),m&2&&(a(3),b("busy",e.loading),d("formGroup",e.form),a(7),d("ngIf",e.f.email.touched&&(e.f.email.errors==null?null:e.f.email.errors.required)),a(),d("ngIf",e.f.email.touched&&(e.f.email.errors==null?null:e.f.email.errors.email)),a(7),d("ngIf",e.f.phone.touched&&(e.f.phone.errors==null?null:e.f.phone.errors.required)),a(),d("ngIf",e.f.phone.touched&&(e.f.phone.errors==null?null:e.f.phone.errors.pattern)),a(5),d("ngForOf",e.departments),a(),d("ngIf",e.f.departmentId.touched&&(e.f.departmentId.errors==null?null:e.f.departmentId.errors.required)),a(4),d("type",e.hidePass?"password":"text"),a(3),u(e.hidePass?"visibility":"visibility_off"),a(),d("ngIf",e.f.tempPassword.touched&&(e.f.tempPassword.errors==null?null:e.f.tempPassword.errors.required)),a(),d("ngIf",e.f.tempPassword.touched&&(e.f.tempPassword.errors==null?null:e.f.tempPassword.errors.minlength)),a(),d("ngIf",e.apiError),a(2),d("disabled",e.loading),a(5),d("disabled",e.loading),a(),d("ngIf",!e.loading),a(),v(" ",e.loading?"Creating\u2026":"Create credentials"," "))},dependencies:[C,M,S,D,I,y,A,E,P,x,N,O,j,G,q,B,V,$,U,Q,J,H,F,T,k,R,L,K,W],styles:[".title[_ngcontent-%COMP%]{margin:0 0 .8rem}.glass-card[_ngcontent-%COMP%]{border-radius:18px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,#ffffff08,#ffffff05),#1018288c;-webkit-backdrop-filter:blur(12px) saturate(120%);backdrop-filter:blur(12px) saturate(120%);padding:1rem}.form-grid[_ngcontent-%COMP%]{display:grid;gap:.9rem;grid-template-columns:repeat(2,minmax(240px,1fr))}.pass-field[_ngcontent-%COMP%]{grid-column:span 2}.actions-row[_ngcontent-%COMP%]{grid-column:1/-1;display:flex;align-items:center;gap:.75rem}.grow[_ngcontent-%COMP%]{flex:1 1 auto}@media (max-width: 720px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.pass-field[_ngcontent-%COMP%]{grid-column:1}}.api-error[_ngcontent-%COMP%]{grid-column:1/-1;color:#f44336;font-size:.85rem;margin:-.25rem 0 .25rem}.form-grid.busy[_ngcontent-%COMP%]{opacity:.75;pointer-events:none}"]})};export{Y as AdminAddDoctorComponent};
