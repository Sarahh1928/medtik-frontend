import{a as u,b as m}from"./chunk-JQ5JD7Q3.js";import{$ as p,Sc as d,T as c,Tc as b,W as h,g as o,k as g,l as n,o as s,z as i}from"./chunk-HKUWCROW.js";var y=class a{http=p(b);auth=p(m);baseUrl=u.apiBaseUrl;profileSubject=new o(null);lockedSubject=new o(!0);loadingSubject=new o(!1);profile$=this.profileSubject.asObservable();locked$=this.lockedSubject.asObservable();loading$=this.loadingSubject.asObservable();requestOptions(){if(u.production)return{withCredentials:!0};{let t=this.auth.getToken();if(!t)throw new Error("Doctor session expired.");return{headers:new d({Authorization:`Bearer ${t}`})}}}loadProfile(t=!1){let e=this.profileSubject.value;return e&&!t?g(e):(this.loadingSubject.next(!0),this.http.get(`${this.baseUrl}/doctor/profile`,this.requestOptions()).pipe(s(r=>r.doctor),c(r=>{this.profileSubject.next(r),this.lockedSubject.next(this.computeLocked(r)),this.loadingSubject.next(!1)}),i(r=>this.handleError(r))))}refreshProfile(){return this.profileSubject.next(null),this.lockedSubject.next(!0),this.loadProfile(!0)}updateProfile(t){return this.http.put(`${this.baseUrl}/doctor/update`,t,this.requestOptions()).pipe(s(e=>e.doctor),c(e=>{this.profileSubject.next(e),this.lockedSubject.next(this.computeLocked(e))}),i(e=>this.handleError(e)))}markAsUnlocked(){this.lockedSubject.next(!1)}computeLocked(t){if(!t)return!0;if(t.status==="ACCEPTED")return!1;let e=!!(t.title?.trim()&&t.bio?.trim()&&t.phone?.trim()&&t.department&&t.yearsOfExperience!=null&&Number(t.yearsOfExperience)>0&&t.licenseNumber?.trim()&&t.avatarUrl?.trim()),r=(t.languages?.length??0)>0,O=Array.isArray(t.pricing)&&t.pricing.length>0?["CHAT","VOICE","VIDEO"].every(v=>t.pricing.some(l=>l.service===v&&!!l.currency?.trim()&&Number(l.price)>0)):!1,D=!!t.availability&&(t.availability.chat||t.availability.voice||t.availability.video);return!0}handleError(t){this.loadingSubject.next(!1);let e="Unable to load doctor profile. Please try again.",r=t.error;return r?typeof r=="string"?e=r:typeof r=="object"&&(e=r.error??r.message??e):t.message&&(e=t.message),n(()=>e)}getAppointments(){return this.http.get(`${this.baseUrl}/appointments`,this.requestOptions()).pipe(i(t=>n(()=>t)))}cancelAppointment(t){return this.http.put(`${this.baseUrl}/doctor/appointments/${t}/cancel`,{},this.requestOptions())}noshowAppointment(t){return this.http.put(`${this.baseUrl}/doctor/appointments/${t}/no-show`,{},this.requestOptions())}postConsultationDetails(t,e){return this.http.post(`${this.baseUrl}/doctor/consultation/${t}`,e,this.requestOptions())}getConsultationDetails(t){return this.http.get(`${this.baseUrl}/doctor/consultation/${t}`,this.requestOptions())}updateConsultationDetails(t,e){return this.http.put(`${this.baseUrl}/doctor/consultation/${t}`,e,this.requestOptions()).pipe(i(r=>n(()=>r)))}deleteConsultationDetails(t){return this.http.delete(`${this.baseUrl}/doctor/consultation/${t}`,this.requestOptions())}addSlot(t){return this.http.post(`${this.baseUrl}/doctor/addSlot`,t,this.requestOptions())}deleteSlot(t){return this.http.delete(`${this.baseUrl}/doctor/slots/${t}`,this.requestOptions())}getPatients(){return this.http.get(`${this.baseUrl}/doctor/getMyPatients`,this.requestOptions())}getMyPatients(){return this.http.get(`${this.baseUrl}/doctor/getMyPatients`,this.requestOptions()).pipe(s(t=>t.patients))}getNotifications(){return this.http.get(`${this.baseUrl}/notifications`,this.requestOptions()).pipe(s(t=>t.notifications||[]),i(t=>n(()=>new Error(t?.error?.message||"Failed to load notifications"))))}sendMessageToServer(t,e){return this.http.post(`${this.baseUrl}/chat/send`,{receiverId:e,content:t,type:"TEXT"},this.requestOptions())}getChatHistory(t){return this.http.get(`${this.baseUrl}/chat/history/${t}`,this.requestOptions())}getProfile(){return this.http.get(`${this.baseUrl}/doctor/profile`,this.requestOptions())}get lockedValue(){return console.log("\u{1FA7A} Doctor profile locked status:",this.lockedSubject.value),this.lockedSubject.value}getDepartments(){let t=this.requestOptions().headers;return this.http.get(`${this.baseUrl}/departments`,this.requestOptions()).pipe(i(e=>this.handleError(e)))}static \u0275fac=function(e){return new(e||a)};static \u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})};export{y as a};
